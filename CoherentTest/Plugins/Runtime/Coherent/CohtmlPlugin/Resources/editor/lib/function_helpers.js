"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var enums_1=require("./enums"),main_1=require("../scripts/main"),editor_properties_1=require("./editor_properties"),editor_settings_1=require("./editor_settings"),filters_config_1=require("./common/filters_config"),units_conversion_1=require("../scripts/helpers/units_conversion");exports.default={getTransformedElMaskPos:function(e){for(var t,r,n,i,a=0;a<e.transformed_position.length;a++){var o=e.transformed_position[a][0],s=e.transformed_position[a][1];t=void 0===t?s:t,r=void 0===r?o:r,n=void 0===n?s:n,i=void 0===i?o:i,t=s<t?s:t,r=o<r?o:r,n=s>n?s:n,i=o>i?o:i}return{top:t,left:r,height:n-t,width:i-r}},getTransformOrigin:function(e,t){var r=getComputedStyle(document.getElementById(t.id)).transformOrigin.split(" ");return{x:Number(r[0].match(/(-|[0-9\.0-9])+/g)[0])+Number(e.left),y:Number(r[1].match(/(-|[0-9\.0-9])+/g)[0])+Number(e.top)}},getElementVertices:function(e){var t=main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor,r=document.getElementById(e.id),n=0;if($.isEmptyObject(e))return{top:"0",left:"0",width:"0",height:"0",position:""};"scene"===r.parentElement.id&&(n=t.sceneBorderSize);var i=window.getComputedStyle(r,null).getPropertyValue("width"),a=window.getComputedStyle(r,null).getPropertyValue("height"),o=this.calculatePosition(r,"top",n),s=this.calculatePosition(r,"left",n);return"%"===this.getUnitStyle(o)&&(o=units_conversion_1.default.convertUnitsToPixel(e.id,o,"top")),"%"===this.getUnitStyle(s)&&(s=units_conversion_1.default.convertUnitsToPixel(e.id,s,"left")),"%"===this.getUnitStyle(i)&&(i=units_conversion_1.default.convertUnitsToPixel(e.id,i,"width")),"%"===this.getUnitStyle(a)&&(a=units_conversion_1.default.convertUnitsToPixel(e.id,a,"height")),{top:this.getUnitValue(o),left:this.getUnitValue(s),width:this.getUnitValue(i),height:this.getUnitValue(a),position:r.style.position}},calculatePosition:function(e,t,r){var n="relative"===e.style.position?this.offset(e)[t]:0;return this.getComputedStyleNumber(e,t)+this.getComputedStyleNumber(e.parentElement,"border-"+t+"-width")-r+n+"px"},getComputedStyleNumber:function(e,t,r){void 0===r&&(r=!0);var n=window.getComputedStyle(e,null).getPropertyValue(t);return n="auto"===n?"0":n,r?parseInt(n):n},offset:function(e){return{width:e.offsetWidth,height:e.offsetHeight,top:e.offsetTop,left:e.offsetLeft}},buildTransformStyles:function(e){var t="";for(var r in enums_1.default.TransformsOrder){var n=enums_1.default.TransformsOrder[r];e.transform[n]&&(t+=n+"("+e.transform[n]+") ")}return main_1.default.preferences.couiEnvironment===editor_settings_1.default.environment.Hummingbird&&(t=this.rebuildTransformForHb(t)),t},rebuildTransformForHb:function(e){var t=e.match(/scaleX\((.*?)\)/),r=e.match(/scaleY\((.*?)\)/);if(null!==t||null!==r){var n="scale";if(null!==t&&null!==r){n+="("+t[1]+", "+r[1]+")";i=t[0]+" "+r[0];e=e.replace(i,n)}else if(null!==t&&null===r){n+="("+t[1]+", 1)";i=""+t[0];e=e.replace(i,n)}else if(null===t&&null!==r){n+="(1, "+r[1]+")";var i=""+r[0];e=e.replace(i,n)}}var a=/rotateZ/;return null!==e.match(a)&&(e=e.replace(a,"rotate")),e},buildPerspectiveOriginStyles:function(e){var t="";for(var r in e.transform)"transform-origin-x"!==r&&"transform-origin-y"!==r&&(t+=r+"("+e.transform[r]+") ");return t},parseMatrix:function(e,t){for(var r=[[],[],[],[]],n=0,i=0,a=e instanceof Array?e.length:16,o=0;o<a;o++){0!==o&&o%Math.sqrt(a)==0&&(n=0,i++);var s=t?"m"+(i+1)+(n+1):o;r[n][i]=Number(e[s]),n++}return r},multiply:function(e,t){for(var r=[],n=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)n+=e[i][a]*t[a],r[i]=n;n=0}return r},areEqual:function(e,t){var r=0,n=e.length;if(n!==t.length)return!1;for(var i=0;i<n;i++){if(e[i]!==t[i])return!1;r++}return r===e.length},buildStringProps:function(e,t){e=t?this.sortArr(e):e;for(var r="",n=0;n<e.length;n++)r+=e[n];return r},hasValue:function(e,t){for(var r=-1,n=0;n<e.length;n++)if(e[n].match(t)){r=n;break}return r},sortArr:function(e,t){return e.sort(function(e,r){var n=e>r?1:-1;return t?-1*n:n})},getBoxShodowDefaults:function(){return{dropShadowBlur:filters_config_1.default["-webkit-filter"].dropShadowBlur.default,dropShadowX:filters_config_1.default["-webkit-filter"].dropShadowX.default,dropShadowY:filters_config_1.default["-webkit-filter"].dropShadowY.default,dropShadowColor:filters_config_1.default["-webkit-filter"].dropShadowColor.default}},buildDropShadowFiltersProps:function(e,t){var r=e.property,n=main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor;if("dropShadowBlur"===r||"dropShadowX"===r||"dropShadowY"===r||"dropShadowColor"===r){var i=t.replace(/\s/g,"").match(/([^\]+)( [^\)]+)/g),a="dropShadowColor"===r?i[0]+"("+i[1]+")":i[0];n.runtimeBuildDropShodowFilter[r]=a}},buildFilterProps:function(e,t){var r="",n=e.values;n=t?this.sortArr(n):n;for(var i=0;i<n.length;i++)r+=n[i];return r},isVoidElement:function(e){var t=e.tagName;return-1!==enums_1.default.voidElements.indexOf(t)},notAllowedForAnimation:function(e,t){return enums_1.default.notAllowedForAnimation[e]===t},validateId:function(e){var t=!1;return e.match(/[^a-zA-Z0-9_-]+/g)||(t=!0),t},validateAnimationName:function(e){var t=!1;return e.match(/^([a-zA-Z]|^[-](?=[a-zA-Z]))[a-zA-Z0-9_-]*/g)&&(t=!0),t},hasInChildren:function(e,t,r){for(var n=!1,i=0;i<e.length;i++)if(e[i][t]===r){n=!0;break}return n},rekickDomWebkitMasks:function(){for(var e=main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor.mappedWidgets,t=0,r=Object.keys(e);t<r.length;t++){var n=r[t];if(e[n].widget.styles.webkitMaskImage){var i=document.getElementById(n);i.style.maskImage=e[n].widget.styles.webkitMaskImage,i.style.maskRepeat=e[n].widget.styles.webkitMaskRepeat}}},getFromTimeline:function(e){return main_1.default.detachedAmnimationsHTML?$(main_1.default.detachedAmnimationsHTML).find(e):$(e)},shortenLongValue:function(e){var t,r,n=this.getUnitStyle(e);switch(n){case"deg":case"px":case"%":r=this.getUnitValue(e),t=parseInt(r)+n;break;case"vw":case"vh":case"vmax":case"vmin":case"rem":case"pt":r=this.getUnitValue(e),t=parseFloat(r).toFixed(1)+n;break;default:t=e}return t},getRandomNumber:function(e,t){return Math.random()*(t-e)+e},translateDataBindNames:function(e,t){var r=this;if(t){var n=enums_1.default.DataBindingGroups[e].replace("data-","");return"bindClassToggle"===e?n=n.replace("bind-",""):"bindStyleBackgroundColor"===e?n=n.replace("bind-style-",""):"bindStyleBackgroundImageUrl"===e&&(n=n.replace("bind-style-background-image-url","background-image")),n}if(enums_1.default.DataBindingGroups[e])return e;var i=e.split("-").map(function(e){return r.capitalizeFirstLetter(e)}).join("").replace("Bind","bind");return"class-toggle"===e?i="bind"+i:"background-color"===e?i="bindStyle"+i:"background-image"===e&&(i="bindStyle"+i+"Url"),i},stylesValueNormalizer:function(e){var t=/rgba\((\d.*?),\s*(\d.*?),\s*(\d.*?),\s*(\d.*?)\)/g,r=e.match(t);if(null!==r){var n=r[0].split(t);n="rgba("+parseInt(n[1])+","+parseInt(n[2])+","+parseInt(n[3])+","+parseFloat(n[4]).toFixed(1)+")",e=e.replace(r[0],n)}return e},convertColorValues:function(e){var t=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/g);if(null!==t){var r=t[0].replace(")",",1)");r=r.replace("rgb(","rgba("),e=e.replace(t[0],r)}var n=e.match(/#\b[0-9A-Fa-f]+\b/g);if(null!==n){var i=n[0].replace("#","");i.length<6&&(i=i[0]+i[0]+i[1]+i[1]+i[2]+i[2]);var a="rgba("+parseInt(i.substring(0,2),16)+","+parseInt(i.substring(2,4),16)+","+parseInt(i.substring(4,6),16)+",1)";e=e.replace(n[0],a)}return e},getHighestDecimal:function(e,t){var r=(""+e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/),n=(""+t).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);if(!r||!n)return 0;var i=Math.max(0,(r[1]?r[1].length:0)-(r[2]?+r[2]:0)),a=Math.max(0,(n[1]?n[1].length:0)-(n[2]?+n[2]:0));return Math.max(i,a)},applyStylesToScene:function(e){var t;return t=e.filter(function(e){return"string"==typeof e}).join("\n"),(t=t.split(/^((?:#|\.|@)?[\sa-zA-Z+~*$>:=^#\"\'\.\[\]\[0-9\]-]+\s*(?:,\s*(?:#|\.)?[\sa-zA-Z+~*$>:=^#\"\'\.\[\]\[0-9\]-]+)*\s*(?={))/gm).map(function(e){return""!==e&&"{"!==e[0]?e.split(",").map(function(e){var t=e.trim();return"@font-face"===t?t+" ":"body"===t||"html"===t||"body, html"===t?"#scene ":"#scene "+t}).join(","):e}).join(""))+'\n#scene * {\n/*CSS transitions*/\n-o-transition-property: none !important;\n-moz-transition-property: none !important;\n-ms-transition-property: none !important;\n-webkit-transition-property: none !important;\ntransition-property: none !important;\n/*CSS animations*/\n-webkit-animation: none !important;\n-moz-animation: none !important;\n-o-animation: none !important;\n-ms-animation: none !important;\nanimation: none !important;\n}\n#scene point, #scene mask, #scene div[data-type="widget"]{\nbackground-color: transparent !important;\n}\n#scene div{\n-o-transform: none;\n-moz-transform: none;\n-ms-transform: none;\n-webkit-transform: none;\ntransform: none;\n}'},getBackgroundSize:function(e){var t,r=getComputedStyle(e),n=new Image,i=r.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),a=r.backgroundSize,o=[parseInt(r.width.replace("px",""),10),parseInt(r.height.replace("px",""),10)],s=[];if(n.src=i,t=n.width>n.height?n.width/n.height:n.height/n.width,a=a.split(" "),s[0]=a[0],s[1]=a.length>1?a[1]:"auto","cover"===a[0])o[0]>o[1]&&o[0]/o[1]>=t?(s[0]=o[0],s[1]="auto"):(s[0]="auto",s[1]=o[1]);else if("contain"===a[0])o[0]<o[1]?(s[0]=o[0],s[1]="auto"):o[0]/o[1]>=t?(s[0]="auto",s[1]=o[1]):(s[1]="auto",s[0]=o[0]);else for(var l=a.length;l--;)a[l].indexOf("px")>-1?s[l]=a[l].replace("px",""):a[l].indexOf("%")>-1&&(s[l]=o[l]*(a[l].replace("%","")/100));return"auto"===s[0]&&"auto"===s[1]?(s[0]=n.width,s[1]=n.height):(t="auto"===s[0]?n.height/s[1]:n.width/s[0],s[0]="auto"===s[0]?n.width/t:s[0],s[1]="auto"===s[1]?n.height/t:s[1]),{width:s[0],height:s[1]}},getSceneSizeByType:function(e,t,r){var n="",i="";switch(e){case"aspectRatio5_4":n="1000px",i="800px";break;case"aspectRatio4_3":n="800px",i="600px";break;case"aspectRatio16_10":n="1440px",i="900px";break;case"aspectRatio16_9":n="1600px",i="900px";break;case"aspectRatio16_9_full_hd":n="1920px",i="1080px";break;case"aspectRatio_custom":n=t+"px",i=r+"px"}return{type:e,width:n,height:i}},numKeys:function(e){return Object.keys(e).length},getObjects:function(e,t){var r=[];for(var n in e)e.hasOwnProperty(n)&&("object"==typeof e[n]&&n!==t?r=r.concat(this.getObjects(e[n],t)):n===t&&r.push(e[t]));return r},getSceneSize:function(){var e=main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor.scene,t=parseInt(e.sceneSize.height);return{width:parseInt(e.sceneSize.width),height:t}},getSceneFontSize:function(){return parseFloat(getComputedStyle($("#scene")[0],null)["font-size"])},isfirstUpload:function(e,t){return"image"===e?""===t.url.trim():"responsiveImage"===e?""===t.styles.backgroundImage.trim():void 0},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},toFixed:function(e,t){var r=Math.pow(10,t);return Math.floor(100*e/100*r)/r},isUndefined:function(e){return void 0===e},isEventName:function(e){return-1!==enums_1.default.EventTypes.indexOf(e)},isDataBindingTypes:function(e){return-1!==enums_1.default.DataBindingTypes.indexOf(e)},isTransformProperty:function(e){return-1!==enums_1.default.TransformTypes.indexOf(e)},getTransformProperty:function(e,t){return e="rotateX"===t||"rotateY"===t||"rotateZ"===t||"skewX"===t||"skewY"===t?void 0!==e?e:"0deg":"scaleX"===t||"scaleY"===t||"scaleZ"===t?void 0!==e?e:"1":"transform-origin-x"===t||"transform-origin-y"===t?void 0!==e?e:"50%":void 0!==e?e:"0px"},shortenString:function(e){return e.length>20?(e=e.substring(0,20))+"...":e},backwardsShortenString:function(e,t){void 0===t&&(t=20);var r=e.length,n=e;return r>t?"..."+(n=n.substring(r-t,r)):e},doPolygonsIntersect:function(e,t){var r,n,i,a,o,s,l,u,d=[e,t];for(a=0;a<d.length;a++){var c=d[a];for(o=0;o<c.length;o++){var f=(o+1)%c.length,p=c[o],m=c[f],g={x:m.y-p.y,y:p.x-m.x};for(r=n=void 0,s=0;s<e.length;s++)i=g.x*e[s].x+g.y*e[s].y,(this.isUndefined(r)||i<r)&&(r=i),(this.isUndefined(n)||i>n)&&(n=i);for(l=u=void 0,s=0;s<t.length;s++)i=g.x*t[s].x+g.y*t[s].y,(this.isUndefined(l)||i<l)&&(l=i),(this.isUndefined(u)||i>u)&&(u=i);if(n<l||u<r)return!1}}return!0},calcElementTransformedMatrixCoords:function(e,t){for(var r={x:0,y:0};e.parentElement.id!==t;){var n=this.getElementAbsoluteTransform(e.parentElement,t),i=this.calcMatrixPoints(e,n);r.x+=i.x,r.y+=i.y,e=e.parentElement}return r},getElementAbsoluteTransform:function(e,t){var r=new WebKitCSSMatrix(window.getComputedStyle(e).webkitTransform);for("scene"===e.id&&(r.m41=0,r.m42=0);e.parentElement.id!==t;){var n=new WebKitCSSMatrix(window.getComputedStyle(e.parentElement).webkitTransform);"scene"!==e.parentElement.id&&"scene"!==e.id||(n.m41=0,n.m42=0),r=r.multiply(n),e=e.parentElement}return r},calcMatrixPoints:function(e,t){var r=t,n=parseFloat(getComputedStyle(e,null).getPropertyValue("border-left-width"))||0,i=parseFloat(getComputedStyle(e,null).getPropertyValue("border-top-width"))||0,a=e.offsetLeft+n,o=e.offsetTop+i,s=isNaN(a)?0:a,l=isNaN(o)?0:o,u=s-parseFloat(getComputedStyle(e.parentElement,null).getPropertyValue("width"))/2+parseFloat(getComputedStyle(e,null).getPropertyValue("width"))/2,d=l-parseFloat(getComputedStyle(e.parentElement,null).getPropertyValue("height"))/2+parseFloat(getComputedStyle(e,null).getPropertyValue("height"))/2,c=this.multiply(this.parseMatrix(r,!0),[u,d,0,1]);return{x:c[0]-u,y:c[1]-d}},firstToUpperCase:function(e){return e.substr(0,1).toUpperCase()+e.substr(1)},getFileType:function(e){var t=e.split(".").pop(),r=editor_properties_1.default[editor_settings_1.default.environment[main_1.default.preferences.couiEnvironment]].DefaultExtensions;return-1!==r.image.indexOf(t)?"image":-1!==r.video.indexOf(t)?"video":-1!==r.html.indexOf(t)?-1!==e.indexOf("widgets")&&"widget":-1!==r.style.indexOf(t)?"style":-1!==r.script.indexOf(t)?"script":-1!==r.font.indexOf(t)&&"font"},getFilename:function(e){return e.match(/[^\\|/|]+$/)[0]},getTransformedCoordsGlobal:function(e,t,r,n,i){var a=this.parseMatrix(i,!0),o=document.getElementById("scene"),s=this.getAbsolutePosition(o,"coui-editor"),l={x:r-s.left,y:n-s.top,z:0,w:1},u={x:0,y:0,z:0},d={x:-10*a[0][0]+-10*a[0][1]+0*a[0][2]+1*a[0][3],y:-10*a[1][0]+-10*a[1][1]+0*a[1][2]+1*a[1][3],z:-10*a[2][0]+-10*a[2][1]+0*a[2][2]+1*a[2][3],w:-10*a[3][0]+-10*a[3][1]+0*a[3][2]+1*a[3][3]},c=0*a[0][0]+0*a[0][1]+1*a[0][2]+1*a[0][3],f=0*a[1][0]+0*a[1][1]+1*a[1][2]+1*a[1][3],p=0*a[2][0]+0*a[2][1]+1*a[2][2]+1*a[2][3],m=Math.sqrt(c*c+f*f+p*p),g=((c/=m)*u.x+(f/=m)*u.y+(p/=m)*u.z-(c*d.x+f*d.y+p*d.z))/Math.sqrt(c*c+f*f+p*p),h=-(l.x*c+l.y*f+0*p+g)/(0*c+0*f+-1*p),v=window.mouseCoordsX-s.left,b=window.mouseCoordsY-s.top,y=-(v*c+b*f+0*p+g)/(0*c+0*f+-1*p),w=l.x*a[0][0]+l.y*a[0][1]+h*a[0][2]+1*a[0][3],S=l.x*a[1][0]+l.y*a[1][1]+h*a[1][2]+1*a[1][3];return{x:v*a[0][0]+b*a[0][1]+y*a[0][2]+1*a[0][3]-w,y:v*a[1][0]+b*a[1][1]+y*a[1][2]+1*a[1][3]-S}},getElementAbsoluteTransformV2:function(e){for(var t=[new WebKitCSSMatrix(window.getComputedStyle(e).webkitTransform)],r=document.getElementById("scene"),n=new WebKitCSSMatrix(window.getComputedStyle(r).webkitTransform);;){if("scene"===e.parentElement.id)break;t.push(new WebKitCSSMatrix(window.getComputedStyle(e.parentElement).webkitTransform)),e=e.parentElement}for(var i=t.length-1;i>0;i--)n=n.multiply(t[i]);return n.inverse()},getTransformedCoordsSkew:function(e,t,r,n){return{x:e-r,y:t-n}},getTransformedCoordsRotation:function(e,t,r){return{x:e*Math.cos(-r)-t*Math.sin(-r),y:e*Math.sin(-r)+t*Math.cos(-r)}},getAbsolutePosition:function(e,t){var r,n,i,a,o=0,s=0,l=3;for("scene"!==t&&(l=0);e&&e.id!==t;)r=parseFloat(getComputedStyle(e.parentElement,null).getPropertyValue("padding-left"))||0,n=parseFloat(getComputedStyle(e.parentElement,null).getPropertyValue("padding-top"))||0,i=parseFloat(getComputedStyle(e.parentElement,null).getPropertyValue("border-left-width"))||0,a=parseFloat(getComputedStyle(e.parentElement,null).getPropertyValue("border-top-width"))||0,o+=e.offsetLeft-r+i,s+=e.offsetTop-n+a,e=e.offsetParent;return{left:o-l,top:s-l}},rotationInfo:function(e,t){for(var r={rad:0,deg:0};"scene"!==e.id;){var n=window.getComputedStyle(e,null).getPropertyValue("-webkit-transform");if((n=n.match("matrix\\((.*)\\)"))&&void 0!==(n=n[1].split(","))[0]&&void 0!==n[1]&&(r.rad+=Math.atan2(n[1],n[0]),r.deg+=180*r.rad/Math.PI),"single"===t)break;e=e.parentElement}return r},findParents:function(e){for(;e.parentNode;){var t=e;if("scene"===(e=e.parentNode).id)return t}return null},timeFormatAnimations:function(e){var t=e%1e3,r=Math.floor(e/1e3%60);return Math.floor(e/6e4%60)+":"+r+"."+t},buildDropShadowProperty:function(e){return e.dropShadowColor?"drop-shadow("+e.dropShadowColor+" "+parseFloat(e.dropShadowX)+"px "+parseFloat(e.dropShadowY)+"px "+parseFloat(e.dropShadowBlur)+"px)":""},dropShadowPropsFix:function(e){var t,r,n=e.match(/(\(.*\))(.*?\))/);return null===n?(n=e.match(/(.*)(rgb.+\))/),t=n[2],r=n[1].substring(1).trim().split(" "),[r[0],r[1],r[2],r[3]]):(t=n[1],r=n[2].substring(0,n[2].length-1).trim().split(" "),{boxShadowX:r[0],boxShadowY:r[1],boxShadowColor:t,boxShadowBlur:r[2]})},getValuesFromFilterCssProperties:function(e){var t=this.cleanFilterString(e),r=t.clenedString.match(/([^\]+)( [^\)]+)/g)||[];for(var n in t.dropShadowProps)r.push(n),r.push(t.dropShadowProps[n]);return r},getValuesBoxshadow:function(e){var t=(e=e.trim()).match(/((?:rgb|hsl)(?:a)?\(.+\))$|(#[0-9a-fA-F]{3,6})$|\b(\w+)$|([^ ]+)/gm);return 5===t.length&&t.unshift("none"),["insetOutset",t[0],"horizontalLength",t[1],"verticalLength",t[2],"blurRadius",t[3],"spreadRadius",t[4],"color",t[5]]},splitCssStringProperties:function(e,t,r,n,i,a){var o=/(\D+)\((.*?)\)/,s=t.split(" ").map(function(e){return e.match(o)}).filter(function(e){return null!==e}).reduce(function(e,t){return e[t[1]]=t[2],e},{});s[n]="number"==typeof i?Math.round(10*i)/10:i;var l=[];Object.keys(s).sort().forEach(function(e,t){"dropShadowBlur"!==e&&"dropShadowColor"!==e&&"dropShadowX"!==e&&"dropShadowY"!==e&&l.push(e+"("+s[e]+")")});var u=l.join(" ");if("webkitFilter"===r){var d=main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor.mappedWidgets[e].widget["-webkit-filter"];u+=" "+this.buildDropShadowProperty(d)}return a(u.trim())},getBoxshadowObject:function(e){for(var t={},r=this.getValuesBoxshadow(e),n=0;n<r.length-1;n+=2)t[r[n]]=r[n+1];return t},getWebkitFilterObject:function(e){for(var t={},r=this.getValuesFromFilterCssProperties(e),n=0;n<r.length-1;n+=2)t[r[n]]=r[n+1];return t.rgba||t.rgb?(t.dropShadowColor=r[0]+"("+r[1]+")",delete t.rgba,delete t.rgb):t.dropShadowColor&&(t.dropShadowColor=r[1]+"("+r[2]+")"),t},mergeTransfromStyleProperties:function(e){for(var t=Object.keys(e),r="",n={},i=0;i<t.length;i++){var a=t[i];if(e[a]!==enums_1.default.TransformDefaultValue[a])if("rotateX"===a||"rotateY"===a||"rotateZ"===a||"skewX"===a||"skewY"===a)r=r+a+"("+e[a]+") ";else if("transform-origin-x"===a||"transform-origin-y"===a)n[a]=e[a];else if("rotate"===a){var o=e[a];"rad"===this.getUnitStyle(o)&&(o=this.toDegrees(parseFloat(o))+"deg"),r=r+a+"("+o+") "}else if("scaleX"!==a&&"scaleY"!==a||"Hummingbird"!==main_1.default.preferences.couiEnvironment)r=r+a+"("+e[a]+") ";else{var s=e.scaleX||1,l=e.scaleY||1;r.match(/scale/)||(r=r+"scale("+s+", "+l+") ")}}var u={basic:r.trim(),origin:""};return(n["transform-origin-x"]||n["transform-origin-y"])&&(u.origin=(n["transform-origin-x"]||"50%")+" "+(n["transform-origin-y"]||"50%")),u},isBackgroundPositionString:function(e){return e+="",-1!==["center","top","bottom","left","right"].indexOf(e)},convertJsToCssProperty:function(e){return e.split(/(?=[A-Z])/).map(function(e){return"webkit"===e&&(e="-"+e),e.toLowerCase()}).join("-")},convertCssToJsProperty:function(e){var t=this,r=e.split(/[-]/).map(function(e){return t.capitalizeFirstLetter(e)});return r[0]=r[0].toLowerCase(),r.join("")},_mapWidgets:function(e,t){var r=this;return t=t||{},e.map(function(e){var n=0;if(void 0!==e.children&&e.children.length>0&&(n=e.children.length),void 0===e.id&&(e.id=main_1.default.generateRandomId(e.type),main_1.default.widgetCount++),t[e.id]={widget:e},n>0)return r._mapWidgets(e.children,t)}),t},getStringPropertyPercent:function(e){var t;switch(e){case"left":case"top":t="0%";break;case"center":t="50%";break;case"right":case"bottom":t="100%";break;default:t=e}return t},getUnitStyle:function(e){var t=(e=""+e).match(/([a-zA-Z+%]+)/g);return t?t.length>1?t[t.length-1]:"top"===t[0]||"left"===t[0]||"right"===t[0]||"bottom"===t[0]||"center"===t[0]||"initial"===t[0]||"inherit"===t[0]||"rgba"===t[0]||"blur"===t[0]||"invert"===t[0]?"":this.isBackgroundPositionString(t[0])?"%":t[0]:""},getColorValue:function(e){var t=/rgb.+\)|#.+/;return e instanceof Array?e[0].match(t):e.match(t)[0]},getUnitValue:function(e){if("center"===e||"bottom"===e||"left"===e||"right"===e||"0"===e.toString())return e;if(void 0!==e&&-1===e.indexOf("rgb")&&-1===e.indexOf("rgba")&&-1===e.indexOf("blur")&&-1===e.indexOf("invert")&&(e=""+e,!isNaN(parseFloat(e))||0===e.indexOf("rotate")||0===e.indexOf("blur"))){var t=/[^a-zA-Z%-()]+/;if(e.match(t))return e.match(t)[0]}return""},isInputValidNumber:function(e){if(e){return/^-?\d*\.?\d*$/.test(e)}},patchInputNumberBehavior:function(e){var t,r=e.$this,n=e.currentWidget,i=e.propGroup,a=e.propKey;if(!0===this.isInputValidNumber(r.val()))t=r.val();else if(r.val()){if(!r.hasClass("units-number")||!r.val())return r.val();t=(t=parseFloat(n[i][a]).toFixed(1))||"",r.val(t)}else t=parseFloat(n[i][a]).toFixed(1);return t},cleanUrls:function(e){var t=e.replace(/^coui:\/\/(?:uiresources\/)|(!?editor\/)|^coui:\/\/(?:editor\/)/,"").replace(/editor\//,"");return t=t.replace(/^[^#]*?:\/\/.*?\/(.*)$/,"$1"),this.externalFilePathHandler(t,main_1.default.openFiles[main_1.default.selectedEditor].tab.filePath)},createLongPropertyGroup:function(e){if(""!==e.trim()){var t,r,n=/\(([^)]+)\)/,i=e.split(/ (?!\d)/),a={};for(var o in i)if(null!==(t=n.exec(i[o]))){r=i[o].split("(");var s=t[1];if("rotate"===r[0]||"rotateX"===r[0]||"rotateY"===r[0]||"rotateZ"===r[0]||"skewX"===r[0]||"skewY"===r[0])"rad"===this.getUnitStyle(s)&&(s=this.toDegrees(parseFloat(s))+"deg"),"rotate"===r[0]?a.rotateZ=s:a[r[0]]=s;else if("scale"===r[0]&&"Hummingbird"===main_1.default.preferences.couiEnvironment){var l=s.split(", ");a.scaleX=l[0],a.scaleY=l[1]}else a[r[0]]=s}return a}return{}},syncFiltersAnimations:function(e,t){var r=main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor,n=this.findNotAnimatedFiltersProperties(e,t);n.length>0&&(r.forceAutoKeyframes=!0,r._undoCreationStepsLength=n.length,n.map(function(t){var n=r.mappedWidgets[e].widget["-webkit-filter"][t];r.Animations.addKeyframe(e,"-webkit-filter",t,n,{offset:-4,seconds:0})}),r.forceAutoKeyframes=!1)},findNotAnimatedFiltersProperties:function(e,t){var r=main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor.scene.animations[e];if(!r)return[];var n=r[r.className].keyframes["-webkit-filter"];if(!n)return[];var i=[t];for(var a in n)a!==t&&i.push(a);var o=main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor.mappedWidgets[e].widget,s=[];for(var a in o["-webkit-filter"])s.push(a);return s.filter(function(e){return!i.includes(e)})},syncTransformAnimations:function(e,t){var r=main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor,n=this.findNotAnimatedTransformProperties(e,t);n.length>0&&(r.forceAutoKeyframes=!0,r._undoCreationStepsLength=n.length,n.map(function(t){var n=r.mappedWidgets[e].widget.transform[t];r.Animations.addKeyframe(e,"transform",t,n,{offset:-4,seconds:0})}),r.forceAutoKeyframes=!1)},findNotAnimatedTransformProperties:function(e,t){var r=main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor.scene.animations[e];if(!r)return[];var n=r[r.className].keyframes.transform;if(!n)return[];var i=[t];for(var a in n)a!==t&&i.push(a);var o=main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor.mappedWidgets[e].widget,s=[];for(var a in o.transform)s.push(a);return s.filter(function(e){return!i.includes(e)})},reorderTransform:function(e){var t=[];for(var r in e){t[r]=[];for(var n in enums_1.default.TransformsOrder)for(var i=0;i<e[r].length;i++)enums_1.default.TransformsOrder[n]===e[r][i].property&&t[r].push(e[r][i])}return t},createFilterPropertyGroup:function(e){var t=this.cleanFilterString(e),r=this.createLongPropertyGroup(t.clenedString);return $.extend(!0,r,t.dropShadowProps),r},modulateValue:function(e,t){return parseFloat(Math.cos(Math.PI*t).toFixed(2))*e},hasDropShadowProperty:function(e){return!!(e.dropShadowBlur||e.dropShadowColor||e.dropShadowX||e.dropShadowY)},cleanFilterString:function(e){var t=e,r=/(drop-shadow)(.*?\))(.*?\))/.exec(e),n={},i=[];if(null!==r){t=e.replace(r[0],"").trim();var a=r[3].length;")"!==r[3]?(r[3]=r[3].substr(0,a-1).trim(),i=r[3].split(" ")):i=this.dropShadowPropsFix(r[2]),n.dropShadowX=i[0],n.dropShadowY=i[1],n.dropShadowBlur=i[2];var o=this.getColorValue(r[2]);n.dropShadowColor=o}return{clenedString:t,dropShadowProps:n}},createBoxShadowPropertyGroup:function(e,t){var r={},n=["horizontalLength","verticalLength","blurRadius","spreadRadius","insetOutset"],i=t.split(" ");if(r.color=e+")",n.length!==i.length)for(var a=0;a<n.length;a++)r[n[a]]="insetOutset"===n[a]?"none":i[a];else for(var o=0;o<n.length;o++)r[n[o]]=i[o];return r},toDegrees:function(e){return e*(180/Math.PI)},toRadians:function(e){return e*(Math.PI/180)},getAnimationClassNames:function(e){for(var t=e.split(" "),r=main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor.scene.animationClasses,n=[],i=0;i<t.length;i++)r[t[i]]&&n.push(t[i]);return n[0]||""},doesClassNameExist:function(e,t){for(var r=e.split(" "),n=0;n<r.length;n++)if(r[n]===t)return!0;return!1},getAnimationClassesFromClassNames:function(e){for(var t=[],r=e.split(" "),n=main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor.scene.animationClasses,i=0;i<r.length;i++)n[r[i]]&&t.push(r[i]);return t},replaceAnimationName:function(e,t,r){if(!e)return r;var n=e.split(" ");if(""!==t)for(var i=0;i<n.length;i++)n[i]===t&&(n[i]=r);else this.doesClassNameExist(e,r)||n.push(r);return n.join(" ")},removeMoreThanOneAnimationClasses:function(e,t){var r=t.split(" ").filter(function(t){return e.indexOf(t)<0});return console.log(r),r.unshift(e[0]),r.join(" ")},exportJSON:function(){if(main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor.undoRedoScene("undo"),0===main_1.default.openFiles[main_1.default.selectedEditor].undo.length){var e={redo:main_1.default.openFiles[main_1.default.selectedEditor].redo,animationClasses:main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor.scene.animationClasses},t=JSON.stringify(e);main_1.default.onsave("*new0.html",t)}},moveWidget:function(e){if(e&&e.elementId&&e.moveDirection&&e.step&&void 0!==e.preserveUnits){var t,r,n,i,a=e.elementId,o=e.step,s=e.preserveUnits,l=main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor,u=l.mappedWidgets[a].widget;if(t="up"===e.moveDirection||"down"===e.moveDirection?"top":"left","down"!==e.moveDirection&&"right"!==e.moveDirection||(o*=-1),s)r=parseFloat(u.geometry[t]),"px"===(n=this.getUnitStyle(u.geometry[t]))&&(o*=10),i=(r-o).toFixed(1)+n,l._setGeometry(a,u,a,"geometry",t,i);else{var d=document.getElementById(a),c=document.body.querySelector('[data-widget-id="'+a+'"]'),f=d.offsetTop,p=d.offsetLeft;"top"===t?(d.style[t]=f-o+"px",c.style[t]=f-o+"px"):(d.style[t]=p-o+"px",c.style[t]=p-o+"px"),l.onInteractEnd(document.getElementById(a))}}},biggerClosest:function(e,t){for(var r=e.sort(function(e,t){return e-t})[e.length-1]||0,n=0;n<e.length;n++)e[n]>t&&e[n]<r&&(r=e[n]);return r},smallerClosest:function(e,t){for(var r=e.sort(function(e,t){return e-t})[0]||0,n=0;n<e.length;n++)e[n]<t&&e[n]>r&&(r=e[n]);return r},removeDuplicates:function(e){var t=[];return $.each(e,function(e,r){-1===$.inArray(r,t)&&t.push(r)}),t},countDecimals:function(e){var t=e.split(".")[1];return t?t.length:0},getFileAndPath:function(e){return{path:e.replace(/[^\/\\]*$/,"").replace(/'|"/gi,""),filename:e.replace(/^.*[\\\/]/,"").replace(/'|"/gi,"")}},pathHandler:function(e,t,r){var n=r.replace("coui://uiresources/","").replace(/(\/\/+)/g,"/"),i=e.replace("coui://uiresources/",""),a=t.replace(/\\/g,"/"),o=new RegExp("^"+a);if(i.match(o))n=n.replace(a,"").replace(/[^\/\\]*$/,"");else for(var s=a.split("/"),l=i.split("/"),u=l.length,d=0,c=0;c<u;c++){if(s[0]!==l[0]){n="../".repeat(d||s.length-1)+l.join("/");break}s[0]===l[0]&&(l=l.slice(c+1),s=s.slice(c+1),d++)}return n},pathChanger:function(e){var t=e.regGroup;if(e.regGroup.match(/\.\.\//)){var r=e.regGroup.split("../").length-1,n=e.path.split("/"),i=e.path.split("/").slice(0,r).join("/");e.regGroup=e.regGroup.split("../").join("").replace(/'/g,""),t=n.length-1===r?e.regGroup:i+"/"+e.regGroup}else e.regGroup=e.regGroup.replace(/'/g,""),t=""+e.path+e.regGroup;return e.isResponsive?main_1.default.globalEditorInfo.backend===enums_1.default.Backends.Debug||main_1.default.globalEditorInfo.backend===enums_1.default.Backends.Website?"url('uiresources/"+t+"')":"url('coui://uiresources/"+t+"')":e.isFont?"'"+t+"'":'src="'+t+'"'},openPathHandler:function(e,t){var r=this,n=e.split('<script class="global-events">'),i=n[0].replace(/(background-image|src|mask-image|-webkit-mask): url\((.*?)\)/gi,function(e,n,i){if(e.match(/&quot;/))return e;var a=i.replace(/'/g,""),o=a.split(".").pop();return o===enums_1.default.extensions.ttf||o===enums_1.default.extensions.ttf?n+": "+r.pathChanger({regGroup:a,path:t,isFont:!0}):n+": "+r.pathChanger({regGroup:a,path:t,isResponsive:!0})}).replace(/src="(.*?)"/gi,function(e,n){return n.split(".").pop()===enums_1.default.extensions.js?r.jsFileHandler(n,t):r.pathChanger({regGroup:n,path:t})}).replace(/<link.*href="([coui:\/\/]|.*?)">/gi,function(e,n){return'<link rel="stylesheet" type="text/css" class="styles" href="'+r.assetPathHandler(n,t)+'">'});return n[1]?i+'<script class="global-events">'+n[1]:i},rootFolder:function(e){return e.split(/[\/\\]/)[0]},externalFilePathHandler:function(e,t){var r=e.replace("!css",""),n=t.replace(/\\/g,"/"),i=this.getFileAndPath(e).path,a=this.getFileAndPath(e).filename,o=new RegExp("^"+n),s=i.split("/"),l=n.split("/"),u=l.length,d=0;if(i.match(o))r=r.replace(t,"");else for(var c=0;c<u;c++){if(l[c]!==s[c]){r="../".repeat(d||l.length-1)+s.join("/")+a;break}l[c]===s[c]&&(s=s.slice(c+1),l=l.slice(c+1),d++)}return r},checkFilePaths:function(e,t,r){for(var n=e.replace(/\?+.*/,""),i=t.replace(/\?+.*/,""),a=e.replace(/[^\/\\]*$/,"").split("../").length-1,o=r.split("/").slice(0,-1),s=0;s<a;s++)o=o.slice(0,-1);return""===o.join("/")?n.replace(/\.\.\//g,"")===i:o.join("/")+"/"+n.replace(/\.\.\//g,"")===i},buildPublishPage:function(e,t){function r(e){$(e).each(function(e,a){if(a.attributes&&a.hasAttribute("style")){var o=a.getAttribute("style"),s="coui-style-"+i;a.removeAttribute("style"),a.removeAttribute("data-type"),a.removeAttribute("data-element-type"),a.removeAttribute("data-element-selectable"),i++,a.classList.add(s);var l=o;"Hummingbird"===t&&(l=(l=(l=(l=(l=l.replace(/(?:flex-flow:|-webkit-flex-flow:)(.*?);/gm,function(e,t){var r=t.trim().split(" ");return"flex-direction: "+r[0]+";"+" "+("flex-wrap: "+r[1]+";")})).replaceAll("inline-block","block")).replaceAll(" -webkit-user-select: none;","")).replaceAll("-webkit-","")).replace(/.mask:.*?;/gm,function(e){var t=" mask-image: ";return t+=e.match(/url\(.*?\)/)[0]+"; mask-position: ",t+=e.match(/\).*?\//)[0].replace(") ","").replace(" /","")+"; mask-repeat: ",t+=e.match(/(repeat|no-repeat).*?;/)[0]})),l=l.replaceAll(";",";\n"),n+="."+s+" {\n "+l+" }\n"}a.childNodes.length>0&&r(a.childNodes)})}var n="",i=0;return r(e),{cleanedHTML:e.innerHTML,css:n}},jsFileHandler:function(e,t){return'src="'+this.assetPathHandler(e,t)+'"'},assetPathHandler:function(e,t){for(var r=this.getFileAndPath(e).path.match(/(\.\.\/)/g),n=r?r.length:0,i=t.split("/").filter(Boolean),a=0;a<n;a++)i.length>0&&(i=i.slice(0,-1));return i.length>0?i.join("/")+"/"+e.replace(/\.\.\//g,""):e.replace(/\.\.\//g,"")},removeSlashes:function(e){var t=[];return t[0]=e[0].split("/").join(""),t[1]=e[1].split("\\").join(""),t},getTextSelection:function(e){return{start:e.selectionStart,end:e.selectionEnd}},cleanBackgroundUrls:function(e){try{var t=e.match(/\(([\s\S]*)\)/)[1].replace("'","");if(t.length>20){var r=t.length;return"..."+(t=t.substring(r-20,r))}return t}catch(t){return e}},disableKendoInput:function(e){$('input[data-property-key="'+e+'"]').attr("disabled",!0),$('input[data-property-key="'+e+'"]').val(0)},enableKendoInput:function(e){$('input[data-property-key="'+e+'"]').attr("disabled",!1)},buildFontCss:function(e){return"@font-face {\n\tfont-family: "+e.replace(/\.[^/.]+$/,"").replace(/^.*[\\\/]/,"")+";\n\tsrc: url("+e+");\n}\n"},fontIsPresent:function(e,t){return t.map(function(e){return e.replace(/\.[^/.]+$/,"").replace(/^.*[\\\/]/,"")}).concat(["inherit"]).includes(e)},transformMaskSize:function(e){var t=e.split(": ")[0],r=e.split(": ")[1].replace(";","");return"auto"!==r&&(r=this.maskSizeFormat(r)),t+": "+r+";"},maskSizeFormat:function(e){return e.match(/\s/g)||"contain"===e||"cover"===e||"inherit"===e?e:e+" "+e},getHBScaleProperties:function(e){return(e.transform.scaleX||1)+", "+(e.transform.scaleY||1)},getWidgetComplexProp:function(e,t,r,n){return e[r]?e[r][t]||n:n},getWidgetState:function(e,t,r){var n;if(["styles","geometry"].includes(r))return e[r][t];if("-webkit-filter"===r)return this.getWidgetComplexProp(e,t,r,enums_1.default["-webkit-filterDefaultValues"][t]);if("transform"===r)return this.getWidgetComplexProp(e,t,r,enums_1.default.TransformDefaultValue[t]);if("transform-origin"===r)return this.getWidgetComplexProp(e,t,r,0);if("dataBindings"===r)return t=this.translateDataBindNames(t,!1),this.getWidgetComplexProp(e,t,r,"");switch(t){case"id":n=e.id;break;case"className":n=e.className;break;case"data-l10n-id":n=e.attrs["data-l10n-id"];break;case"src":"attrs"===r&&(n=e.attrs.src);break;case"min":case"max":case"value":case"step":"attrs"===r&&(n=e.attrs[t]);break;case"placeHolder":n=e.attrs.placeHolder;break;default:n=""}return n},isComponent:function(e){return!!e.widgetkit&&"component"===/(?:\.([^.]+))?$/.exec(e.widgetkit)[1]}};