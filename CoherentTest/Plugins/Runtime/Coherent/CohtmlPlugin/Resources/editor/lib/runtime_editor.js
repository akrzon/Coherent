"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var filters_config_1=require("./common/filters_config"),enums_1=require("./enums"),flexbox_1=require("./flexbox"),runtime_1=require("./runtime"),drag_element_1=require("./drag_element"),main_1=require("../scripts/main"),function_helpers_1=require("./function_helpers"),scene_1=require("../scripts/scene/scene"),runtime_2=require("./animations/runtime"),editor_settings_1=require("./editor_settings"),widget_selection_1=require("./widget_selection"),vexConfirm_1=require("./common/vexConfirm"),editor_properties_1=require("./editor_properties"),build_widget_settings_1=require("./build_widget_settings"),styleValuesCollector_1=require("./styleValuesCollector"),units_conversion_1=require("../scripts/helpers/units_conversion"),allowedKeyframeProperies_1=require("./allowedKeyframeProperies"),interact_1=require("./interact"),transform_1=require("./transform"),virtual_list_1=require("./modules/virtual_list/virtual-list"),input_type_validations_1=require("./configs/input_type_validations"),validator_1=require("./modules/validation/validator"),helpers_1=require("./modules/virtual_list/helpers"),search_1=require("./modules/search/search"),search_helpers=require("./modules/search/helpers"),sorter_1=require("./modules/asset_sorter/sorter"),sort_helpers=require("./modules/asset_sorter/helpers"),utils_1=require("./common/utils"),widgetHbs=require("lib/hbs/widget_list.hbs!text"),AssetsHbs=require("lib/hbs/assets_list.hbs!text"),editingMenuHbs=require("lib/hbs/editing_menu.hbs!text"),propertiesHbs=require("lib/hbs/widget_properties.hbs!text"),textPropertiesHbs=require("lib/hbs/text_properties.hbs!text"),backgroundPropertiesHbs=require("lib/hbs/background_properties.hbs!text"),dataBindingPropertiesHbs=require("lib/hbs/data_binding_properties.hbs!text"),eventsPropertiesHbs=require("lib/hbs/events_properties.hbs!text"),geometryPropertiesHbs=require("lib/hbs/geometry_properties.hbs!text"),transformPropertiesHbs=require("lib/hbs/transform_properties.hbs!text"),borderStylePropertiesHbs=require("lib/hbs/border_style_properties.hbs!text"),blendModesHbs=require("lib/hbs/blend_modes.hbs!text"),scenePropertiesHbs=require("templates/editor/scene_properties.hbs!text"),fontFamilyTemplate=require("lib/hbs/templates/fontFamilyOption.hbs!text"),selectedFontFamily=require("lib/hbs/templates/selectedFontFamily.hbs!text"),redoLenCommands=0,undoLenCommands=0,commandUndo=[],commandRedo=[],redoLenCount=1,undoLenCount=1,Interact=interact_1.default.Interact,RuntimeEditor=function(){function RuntimeEditor(){var e=this;this.transform=new transform_1.default,this.forceAutoKeyframes=!1,this.runtimeBuildDropShodowFilter=function_helpers_1.default.getBoxShodowDefaults(),this.equalProportion=!1,this.TEMPLATE_CACHE={get:function(e){this.templates||(this.templates={});var t=this.templates[e];return t||(t=document.getElementById(e),this.templates[e]=t),t},set:function(e,t){this.templates||(this.templates={}),this.templates[e]&&(this.templates[t]=this.templates[e],delete this.templates[e])}},this.flexBoxHolder=flexbox_1.default,this.widgets=runtime_1.default.factories,this.scenePreviewEl=document.getElementById("scene"),this.sceneBorderSize=3,this.styleValuesCollector=styleValuesCollector_1.default,this.currentElementsSelection=[],this.isInPanningMode=!1,this.currentParentElementsSelection=[],this.selectedKeyframes=[],this._undoCreationStepsLength=1,this._lastDeletedAnimationWidgets={},this.currentWrappedSelectionSize={top:0,left:0,right:0,bottom:0},this.sceneAssetSelected=!1,this.scene=new scene_1.default,this.virtualList=new virtual_list_1.default,this.inputValidator=new validator_1.default(input_type_validations_1.configuration,input_type_validations_1.nonValidatedElements),this.inputSearch=new search_1.default,this.assetSorter=new sorter_1.default,this.activeFilterButtons=[],this.totalAssetTypes=6,this.elementReposition=!1,this._skipUndoRedoSteps=0,this.totalAnimationTime=0,this.WidgetSelection=new widget_selection_1.default.WidgetSelection,this.mappedWidgets={},this.sceneAssetPreviewImage=$("#assets-preview-image"),this.sceneAssetPreviewVideo=$("#assets-preview-video"),this.sceneAssetPreviewWidget=$("#assets-preview-widget"),this.sceneAssetPreviewStandin=$("#assets-preview-standin"),this.sceneAssetPreviewWindow=$("#assets-preview-window"),this.widgetsEl=$("#widgets-list"),this.propertiesElBar=$("#properties-bar"),this.scenePropertiesElBar=$("#scene-properties"),this.contextMenuEl=$("#context-menu"),this.assetsBarContent=$("#assets-bar-content"),this.assetsLibraryHolder=$(".scene-library-holder"),this.assetsHierarchyHolder=$(".scene-hierarchy-holder"),this.scenePropertiesHolder=$(".scene-properties-holder"),this.rightPanel=$("#right-pane"),this.sceneWrapper=$("#scene-wrapper"),this._isElementRotated=!1,this.scene.widgets.map(function(t){e.mappedWidgets[t.id]={widget:t}}),this._sceneClickingState={draggingCreation:!1},this.editorTabName="",this.draggedElement="",this._openedFile=null,this._pickedAsset=null,this.autoKeyframe=!1,this.repeatAnimation=!1,this._sceneActionState={initialLoad:!0,initialCreationOfWidgetByExternalFile:!1,primaryAction:"new action",createElement:!1,deleteElement:!1,createComponent:!1,deleteComponent:!1,widgetOption:!1,addFile:!1,deleteFile:!1,draggingTimelinePin:!1,elementWasInserted:!1,addKeyframe:!1,deleteKeyframe:!1,moveKeyframe:!1,keyframeInitial:!1,setAnimationOptions:!1,createNewWidget:!1,pasteWidget:!1,hierarchyElementMove:!1,switchAnimationClass:!1,deleteAnimationClassGlobal:!1,addAnimationClassGlobal:!1,editAnimationClass:null,insertMaskImage:!1,moveElement:!1,initialComponent:!1},this.tab=main_1.default.openFiles[main_1.default.selectedEditor].tab,this.tab.snapOn=!1,this.interactElementsState="resize",this.pendingTransformOriginPoint=!1,this._dragFlag=!1,this.timeline={},this.formatTo=1,this.shouldEnableFont=!1}return RuntimeEditor.prototype.switchAutoKeyframe=function(){this.autoKeyframe?this.autoKeyframe=!1:this.autoKeyframe=!0},RuntimeEditor.prototype.switchRepeatAnimation=function(){this.repeatAnimation?this.repeatAnimation=!1:this.repeatAnimation=!0},RuntimeEditor.prototype.findParentElementsSelection=function(e){for(var t=e,i=0;i<e.length;i++){var n=document.getElementById(e[i]);if(null!==n)for(;"scene"!==n.parentElement.id;){for(var o=0;o<e.length;o++)n.parentElement.id===e[o]&&(t[i]=null);n=n.parentElement}}return t},RuntimeEditor.prototype._assetChosenHandler=function(){var e=this;engine.off("AssetChosen"),engine.on("AssetChosen",function(t,i,n){""===t&&"image"!==n&&"video"!==n||(e._sceneActionState.primaryAction="new action",e.sceneAssetSelected?e.sceneAssetChosen(t,n):(e.assetChosen(t,i,n),e.sceneAssetChosen(t,n))),e._sceneActionState.initialCreationOfWidgetByExternalFile=!1,e._sceneActionState.insertMaskImage=!1})},RuntimeEditor.prototype.insertImage=function(e,t){main_1.default.openFiles[main_1.default.selectedEditor].tab.filePath.replace(/\\/g,"/");var i=$("#"+e),n=i.attr("data-type"),o=t.replace("uiresources/","").replace(/ /g,"%20");o=o.replace(/url\((.*?)\)/gi,function(e,t){return t}),main_1.default.globalEditorInfo.backend!==enums_1.default.Backends.Debug&&main_1.default.globalEditorInfo.backend!==enums_1.default.Backends.Website||(o="uiresources/"+o);var r;this._sceneActionState.insertMaskImage?(r=""!==t?"url("+o+")":"",i.css("webkit-mask-image",r),this.applyUploadedImage(i,e,o,n)):"image"===n?(i.attr("src",o),this.applyUploadedImage(i,e,o,n)):"responsiveImage"===n?(r="url("+o+")",i.css("background-image",r),this.applyUploadedImage(i,e,o,n)):(r="url("+o+")",i.css("background",r),this.saveProperties(e,"css property","background",r),this.renderProperties(this.mappedWidgets[e].widget))},RuntimeEditor.prototype.applyUploadedImage=function(e,t,i,n){var o=this,r=new Image;r.src=i;var s=this.mappedWidgets[t].widget,a=function_helpers_1.default.isfirstUpload(n,s);if(a)this._sceneActionState.insertMaskImage?(this.saveProperties(t,"styles","webkitMaskImage","url("+i+")"),s.styles.webkitMaskImage="url("+i+")"):"responsiveImage"===n?(this._skipUndoRedoSteps=3,this.saveProperties(t,"image","backgroundImage","url("+i+")"),s.styles.backgroundImage="url("+i+")"):"image"===n&&(this._skipUndoRedoSteps=3,this.saveProperties(t,"image","url",i),s.url=i);else if(this._sceneActionState.insertMaskImage){var d=""!==i?"url("+i+")":" ";this.saveProperties(t,"styles","webkitMaskImage",d),s.styles.webkitMaskImage=d," "===d?this.updateBackgroundFilePathInfo("hide"):this.updateBackgroundFilePathInfo("show",d)}else"responsiveImage"===n?(this.saveProperties(t,"image","backgroundImage",s.styles.backgroundImage),s.styles.backgroundImage="url("+i+")",this._skipUndoRedoSteps=2):"image"===n&&(this.saveProperties(t,"image","url",s.url),s.url=i,this._skipUndoRedoSteps=2);o._sceneActionState.insertMaskImage||(r.onload=function(){var i,n,d=r.naturalWidth,l=r.naturalHeight;if(a)i=units_conversion_1.default.convertPixelToVw(d)+"vw",n=units_conversion_1.default.convertPixelToVh(l)+"vh";else{var p=function_helpers_1.default.getUnitStyle(s.geometry.width),c=function_helpers_1.default.getUnitStyle(s.geometry.height);"auto"!==p?i=units_conversion_1.default.convertPixelToUnit(t,d,p,"width"):(i=units_conversion_1.default.convertPixelToVw(d)+"vw",o._setProperties(s,null,"units","width","vw")),"auto"!==c?n=units_conversion_1.default.convertPixelToUnit(t,l,c,"width"):(n=units_conversion_1.default.convertPixelToVh(l)+"vh",o._setProperties(s,null,"units","height","vh"))}o._setGeometry(e,s,t,"geometry","width",i),o._setGeometry(e,s,t,"geometry","height",n),o.clearSelectedElements(),o.selectJstreeItem(t),r=null}),this._sceneActionState.insertMaskImage=!1},RuntimeEditor.prototype.insertVideo=function(e,t){var i=$("#"+e),n=this,o=n.mappedWidgets[e].widget;i.attr("src",t),this.displayVideo(i),i.on("loadedmetadata",function(){var r=this.videoWidth+"px",s=this.videoHeight+"px";n.saveProperties(e,"css property","url",t),n._skipUndoRedoSteps=2,n._setGeometry(i,o,e,"geometry","width",r),n._setGeometry(i,o,e,"geometry","height",s),n.clearSelectedElements(),n.selectJstreeItem(e)})},RuntimeEditor.prototype._toScene=function(e,t,i){var n,o=e.replace("uiresources/",""),r=new Date;"style"===t?(o=o+"?"+r.getTime(),n=!0,t="styles"):"font"===t?(t="fonts",n=!0):t="scripts";var s=main_1.default.selectedEditor,a=this.scene[t];if(i)a.push(o),n&&main_1.default.rebuildRuntimeEditor(this.scene,this.scene.animations,this.tab.filename,s),"scripts"===t&&this.exportScene("file");else for(var d=0;d<this.scene[t].length;d++){var l=a[d].replace(/\?.*/,"");if("scripts"===t&&a[d]===o)a.splice(d,1),this.exportScene("file");else if("scripts"!==t&&l===o.replace(/\?.*/,"")){if(a.splice(d,1),n&&main_1.default.rebuildRuntimeEditor(this.scene,this.scene.animations,this.tab.filename,s),"fonts"===t){var p=e.replace(/\.[^/.]+$/,"").replace(/^.*[\\\/]/,""),c=this._getElementsWithFont(this.mappedWidgets,p);this._resetFontFamily(c)}return}}},RuntimeEditor.prototype.sceneAssetChosen=function(e,t){for(var i=e.replace("uiresources/","").replace(/\//gm,"\\"),n=main_1.default.assets[t],o=e.replace("uiresources/",""),r=!1,s=0;s<n.length;s++)n[s].url===o&&(r=!0);if(r||""===e)this.sceneAssetSelected||""===e?""!==e&&vex.dialog.alert({closeOnOverlayClick:!0,contentClassName:"modal-about",message:"Selected asset is already in the assets panel!"}):(this.assetsBarContent[0].style.height="150px",document.body.dispatchEvent(new CustomEvent("coui.editor.rebuild")),this._initAssetsKendoToolbar(),this._switchPreviewWindow(e,t));else{var a=[{__Type:t,isFile:!0,name:i,url:o}];main_1.default.updateSceneAssets(a),this.assetsBarContent[0].style.height="150px",document.body.dispatchEvent(new CustomEvent("coui.editor.rebuild")),this._initAssetsKendoToolbar(),this._switchPreviewWindow(e,t)}"font"===t&&this.shouldEnableFont&&this._toScene(e,t,!0),this.sceneAssetSelected=!1,this.shouldEnableFont=!1},RuntimeEditor.prototype.createAssetDOM=function(e){var t=main_1.default.openFiles[this.editorTabName].tab.tabWidgetState.editWidget,i={isWidget:t,assets:[]};return i.assets=i.assets.concat(e.image,e.video),t||(i.assets=i.assets.concat(e.widget,e.sound,e.script,e.style,e.font)),{template:main_1.default.Handlebars.compile(AssetsHbs)(i),total:i.assets.length}},RuntimeEditor.prototype._initAssetsKendoToolbar=function(){var e=this,t=this;this.assetsBarContent.data("kendoPanelBar")&&this.assetsBarContent.data("kendoPanelBar").destroy(),this.assetsBarContent.empty();var i=this.createAssetDOM(main_1.default.assets);this.assetsDOM=helpers_1.createVDOM(i.template),this.filteredAssetDOM=this.assetsDOM;var n={scroller:$("#assets-bar-holder"),total:i.total+this.totalAssetTypes,buffer:4,itemHeight:34};this._attachLibraryClickEvent();var o=function(t){e.virtualList.updateDOM(t.detail)},r=function(t){e.activeFilterButtons=sort_helpers.getActiveSortButtons(),e.filteredAssetDOM=e.activeFilterButtons.length?t.detail:e.assetsDOM,e.inputSearch.getInput()?e.inputSearch.trigger("input"):e.virtualList.updateDOM(t.detail)},s=function(e){document.body.removeEventListener("coui.assets.search",o),document.body.removeEventListener("coui.assets.filter",r),document.body.removeEventListener("coui.editor.rebuild",l),document.body.removeEventListener("coui.editor.rebuild",s),t.assetSorter.stopListening("click",a),t.inputSearch.stopListening("input",d)},a=function(t){utils_1.dispatch("coui.assets.filter",sort_helpers.onClickFilter(t,e.assetsDOM))},d=function(t){utils_1.dispatch("coui.assets.search",search_helpers.assetSearch(t,e.filteredAssetDOM))},l=function(){var e=JSON.parse(localStorage.getItem(t.editorTabName));if(e){var i=JSON.stringify(Object.assign(e,{assetSearchValue:t.inputSearch.getInput(),activeFilters:t.activeFilterButtons}));localStorage.setItem(t.editorTabName,i)}};this.inputSearch.init(document.getElementById("asset-search")).listen("input",d).listen("click",function(t){e.inputSearch.reset(),e.inputSearch.trigger("input")},document.getElementById("asset-search-clear")).listen("coui.editor.rebuild",l,document.body).focusout(document.getElementById("assets-bar-holder")),this.virtualList.init(this.assetsBarContent,n,this.assetsDOM).listen("coui.assets.search",o).listen("coui.assets.filter",r).listen("coui.editor.rebuild",s),this.assetSorter.init().listen("click",a);var p=JSON.parse(localStorage.getItem(t.editorTabName)).assetSearchValue,c=JSON.parse(localStorage.getItem(t.editorTabName)).activeFilters;p&&(this.inputSearch.input.value=p,this.inputSearch.trigger("input")),c&&(this.activeFilterButtons=c,sort_helpers.applyActive(this.activeFilterButtons),utils_1.dispatch("coui.assets.filter",sort_helpers.filterVDOM(this.activeFilterButtons,this.assetsDOM)))},RuntimeEditor.prototype.assetChosen=function(e,t,i,n){if(0!==e.length){main_1.default.globalEditorInfo.backend!==enums_1.default.Backends.Standalone&&main_1.default.globalEditorInfo.backend!==enums_1.default.Backends["Standalone-2"]&&main_1.default.globalEditorInfo.backend!==enums_1.default.Backends.Unreal||(e=e.replace("uiresources/",""));var o=n||this._pickedAsset;if(main_1.default.reloadedRuntimeEditor++,"image"===i)this._sceneActionState.elementWasInserted=!0,this.insertImage(t,e);else{if("video"!==i){var r={},s=this.getRedoUndoPrimaryState();return this._sceneActionState.addFile=!0,"style"===i&&(this._toScene(e,"style",!0),r.index=this.scene.styles.length-1),"script"!==o&&"scripts"!==o&&"events"!==o||(this._toScene(e,"script",!0),r.index=this.scene[o].length-1),r.url=e,r.type=o,this.createUndoRedoCommand(s,t,null,null,null,r),void this.exportScene("file")}this._sceneActionState.elementWasInserted=!0,this.insertVideo(t,e)}main_1.default.openFiles[this.editorTabName].tab.tabWidgetState.editWidget&&this.placeWidgetOnScene(t)}else this._sceneActionState.initialCreationOfWidgetByExternalFile&&this.removeWidget(t)},RuntimeEditor.prototype.setOpenedFile=function(e){this._openedFile=e},RuntimeEditor.prototype.jstreeDNDHandler=function(){var e=this;$(document).on("dnd_start.vakata",function(){e._sceneActionState.primaryAction="new action"})},RuntimeEditor.prototype.getOpenedFile=function(){return this._openedFile},RuntimeEditor.prototype.calcWrappedSelection=function(e){for(var t=0;t<e.length;t++){var i=e[t],n=document.getElementById(i.id),o=this.getWidgetBoundingRect(n),r=this.getSelectionSize();o.top<r.top&&(this.currentWrappedSelectionSize.top=o.top),o.left<r.left&&(this.currentWrappedSelectionSize.left=o.left),o.right>r.right&&(this.currentWrappedSelectionSize.right=o.right),o.bottom>r.bottom&&(this.currentWrappedSelectionSize.bottom=o.bottom),0!==i.children.length&&this.calcWrappedSelection(i.children)}},RuntimeEditor.prototype.getWidgetBoundingRect=function(e){var t=e.getBoundingClientRect(),i=this.tab.sceneTransformMatrix[0];return{top:t.top/i,left:t.left/i,right:t.right/i,bottom:t.bottom/i}},RuntimeEditor.prototype.transferAnimations=function(e,t,i){for(var n={},o=0;o<t.length;o++)if(e.animations[t[o].id]){var r=e.animations[t[o].id].className;n[r]=e.animationClasses[r],n[r].belongTo=i}return $.extend(!0,{},n)},RuntimeEditor.prototype.getWidgetElementSelectionSize=function(e,t){var i=document.getElementById(e[0].id),n=this.getWidgetBoundingRect(i);this.currentWrappedSelectionSize=n,this.calcWrappedSelection(e);for(var o=$("#scene").offset(),r=this.tab.sceneTransformMatrix[0],s=this.currentWrappedSelectionSize.top-o.top/r-this.sceneBorderSize,a=this.currentWrappedSelectionSize.left-o.left/r-this.sceneBorderSize,d=this.currentWrappedSelectionSize.right-this.currentWrappedSelectionSize.left,l=this.currentWrappedSelectionSize.bottom-this.currentWrappedSelectionSize.top,p=e.length,c=0;c<p;c++){var u=e[c],m=u.geometry.left,h=u.geometry.top,f=function_helpers_1.default.getUnitStyle(h),g=function_helpers_1.default.getUnitStyle(m),v=function_helpers_1.default.getUnitStyle(u.geometry.width),y=function_helpers_1.default.getUnitStyle(u.geometry.height),_=units_conversion_1.default.convertPixelToUnit(u.id,s,f,"top"),b=units_conversion_1.default.convertPixelToUnit(u.id,a,g,"left");_=parseFloat(_),b=parseFloat(b);var k=parseFloat(m),w=parseFloat(h),S=document.getElementById(u.id);t?this.convertAllWidgetsGeometryToPercent(u,d,l,s,a):(u.geometry.top="%"===f?this.convertWidgetPositionTopToPercent(S,l,s):w-_+f,u.geometry.left="%"===g?this.convertWidgetPositionLeftToPercent(S,d,a):k-b+g,"%"===v&&(u.geometry.width=this.convertWidgetWidthToPercent(S,d)),"%"===y&&(u.geometry.height=this.convertWidgetHeightToPercent(S,l)))}return{position:"absolute",top:s.toFixed()+"px",left:a.toFixed()+"px",width:d.toFixed()+"px",height:l.toFixed()+"px"}},RuntimeEditor.prototype.convertWidgetPositionLeftToPercent=function(e,t,i){var n=function_helpers_1.default.getAbsolutePosition(e,$(e).parent().attr("id")).left-i;return units_conversion_1.default.convertPixelToPercent(n,t)+"%"},RuntimeEditor.prototype.convertWidgetPositionTopToPercent=function(e,t,i){var n=function_helpers_1.default.getAbsolutePosition(e,$(e).parent().attr("id")).top-i;return units_conversion_1.default.convertPixelToPercent(n,t)+"%"},RuntimeEditor.prototype.convertWidgetWidthToPercent=function(e,t){var i=parseFloat(getComputedStyle(e,null).getPropertyValue("width"));return units_conversion_1.default.convertPixelToPercent(i,t)+"%"},RuntimeEditor.prototype.convertWidgetHeightToPercent=function(e,t){var i=parseFloat(getComputedStyle(e,null).getPropertyValue("height"));return units_conversion_1.default.convertPixelToPercent(i,t)+"%"},RuntimeEditor.prototype.convertAllWidgetsGeometryToPercent=function(e,t,i,n,o){var r=document.getElementById(e.id),s=parseFloat(getComputedStyle(r,null).getPropertyValue("width")),a=parseFloat(getComputedStyle(r,null).getPropertyValue("height")),d=units_conversion_1.default.convertPixelToPercent(s,t),l=units_conversion_1.default.convertPixelToPercent(a,i),p=function_helpers_1.default.getAbsolutePosition(r,$(r).parent().attr("id")),c=p.top-n,u=p.left-o,m=units_conversion_1.default.convertPixelToPercent(c,i),h=units_conversion_1.default.convertPixelToPercent(u,t);e.geometry.width=d+"%",e.geometry.height=l+"%",e.geometry.top=m+"%",e.geometry.left=h+"%";for(var f=this.tab.sceneTransformMatrix[0],g=p.top-r.offsetTop/f-this.sceneBorderSize,v=p.left-r.offsetLeft/f-this.sceneBorderSize,y=0;y<e.children.length;y++)this.convertAllWidgetsGeometryToPercent(e.children[y],s,a,g,v)},RuntimeEditor.prototype.getSelectionSize=function(){return this.currentWrappedSelectionSize},RuntimeEditor.prototype.init=function(e,t,i){var n=this,o=this;this.editorTabName=i,this.widgetsEl.empty();var r=main_1.default.Handlebars.compile(widgetHbs)(editor_properties_1.default[main_1.default.preferences.couiEnvironment].Elements);this.templateProperties=main_1.default.Handlebars.compile(propertiesHbs),this.templateTextProperties=main_1.default.Handlebars.compile(textPropertiesHbs),this.templateBackgroundProperties=main_1.default.Handlebars.compile(backgroundPropertiesHbs),this.templateDataBindingEvents=main_1.default.Handlebars.compile(dataBindingPropertiesHbs),this.templateEventsProperties=main_1.default.Handlebars.compile(eventsPropertiesHbs),this.templateGeometryProperties=main_1.default.Handlebars.compile(geometryPropertiesHbs),this.templateTransformProperties=main_1.default.Handlebars.compile(transformPropertiesHbs),this.templateBorderStyleProperties=main_1.default.Handlebars.compile(borderStylePropertiesHbs),this.templateBlendModes=main_1.default.Handlebars.compile(blendModesHbs),this.widgetsEl.append(r),$("#create-element-tabs").kendoTabStrip({animation:{open:{effects:"none"}}}),this.widgetsEl.kendoPanelBar({animation:"none"}),this.Animations=new runtime_2.default,this.Animations.init(this);var s=$("#right-pane-content");if(s.kendoPanelBar({animation:"none",collapse:function(e){n.recalculateAssetsLibraryHeight(e)},activate:function(e){n.recalculateAssetsLibraryHeight(e,!0)}}),s.off("mousewheel"),s.on("mousewheel",function(){o.sceneAssetPreviewStandin.css("transform","rotate(360deg)")}),void 0!==e){var a;"string"==typeof e?a=JSON.parse(e):(t&&"string"==typeof t&&(e.animations=this.Animations.importCSS(t)||{}),a=e),this.loadScene(a)}else this._sceneJsTree([]);this.scenePropertiesElBar.empty();var d=main_1.default.Handlebars.compile(scenePropertiesHbs)(this.scene);this.scenePropertiesElBar.append(d).kendoPanelBar({animation:"none"}),this.contextMenuEl.empty();var l=main_1.default.Handlebars.compile(editingMenuHbs)(this.scene);this.contextMenuEl.append(l),this._setRightClickHandling(!0),this._addWidgetHandler(),this._removeFilesHandler(),this._openFileToEditHandler(),this._assetChosenHandler(),this._disableMaskEvents(),this._customAspectRationHandler(),this.WidgetSelection.init(),this.WidgetSelection.attachHandlers(),this.importExternalCSS(this.scene.styles),this.importFontFaces(this.scene.fonts),this.clearSelectedElements(),this.recalculateAssetsLibraryHeight(null,!0)},RuntimeEditor.prototype.recalculateAssetsLibraryHeight=function(e,t){void 0===t&&(t=!1);var i,n=this.scenePropertiesHolder.height(),o=this.assetsHierarchyHolder.height(),r=this.rightPanel.height();if(t?i=r-(n+o):(null!==e&&e.item.classList.contains("scene-properties-holder")?n=enums_1.default.assetsLibraryLabelSize:o=enums_1.default.assetsLibraryLabelSize,i=r-(n+o)),!$("#assets-bar").is(":visible")||!t&&null!==e&&e.item.classList.contains("scene-library-holder"))this.assetsLibraryHolder.css("height",enums_1.default.assetsLibraryLabelSize);else{i=i<enums_1.default.assetLabelsEntryHeight?enums_1.default.assetLabelsEntryHeight:i,this.assetsLibraryHolder.css("height",i),$("#assets-bar").css("height",i-enums_1.default.assetsLibraryLabelSize);var s=i-enums_1.default.assetLibraryPreviewSize;$("#assets-bar-holder").css("height",s)}this.scenePropertiesHolder.css("transform","rotate(360deg)"),this.assetsHierarchyHolder.css("transform","rotate(360deg)"),this.assetsLibraryHolder.css("transform","rotate(360deg)"),this.sceneAssetPreviewStandin.css("transform","rotate(360deg)")},RuntimeEditor.prototype.importExternalCSS=function(e){var t="";main_1.default.globalEditorInfo.backend!==enums_1.default.Backends.Debug&&main_1.default.globalEditorInfo.backend!==enums_1.default.Backends.Website||(t="uiresources/");Promise.all(e.map(function(e){var i=e.replace("!css","");main_1.default.openFiles[main_1.default.selectedEditor].tab.filePath;return e.startsWith("../")&&(i=i.replace(/\.\.\//g,"")),System.import(t+i+"!text")})).then(function(e){var t=function_helpers_1.default.applyStylesToScene(e);$("<style>"+t+"</style>").prependTo($("#scene"))})},RuntimeEditor.prototype.importFontFaces=function(e){if(0!==e.length){var t=main_1.default.openFiles[main_1.default.selectedEditor].tab.filePath,i="";e.map(function(e){return function_helpers_1.default.externalFilePathHandler(e,t)}).map(function(e){i+=""+function_helpers_1.default.buildFontCss(e)}),$("<style id='coui_font_faces'>"+i+"</style>").prependTo($("#scene"))}},RuntimeEditor.prototype._setRightClickHandling=function(e){e&&(this.sceneWrapper.off("contextmenu mouseup"),this.sceneWrapper.on("contextmenu mouseup",this._rightClickContextMenuHandler.bind(this)))},RuntimeEditor.prototype.getFormat=function(){return this.formatTo},RuntimeEditor.prototype.setFormat=function(e){void 0!==e&&("number"==typeof e&&Number.isInteger(e)&&e>=0?this.formatTo=e:console.error("Format Value is not a valid."))},RuntimeEditor.prototype._rightClickContextMenuHandler=function(e){var t=$("#context-menu"),i=t.find(".btn-dynamic");if(e.which===enums_1.default.Keys.rightMouseClick){e.preventDefault(),this.WidgetSelection.getSelectedState()?i.removeClass("disabled"):i.addClass("disabled");var n=$(window).height(),o=$(window).width(),r=n/2,s=o/2;e.clientY>r&&e.clientX<=s?(t.css("left",e.clientX),t.css("bottom",n-e.clientY),t.css("right","auto"),t.css("top","auto")):e.clientY>r&&e.clientX>s?(t.css("right",o-e.clientX),t.css("bottom",n-e.clientY),t.css("left","auto"),t.css("top","auto")):e.clientY<=r&&e.clientX<=s?(t.css("left",e.clientX),t.css("top",e.clientY),t.css("right","auto"),t.css("bottom","auto")):(t.css("right",o-e.clientX),t.css("top",e.clientY),t.css("left","auto"),t.css("bottom","auto")),t.fadeIn(50,function(){$("#coui-editor").off("click"),$("#coui-editor").on("click",function(){t.fadeOut(50)})})}else t.is(":visible")&&t.fadeOut(50)},RuntimeEditor.prototype._filterAssets=function(e,t){for(var i=e.slice(),n=0;n<i.length;n++)i[n].url===t&&i.splice(n,1);return i},RuntimeEditor.prototype._filterComponents=function(e,t){for(var i=e.slice(),n=0;n<i.length;n++)i[n].name===t&&i.splice(n,1);return i},RuntimeEditor.prototype._resetFontFamily=function(e){var t=this;e.forEach(function(e){t.mappedWidgets[e].widget.styles.fontFamily="initial",document.getElementById(e).style.fontFamily="initial"}),this.clearSelectedElements()},RuntimeEditor.prototype._getElementsWithFont=function(e,t){for(var i=[],n=0,o=Object.keys(e);n<o.length;n++){var r=o[n];e[r].widget.styles.fontFamily===t&&i.push(e[r].widget.id)}return i},RuntimeEditor.prototype._fontFamilyWarning=function(e,t){return{header:"Removing "+e+" will affect the following "+(t.length>1?"elements":"element")+" with ID:",body:'<div class="vex-font-elements">'+t.join(",")+"</div>",footer:'<div class="vex-dialog-message">The font-family will be reset to default. Are you sure you want to delete it?</div>'}},RuntimeEditor.prototype._attachLibraryClickEvent=function(){var e=this;this.assetsBarContent.find(".k-icon").remove(),this.sceneAssetPreviewImage.css("display","none"),this.sceneAssetPreviewVideo.css("display","none"),this.sceneAssetPreviewWidget.css("display","none"),this.sceneAssetPreviewStandin.css("display","block"),$(document).off("click",".edit-widget"),$(document).on("click",".edit-widget",function(t){e.exportScene();var i="component",n=this.getAttribute("data-url"),o=this.getAttribute("data-link");if(o.endsWith(".html")&&(i="widget"),main_1.default.PENDING_WIDGET_LOAD=!0,"widget"===i)main_1.default.globalEditorInfo.backend===enums_1.default.Backends.Unreal&&n.indexOf("uiresources")<0&&(n="uiresources/"+n),main_1.default.openAsset({path:n});else if("component"===i){var r=main_1.default.openFiles[main_1.default.selectedEditor].components,s=r.components[o];r.open(s,o)}t.stopImmediatePropagation()}),$(document).off("click",".convert-widget"),$(document).on("click",".convert-widget",function(){var t=this.getAttribute("data-url"),i=this.getAttribute("data-link"),n=new Date;System.import(t+"?"+n.getTime()+"!text").then(function(t){var n=i.match(/[^\/\\]*$/),o=main_1.default.openFiles[main_1.default.selectedEditor];if(n=n[0].replace(".html",".component"),o.components.isComponentOpened(n))$("#coui-editor").trigger("vexFlashMessage",[enums_1.default.warnMessages.closeTabToConvertTheWidget]);else{var r=main_1.default.handleFileContent(t,n,e.editorTabName,!0,!1);r.widgets[0].widgetkit=n;var s=JSON.stringify(r);s=s.replaceAll("coui://uiresources/",""),o.components.create(n,s),main_1.default.refreshTab(),$("#coui-editor").trigger("vexFlashMessage",[enums_1.default.Messages.widgetConvertSuccess,!0])}})}),this.sceneAssetPreviewStandin.css("background-color","white"),$(document).off("click","#assets-bar .fa-plus"),$(document).on("click","#assets-bar .fa-plus",function(t){var i=this.getAttribute("data-type");e.sceneAssetSelected=!0,"events"===i?(this._pickedAsset="events",i="script"):this._pickedAsset="script"===i?"scripts":i,main_1.default.pickAsset("",i).otherwise(function(e){console.log("error = ",e)}),t.stopImmediatePropagation()}),$(document).off("click","#assets-bar .fa-remove"),$(document).on("click","#assets-bar .fa-remove",function(t){function i(t){0===d.length&&$(r).find(".fa-play").css("transform","rotate(0deg)"),main_1.default.assets[s]=d,e.virtualList.removeAsset(t),e.assetsDOM=helpers_1.createVDOM(e.createAssetDOM(main_1.default.assets).template)}var n=this,o=this.getAttribute("data-url"),r=this.parentElement,s=r.getAttribute("data-type"),a=r.getAttribute("vList-index"),d=e._filterAssets(main_1.default.assets[s],o),l=$(this.parentElement).find(".fa-dot-circle-o").length>0;if(l&&main_1.default.tabEdited(!0),"widget"===s){var p=new vexConfirm_1.default,c=n.getAttribute("data-link");p.create(enums_1.default.warnMessages.deleteComponents(c)).then(function(t){"yes"===t&&(e.removeWidgetAsset(c,"widget"),e.assetsDOM=helpers_1.createVDOM(e.createAssetDOM(main_1.default.assets).template))})}else if("font"===s){var u=o.replace(/\.[^/.]+$/,"").replace(/^.*[\\\/]/,""),m=e._getElementsWithFont(e.mappedWidgets,u);if(l||m.length){var h=e._fontFamilyWarning(u,m);vex.dialog.open({contentClassName:"modal-about modal-font-confirm",message:h.header,buttons:[$.extend({},vex.dialog.buttons.YES,{text:"Yes"}),$.extend({},vex.dialog.buttons.NO,{text:"Cancel"})],afterOpen:function(e){e.append(h.body,h.footer)},callback:function(t){t&&(e._resetFontFamily(m),i(a))}})}else i(a)}else{if("style"!==s&&"script"!==s&&"font"!==s){var f="sceneAssetPreview"+function_helpers_1.default.capitalizeFirstLetter(s);e[f].attr("src")===o&&e[f].fadeOut(100,function(){e[f].attr("src",""),e[f].css("display","none"),e.sceneAssetPreviewStandin.css("display","block"),e.sceneAssetPreviewStandin.fadeIn(100)})}else o=o.replace("uiresources/",""),e._toScene(o,s,!1);i(a)}t.stopImmediatePropagation()}),$(document).off("click",".script-or-style"),$(document).on("click",".script-or-style",function(t){var i,n,o=$(this).find('span[data-type="radio-span"]');o.hasClass("fa-circle-o")?(o.removeClass("fa-circle-o"),o.addClass("fa-dot-circle-o"),i=$(this).find("span[data-link]").attr("data-url"),n=$(this).find("span[data-type]").attr("data-type"),e._toScene(i,n,!0)):(o.removeClass("fa-dot-circle-o"),o.addClass("fa-circle-o"),i=$(this).find("span[data-link]").attr("data-url"),n=$(this).find("span[data-type]").attr("data-type"),e._toScene(i,n,!1)),main_1.default.tabEdited(!0),t.stopImmediatePropagation()}),$(document).off("click",".asset-file-name"),$(document).on("click",".asset-file-name",function(t){$(".asset-file-name").removeClass("selected");var i=$(this).find("span[data-link]").attr("data-url"),n=$(this).find("span[data-type]").attr("data-type");e._switchPreviewWindow(i,n),$(this).addClass("selected"),t.stopImmediatePropagation()}),$("#assets-bar").kendoDraggable({filter:".asset-file-name",group:"assetsGroup",distance:1,hint:function(t){var i=t.data("type"),n=t.find("span[data-link]").attr("data-link"),o=t.find("span[data-link]").attr("data-url");main_1.default.globalEditorInfo.backend!==enums_1.default.Backends.Standalone&&main_1.default.globalEditorInfo.backend!==enums_1.default.Backends["Standalone-2"]&&main_1.default.globalEditorInfo.backend!==enums_1.default.Backends.Unreal||(o=o.replace("uiresources/",""));var r;return"image"===i?r=$('<img id="dragged-kendo-element" src="'+o+'">'):"video"===i?r=$('<video autoplay="false" id="dragged-kendo-element" src="'+o+'">'):"widget"===i&&(r=$('<div data-url="'+o+'" data-widget-name="'+n+'" id="dragged-kendo-element" class="widget-asset-preview"></div>')),e.draggedElement=$(r[0]),e.draggedElement.css("z-index","999999"),r},dragstart:function(t){var i=e.tab.sceneTransformMatrix[0],n=parseFloat(e.draggedElement.css("left")),o=parseFloat(e.draggedElement.css("top"));n=(t.clientX-n)/i,o=(t.clientY-o)/i,e.draggedElement.css({"transform-origin":"0px 0px",transform:"scale("+i+","+i+") translate("+n+"px ,"+o+"px)"})}}),e.sceneWrapper.kendoDropTarget({group:"assetsGroup",dragenter:function(e){e.draggable.hint.css("border","solid 1px black")},dragleave:function(e){e.draggable.hint.css("border","")},drop:function(t){var i=t.draggable.hint[0];$(".select-corners").addClass("disable-click"),$("body").off("mousedown"),e._sceneActionState.primaryAction="new action";var n;switch(i.tagName){case"IMG":n="responsiveImage";break;case"DIV":return void main_1.default.openFiles[e.editorTabName].components._insertToTheScene(i,t);case"VIDEO":n="video"}var o=e._prepareObjEl(n),r=o.id,s=e._getSceneOffset(t);o.geometry.width=units_conversion_1.default.convertPixelToVw(i.width)+"vw",o.geometry.height=units_conversion_1.default.convertPixelToVh(i.height)+"vh",e.createElementOnTheScene(r,n,o),e.applyProperties(r,"css property","top",s.y),e.applyProperties(r,"css property","left",s.x),e.applyProperties(r,"css property","width",i.width),e.applyProperties(r,"css property","height",i.height),e.highlightSelectedEl($(document.getElementById(r)));var a=units_conversion_1.default.convertPixelToVw(s.x),d=units_conversion_1.default.convertPixelToVh(s.y);o.geometry.top=d+"vh",o.geometry.left=a+"vw",e._sceneActionState.elementWasInserted=!0,n="responsiveImage"===n?"image":"video";var l=i.getAttribute("src");e.assetChosen(l,r,n)}})},RuntimeEditor.prototype.removeWidgetAsset=function(e,t,i){void 0===i&&(i=void 0),main_1.default.openFiles[main_1.default.selectedEditor].components.remove(e);var n=this._filterComponents(main_1.default.assets[t],e),o=this.virtualList.findIndex(e);main_1.default.assets[t]=n,null!==o&&this.virtualList.removeAsset(o)},RuntimeEditor.prototype._getSceneOffset=function(e){var t=$(this.scenePreviewEl).offset(),i=this.tab.sceneTransformMatrix[0];return{x:(e.originalEvent.pageX-t.left)/i,y:(e.originalEvent.pageY-t.top)/i}},RuntimeEditor.prototype._switchPreviewWindow=function(e,t){if("style"!==t&&"script"!==t&&"font"!==t){var i=this;main_1.default.globalEditorInfo.backend!==enums_1.default.Backends.Standalone&&main_1.default.globalEditorInfo.backend!==enums_1.default.Backends["Standalone-2"]&&main_1.default.globalEditorInfo.backend!==enums_1.default.Backends.Unreal||(e=e.replace("uiresources/",""));var n=this.sceneAssetPreviewWindow.children().filter(function(){return"block"===this.style.display}),o="sceneAssetPreview"+function_helpers_1.default.capitalizeFirstLetter(t);if(i[o].attr("src")===e)return;var r=n[0].tagName===i[o][0].tagName;$(n).fadeOut(50,function(){r?i[o].attr("src",e):(n.attr("src",""),i[o].attr("src",e),n.css("display","none"),n.css("opacity","1"),i[o].css("display","block")),i[o].fadeIn(50)})}},RuntimeEditor.prototype.buildWidgetUrl=function(e){var t=new Date;return main_1.default.globalEditorInfo.backend===enums_1.default.Backends.Standalone||main_1.default.globalEditorInfo.backend===enums_1.default.Backends["Standalone-2"]||main_1.default.globalEditorInfo.backend===enums_1.default.Backends.Unreal?e+"?"+t.getTime()+"!text":"mocks/widget.html!text"},RuntimeEditor.prototype._customAspectRationHandler=function(){document.getElementById("aspect-ratio-custom").addEventListener("change",this._AspectRationonChangeHandler.bind(this),!1)},RuntimeEditor.prototype._AspectRationonChangeHandler=function(e){var t=this.scene.sceneSize,i=$("#aspect-ratio-width-custom").val(),n=$("#aspect-ratio-height-custom").val();return this._setUndoRedoCommandsFill({aspectRatio:{type:this.scene.sceneSize.type,width:this.scenePreviewEl.style.width,height:this.scenePreviewEl.style.height}}),t.width=i+"px",t.height=n+"px",this.scenePreviewEl.style.width=t.width,this.scenePreviewEl.style.height=t.height,this.exportScene(),window.requestAnimationFrame(main_1.default.focusCUIFile.bind(this,this.editorTabName)),{width:t.width,height:t.height}},RuntimeEditor.prototype._disableMaskEvents=function(){window.removeEventListener("keydown",this.disableMask,!1),window.addEventListener("keydown",this.disableMask,!1),window.removeEventListener("keyup",this.enableMask,!1),window.addEventListener("keyup",this.enableMask,!1)},RuntimeEditor.prototype.disableMask=function(e){e.keyCode===enums_1.default.Keys.ctrl&&$(".select-corners").addClass("disable-click")},RuntimeEditor.prototype.enableMask=function(e){e.keyCode===enums_1.default.Keys.ctrl&&$(".select-corners").removeClass("disable-click")},RuntimeEditor.prototype._addWidgetHandler=function(){var e=this;$(".widget-name").off(),$(".widget-name").on("click",function(){$(".select-corners").addClass("disable-click"),$("body").off("mousedown"),$(".widget-name").removeClass("selected"),$(this).addClass("selected");var t=$(this).attr("data-type");if(main_1.default.globalEditorInfo.backend!==enums_1.default.Backends.Debug&&main_1.default.globalEditorInfo.backend!==enums_1.default.Backends.Website||"image"!==t&&"video"!==t&&"responsiveImage"!==t){e._sceneActionState.primaryAction="new action";var i=e._prepareObjEl(t),n=i.id;e._sceneActionState.elementWasInserted=!1,"image"===t||"responsiveImage"===t||"video"===t?(e.interactElementsState="resize",e._sceneClickingState.draggingCreation=!1,e._sceneActionState.initialCreationOfWidgetByExternalFile=!0,e.createElementOnTheScene(n,t,i),"responsiveImage"===t&&$("#properties").data("kendoPanelBar").expand($("#background-properties")),"video"===t?$("#upload-video").click():$("#upload-image").click()):(e._sceneClickingState.draggingCreation=!0,e.initElementOnScene(n,t,i))}})},RuntimeEditor.prototype.setCopiedWidgets=function(e,t){for(var i=0;i<e.length;i++)if(null!==e[i]){var n=this.initialWidgetCopy(e[i],t);if(n.widget.children.length>0)for(var o=0;o<n.widget.children.length;o++)this.setCopiedWidgets([n.widget.children[o].id],!0)}},RuntimeEditor.prototype.copyWidgets=function(){var e=$.extend(!0,[],this.currentParentElementsSelection);main_1.default.copiedWidgets.widgets={},main_1.default.copiedWidgets.animations={},main_1.default.copiedWidgets.animationsToPaste={},this.setCopiedWidgets(e)},RuntimeEditor.prototype.initialWidgetCopy=function(e,t){return main_1.default.copiedWidgets.widgets[e]=t?{nestedElementId:e}:$.extend(!0,{},this.mappedWidgets[e]),this.scene.animations[e]&&(main_1.default.copiedWidgets.animations[e]=$.extend(!0,{},this.scene.animations[e]),main_1.default.copiedWidgets.animations[e][this.scene.animations[e].className]||(main_1.default.copiedWidgets.animations[e][this.scene.animations[e].className]={},$.extend(!0,main_1.default.copiedWidgets.animations[e][this.scene.animations[e].className],enums_1.default.newAnimation))),main_1.default.copiedWidgets.tabName=this.editorTabName,$.extend(!0,{},this.mappedWidgets[e])},RuntimeEditor.prototype.buildCopyWidgetData=function(e,t){var i=main_1.default.copiedWidgets.widgets[t].widget,n=!!i.widgetkit&&i.widgetkit.endsWith(".component")?i.id.replace(".component",""):i.type,o=main_1.default.generateRandomId(n),r=$.extend(!0,{},i);r.id=o;var s=document.getElementById(t);if(null!==s){var a=units_conversion_1.default.getPixelsWidgetGeometry(t,"top",r.geometry.top),d=units_conversion_1.default.getPixelsWidgetGeometry(t,"left",r.geometry.left),l=a.originalUnit,p=d.originalUnit,c=a.pixels+e,u=d.pixels+e;if("%"!==l)r.geometry.top=units_conversion_1.default.convertPixelToUnit(t,c,l,"top");else{m=parseFloat(getComputedStyle(s.parentElement,null).getPropertyValue("height"));r.geometry.top=units_conversion_1.default.convertPixelToPercent(c,m).toFixed(1)+"%"}if("%"!==p)r.geometry.left=units_conversion_1.default.convertPixelToUnit(t,u,p,"left");else{var m=parseFloat(getComputedStyle(s.parentElement,null).getPropertyValue("width"));r.geometry.left=units_conversion_1.default.convertPixelToPercent(u,m).toFixed(1)+"%"}}return{widget:r,newId:o}},RuntimeEditor.prototype.doesWidgetsClassNamesExistInAnimationClasses=function(){var e=this.scene.animationClasses,t=main_1.default.copiedWidgets.animations;for(var i in t)if(e[t[i].className]&&this.editorTabName!==main_1.default.copiedWidgets.tabName)return!0;return!1},RuntimeEditor.prototype.compareWidgetAnimationClassesWithAnimationClasses=function(){var e=this.scene.animationClasses,t=main_1.default.copiedWidgets.animations;for(var i in t)e[t[i].className]||this.editorTabName===main_1.default.copiedWidgets.tabName||t[i].className&&(e[t[i].className]=t[i][t[i].className])},RuntimeEditor.prototype.cloneWidget=function(){if(this.doesWidgetsClassNamesExistInAnimationClasses())$("#coui-editor").trigger("vexFlashMessage",[]);else{this.compareWidgetAnimationClassesWithAnimationClasses();var e,t,i=0,n=15*Math.random()+10,o=[];for(var r in main_1.default.copiedWidgets.widgets)main_1.default.copiedWidgets.widgets[r].nestedElementId||i++;this._undoCreationStepsLength=i,this._sceneActionState.pasteWidget=!0;var s=main_1.default.openFiles[main_1.default.selectedEditor].tab.tabWidgetState.editWidget;for(var a in main_1.default.copiedWidgets.widgets)if(function(e,t){return t?!e.nestedElementId&&"widget"!==e.widget.type&&t:!e.nestedElementId}(main_1.default.copiedWidgets.widgets[a],s)){var d=this.buildCopyWidgetData(n,a);this.isTopLevel(a)||document.getElementById(a)&&(e=document.getElementById(a).parentElement.id,t=$("#sceneTree").jstree().get_node($('li[data-id="'+e+'"]')).id);var l=this.getJstreeAfterNodeIds(e);o.push(d.widget.id),this.createElementsOnTheScene({currentWidget:d.widget,parentWidgetId:e,parentJstreeNode:t,jstreePosition:"last",jstreeAfterNodeId:l.lastChildId,jstreeNodeAppendId:l.parentId}),this.scene.animations[a]&&(main_1.default.copiedWidgets.animationsToPaste[d.newId]=$.extend(!0,{},main_1.default.copiedWidgets.animations[a]),main_1.default.copiedWidgets.animationsToPaste[d.newId].id=d.newId),e=void 0,t=void 0}this.selectMultiJstreeItems(o),$.extend(this.scene.animations,main_1.default.copiedWidgets.animationsToPaste);for(var p in main_1.default.copiedWidgets.animationsToPaste)for(var c in this.scene.animationClasses)main_1.default.copiedWidgets.animationsToPaste[p][c]&&(this.scene.animations[p][c]=this.scene.animationClasses[c]);this.Animations.loadKeyframes(this.scene.animationClasses,!0),this._sceneActionState.pasteWidget=!1,this._skipUndoRedoSteps=0,main_1.default.copiedWidgets.animationsToPaste={}}},RuntimeEditor.prototype.getJstreeAfterNodeIds=function(e){var t={lastChildId:"",parentId:e};if(e){var i=this.mappedWidgets[e].widget.children.length;t.lastChildId=this.mappedWidgets[e].widget.children[i-1].id,t.parentId=t.lastChildId?"":t.parentId}return t},RuntimeEditor.prototype.cloneAnimations=function(e,t){var i,n;t?(i=main_1.default.copiedWidgets.animations[t],n=$.extend(!0,{},i),main_1.default.copiedWidgets.animationsToPaste[e]=n):(i=this.scene.animations[e],n=$.extend(!0,{},i),main_1.default.copiedWidgets.animations[e]=n)},RuntimeEditor.prototype.initElementOnScene=function(e,t,i){function n(t){var o=t.srcElement.id;if("scene"===o||"scene-wrapper"===o||void 0!==r.mappedWidgets[o]){r.scene.widgets.push(i),$(".select-corners").removeClass("disable-click");var d=t.target.id;if(""!==d&&1===$("#center-pane").find("#"+d).length||"center-pane"===d){var l=$(r.scenePreviewEl).offset(),p=r.tab.sceneTransformMatrix[0],c=(t.pageX-l.left)/p,u=(t.pageY-l.top)/p;r.createElementSimple(i),r.mappedWidgets[e]={widget:i},r.createElementEvent=t;var m=$("#"+e);r.applyProperties(e,"css property","top",u),r.applyProperties(e,"css property","left",c),r.highlightSelectedEl(m),c=units_conversion_1.default.convertPixelToVw(c),u=units_conversion_1.default.convertPixelToVh(u),i.geometry.top=u.toFixed(r.formatTo+1)+"vh",i.geometry.left=c.toFixed(r.formatTo+1)+"vw",a=!0}}r._sceneClickingState.draggingCreation=!1,r.WidgetSelection.attachHandlers(),s.removeEventListener("mousedown",n,!1)}function o(){a&&(r.interactElementsState="resize",r.jsTreeAddNode(t,e,"#","last",!0),r.tab.tabWidgetState.editWidget&&r.placeWidgetOnScene(e),r.Animations.createAnimationWidget(i),r.saveUndoRedoAfterCreateElement(e,i)),r._sceneClickingState.draggingCreation=!1,s.removeEventListener("mouseup",o,!1)}var r=this,s=document.body,a=!1;this.WidgetSelection.detachHandlers(),this.currentElementsSelection=[e],this.currentParentElementsSelection=[e],this.interactElementsState="create",s.addEventListener("mouseup",o,!1),s.addEventListener("mousedown",n,!1)},RuntimeEditor.prototype.placeWidgetOnScene=function(e){this.elementReposition=!0,this.appendElementInWidgets(e)},RuntimeEditor.prototype.appendElementInWidgets=function(e){var t=$("#sceneTree").jstree().get_node($('li[data-id="'+e+'"]'),!1),i=this.scene.widgets[0].id,n=$("#sceneTree").jstree().get_node($('li[data-id="'+i+'"]'),!1);$("#sceneTree").jstree().move_node(t,n,"last")},RuntimeEditor.prototype.getRedoUndoPrimaryState=function(){var e,t=main_1.default.openFiles[this.editorTabName];return"new action"===this._sceneActionState.primaryAction?this._sceneActionState.primaryAction:("undo"===this._sceneActionState.primaryAction?(e="redo",0===redoLenCommands&&(redoLenCommands=t.undo[0]?t.undo[0].length:1)):(e="undo",0===undoLenCommands&&(undoLenCommands=t.redo[0]?t.redo[0].length:1)),e)},RuntimeEditor.prototype.getSceneScale=function(){return new WebKitCSSMatrix(window.getComputedStyle(this.scenePreviewEl).webkitTransform).a},RuntimeEditor.prototype.undoRedoMoveWidget=function(e,t,i,n,o){var r;r="top"===i?"#":$("#sceneTree").jstree().get_node($('li[data-id="'+i+'"]'),!1).id;var s=$("#sceneTree").jstree().get_node($('li[data-id="'+e+'"]'),!1);t===i&&n>=o&&n++,$("#sceneTree").jstree().move_node(s,r,n)},RuntimeEditor.prototype.createUndoRedoNewWidget=function(e,t){var i=e.id;this._sceneActionState.primaryAction="new action",this._sceneActionState.initialComponent=!0;var n=this.currentParentElementsSelection.filter(Boolean);this._undoCreationStepsLength=n.length,this.removeWidgets(n),t&&(this._undoCreationStepsLength=2),this.createElementOnTheScene(i,"widget",e,!0),this._sceneActionState.initialComponent=!1},RuntimeEditor.prototype.createElementOnTheScene=function(e,t,i,n){this.scene.widgets.push(i);var o=units_conversion_1.default.convertPixelToVw(parseFloat(i.geometry.left)),r=units_conversion_1.default.convertPixelToVh(parseFloat(i.geometry.top)),s=units_conversion_1.default.convertPixelToVw(parseFloat(i.geometry.width)),a=units_conversion_1.default.convertPixelToVh(parseFloat(i.geometry.height));i.geometry.top=r.toFixed(this.formatTo+1)+"vh",i.geometry.left=o.toFixed(this.formatTo+1)+"vw",i.geometry.width=s.toFixed(this.formatTo+1)+"vw",i.geometry.height=a.toFixed(this.formatTo+1)+"vh",this.mappedWidgets[e]={widget:i},this.createElement(i),this.recalculateUnits($("#"+e)[0]),this.jsTreeAddNode(t,e,"#","last",!0),this.saveUndoRedoAfterCreateElement(e,i,n)},RuntimeEditor.prototype.saveUndoRedoAfterCreateElement=function(e,t,i){"widget"===t.type&&i?this._sceneActionState.createNewWidget=!0:this._sceneActionState.createElement=!0,this._sceneActionState.pasteWidget||this._sceneActionState.initialComponent||(this._undoCreationStepsLength=1);var n=this.getRedoUndoPrimaryState();"new action"===n&&this._dragFlag&&(this._skipUndoRedoSteps=4),this.createUndoRedoCommand(n,e,null,null,null,t),this.exportScene()},RuntimeEditor.prototype.createElementsOnTheScene=function(e){var t="#";this.mappedWidgets[e.currentWidget.id]={widget:e.currentWidget},void 0!==e.parentWidgetId?(this.mappedWidgets[e.parentWidgetId].widget.children.push(e.currentWidget),t=$("#sceneTree").jstree().get_node($('li[data-id="'+e.parentWidgetId+'"]')).id):this.scene.widgets.push(e.currentWidget),this.createElement(e.currentWidget),this.recalculateUnits($("#"+e.currentWidget.id)[0]);var i=function_helpers_1.default.isComponent(e.currentWidget)?"component":e.currentWidget.type;this.jsTreeAddNode(i,e.currentWidget.id,t,e.jstreePosition,!0),main_1.default.openFiles[this.editorTabName].tab.tabWidgetState.editWidget&&this.placeWidgetOnScene(e.currentWidget.id),e.currentWidget.children.length>0&&this.rebuildJstreeChildren(e.currentWidget.children,e.currentWidget.id),this.saveUndoRedoAfterCreateElement(e.currentWidget.id,e.currentWidget,e.isNewWidget),e.jstreeAfterNodeId&&this.reorderElementOnTheScene("after node",e.currentWidget.id,e.jstreeAfterNodeId),e.jstreeNodeAppendId&&this.reorderElementOnTheScene("prepend node",e.currentWidget.id,e.jstreeNodeAppendId),this.exportScene()},RuntimeEditor.prototype.rebuildJstreeChildren=function(e,t){for(var i=0;i<e.length;i++){var n=e[i];this.mappedWidgets[n.id]={widget:n};var o=$("#sceneTree").jstree().get_node($('li[data-id="'+t+'"]'),!1);this.jsTreeAddNode(n.type,n.id,o,"last",!1),this.recalculateUnits($("#"+n.id)[0]),e[i].children.length>0&&this.rebuildJstreeChildren(n.children,n.id);var r=$("#"+n.id);r.length>0&&r[0].hasAttribute("data-element-selectable")&&this.Animations.createAnimationWidget(n,{initial:!0})}},RuntimeEditor.prototype.reorderElementOnTheScene=function(e,t,i){"after node"===e&&$("#"+t).insertAfter($("#"+i)),"prepend node"===e&&$("#"+i).prepend($("#"+t));var n=$("#"+t);this.highlightSelectedEl(n)},RuntimeEditor.prototype.addFile=function(e){"events"===e?(this._pickedAsset="events",e="script"):this._pickedAsset="script"===e?"scripts":e,main_1.default.pickAsset("",e).otherwise(function(e){console.log("error = ",e)})},RuntimeEditor.prototype._openFileToEditHandler=function(){$(".file-link").off(),$(".file-link").on("dblclick",function(){var e=$(this).val();console.log(e),engine.call("OpenAsset","uiresources/"+e).then(function(e){console.log("success"+e)},function(e){console.log("error"+e)})})},RuntimeEditor.prototype._removeFilesHandler=function(){var e=this;$(".remove-files").off(),$(".remove-files").on("click",function(){var t=$(this).attr("data-index"),i=$(this).parents(".files-cont").attr("data-type"),n=$(this).attr("data-link");e._sceneActionState.primaryAction="new action",e.deleteFile(t,i,n)})},RuntimeEditor.prototype.deleteFile=function(e,t,i){var n="",o=window.location.href,r=o.substr(0,o.length-10);this._sceneActionState.deleteFile=!0,"styles"===t&&(n=r+"runtime_editor/"+i.substring(0,i.length-4),$('link[href="'+n+'"]').remove()),this.scene[{script:"scripts",scripts:"scripts",style:"styles",styles:"styles",events:"events"}[t]].splice(e,1);var s={type:t,index:e,url:i},a=this.getRedoUndoPrimaryState();this.createUndoRedoCommand(a,null,null,null,null,s),this.exportScene("file")},RuntimeEditor.prototype.runtimeLoad=function(e,t){var i=this,n=document.createElement("div");n.id="wrapper-runtime";var o={runtimeEditor:i,options:t};return runtime_1.default.loadSceneObj(JSON.parse(e),n,o)},RuntimeEditor.prototype.saveScene=function(e){var t=JSON.stringify(this.scene);main_1.default.openFiles[this.editorTabName].file=t,main_1.default.save(this._openedFile,t),this.exportUndoRedo(),"file"===e&&main_1.default.focusCUIFile(this.editorTabName)},RuntimeEditor.prototype.publishScene=function(){main_1.default.setPinheadPosition(0),main_1.default.onSelectedFileType.publishPage=!0,engine.call("ShowFileDialog",{__Type:"FileDialogConfig",extensions:[".html"],dialogName:"Publish scene",initDirectory:"",fileMustExist:!1,isOpenFile:!1,allowMultiselect:!1}),this.Timeline.revertPinheadPosition()},RuntimeEditor.prototype.preview=function(e){var t=JSON.stringify(this.scene);main_1.default.openFiles[this.editorTabName].file=t,main_1.default.preview(this._openedFile,t,e)},RuntimeEditor.prototype.exportScene=function(e){if(!this._sceneActionState.initialLoad){var t=JSON.stringify(this.scene);main_1.default.openFiles[this.editorTabName].file=t,this.exportUndoRedo(),"file"===e&&main_1.default.focusCUIFile(this.editorTabName)}},RuntimeEditor.prototype.exportUndoRedo=function(){var e=JSON.parse(localStorage.getItem(this.editorTabName))||{};e[this.editorTabName]={undo:main_1.default.openFiles[this.editorTabName].undo,redo:main_1.default.openFiles[this.editorTabName].redo},localStorage.setItem(this.editorTabName,JSON.stringify(e))},RuntimeEditor.prototype._prepareObjEl=function(e){var t=build_widget_settings_1.default.buildWidget(e);return t.id=main_1.default.generateRandomId(e),main_1.default.widgetCount++,t},RuntimeEditor.prototype.setAspectRatio=function(e){var t=this,i=this.scene.sceneSize;switch(void 0!==this.scene.sceneSize.type?this.scene.sceneSize.type=e:this.scene.sceneSize.id=e,e){case"aspectRatio5_4":t.scene.sceneSize.width="1000px",t.scene.sceneSize.height="800px";break;case"aspectRatio4_3":t.scene.sceneSize.width="800px",t.scene.sceneSize.height="600px";break;case"aspectRatio16_10":t.scene.sceneSize.width="1440px",t.scene.sceneSize.height="900px";break;case"aspectRatio16_9":t.scene.sceneSize.width="1600px",t.scene.sceneSize.height="900px";break;case"aspectRatio16_9_full_hd":t.scene.sceneSize.width="1920px",t.scene.sceneSize.height="1080px";break;case"aspectRatio_custom":t.scene.sceneSize.width=i.width,t.scene.sceneSize.height=i.height}t.scenePreviewEl.style.width=i.width,t.scenePreviewEl.style.height=i.height,t.exportScene()},RuntimeEditor.prototype.highlightSelectedEl=function(e,t){var i,n=this,o=this.interactElementsState+"-corners",r=$("#edit-menu").find(".btn-dynamic"),s=r.hasClass("disabled");if(e){var a=function_helpers_1.default.getUnitStyle(e[0].style.left),d=function_helpers_1.default.getUnitStyle(e[0].style.top);if("%"===a){var l=e[0].offsetLeft;e[0].style.left=l+"px"}if("%"===d){var p=e[0].offsetTop;e[0].style.top=p+"px"}}if(n.WidgetSelection.setSelectedState(!0),$(".select-corners").remove(),s&&r.removeClass("disabled"),!n.iframe)if(t)for(var c=0;c<t.length;c++){var u=$("#"+t[c]);i="true"===u.attr("data-lock"),n.appendManipulationMasks(o,i,u)}else i="true"===e.attr("data-lock"),n.appendManipulationMasks(o,i,e)},RuntimeEditor.prototype.scaleManipulationMasks=function(e,t){if(t>=1){if($(".select-corners").find("point").css({transform:"scale("+t+")"}),$(".transform-origin-point").css({width:10*t+"px",height:10*t+"px",borderWidth:2*t+"px"}),$("mask").css("border-width",t+"px"),this.getSelectedWidgetId()&&!this._sceneClickingState.draggingCreation&&null===e){var i=$("#"+this.getSelectedWidgetId());this.computeSelectCorners(i)}}else $(".select-corners").find("point").css({transform:"scale(1)"})},RuntimeEditor.prototype.changeSceneScale=function(e){var t=$("#sceneScale"),i=(e-.3)/1.4*140+30;$("#slider-zoom-percent").val(Math.round(i)+"%"),t.val(Math.round(i)),this.scaleManipulationMasks(null,1/e)},RuntimeEditor.prototype.appendManipulationMasks=function(e,t,i){if(i[0]){var n=this,o="";if("resize-corners"===e?n._setRightClickHandling(!0):n._setRightClickHandling(!1),"OPTION"!==i[0].tagName||"SELECT"!==i[0].parentElement.tagName&&"OPTION"!==i[0].parentElement.tagName){1===this.currentElementsSelection.length&&("rotate"===this.interactElementsState?o='<point class="rotateLeftTop top-left-rotate"></point><point class="rotateRightTop top-right-rotate"></point><point class="rotateLeftBottom bottom-left-rotate"></point><point class="rotateRightBottom bottom-right-rotate"></point>':"resize"!==this.interactElementsState&&"create"!==this.interactElementsState||(o='<point class="topLeftCorner top-left-corner"></point><point class="leftCenter left-center"></point><point class="bottomCenter bottom-center"></point><point class="rightCenter right-center"></point><point class="topCenter top-center"></point><point class="topRightCorner top-right-corner"></point><point class="bottomRightCorner bottom-right-corner"></point><point class="bottomLeftCorner bottom-left-corner"></point>'));var r=$('<mask class="'+e+' select-corners panning" data-widget-id="'+i[0].id+'"></mask>');r.append(o),$(this.scenePreviewEl).append(r),this.computeSelectCorners(i,r);var s=this.tab.sceneTransformMatrix[0];this.scaleManipulationMasks(i,1/s),r[0].addEventListener("click",function(e){n._dragFlag||n.isInPanningMode||(n.blurOutTextInputs(),n._elementSelectionHelper(i[0].id),1===n.currentElementsSelection.length&&n.propertiesElBar.is(":empty")&&n.selectJstreeItem(i[0].id),"resize"===n.interactElementsState?n.interactElementsState="rotate":"rotate"===n.interactElementsState&&(n.interactElementsState="resize"),n.highlightSelectedEl(i)),n._dragFlag=!1},!1),t||n.isInPanningMode||(drag_element_1.default.dragObject(r[0],i[0],null,null,null,function(){n.onDragElStart()},function(){n.onDragElMove()},function(){n.onDragElEnd()},!1),1===this.currentElementsSelection.length&&this.interactHandler(i[0].id))}else this.highlightSelectedEl($(i[0].parentElement))}},RuntimeEditor.prototype.getTransformOriginPositionPoint=function(e){var t=enums_1.default.TransformDefaultValue["transform-origin-x"],i=enums_1.default.TransformDefaultValue["transform-origin-y"],n=$("#"+e),o=this.mappedWidgets[e].widget["transform-origin"];o&&(t=o["transform-origin-x"]||t,i=o["transform-origin-y"]||i);var r=parseFloat(n.css("border-width"));t=units_conversion_1.default.convertUnitsToPixel(e,t,"transform-origin-x"),i=units_conversion_1.default.convertUnitsToPixel(e,i,"transform-origin-y");var s=$(this.scenePreviewEl).offset();t=parseFloat(t)-r-5,i=parseFloat(i)-r-5;var a=this.mappedWidgets[e].widget,d=$('<point class="transform-origin-point-temp" style="left: '+t+"px; top: "+i+'px"></point>'),l=$("<div></div>");if("image"===a.type||"video"===a.type||"inputText"===a.type||"select"===a.type||"li"===a.type||"ul"===a.type||"ol"===a.type||"range"===a.type||"number"===a.type||"radio"===a.type||"checkbox"===a.type){var p=new WebKitCSSMatrix(window.getComputedStyle(n[0]).webkitTransform),c=n.css("transform-origin"),u="matrix3D("+p.m11+", "+p.m12+", "+p.m13+", "+p.m14+",\n                            "+p.m21+", "+p.m22+", "+p.m23+", "+p.m24+",\n                            "+p.m31+", "+p.m32+", "+p.m33+", "+p.m34+",\n                            "+p.m41+", "+p.m42+", "+p.m43+", "+p.m44+")",m=n.css("width"),h=n.css("height"),f=n.css("top"),g=n.css("left"),v=n.css("border");(l=$('<div style="opacity: 0.5;background: red; position: absolute; border: '+v+"; top: "+f+"; left: "+g+";\n                                    width: "+m+"; height: "+h+"; transform: "+u+"; transform-origin: "+c+'"></div>')).append(d),$(n[0].parentElement).append(l)}else $(n).append(d);var y=d[0].getBoundingClientRect(),_={x:(y.right-y.left)/2,y:(y.bottom-y.top)/2},b={transformOriginX:(y.left+_.x-s.left-5)/this.getSceneScale(),transformOriginY:(y.top+_.y-s.top-5)/this.getSceneScale()};return l.remove(),d.remove(),b},RuntimeEditor.prototype._elementSelectionHelper=function(e){this.currentElementsSelection=[],this.currentElementsSelection[0]=e,this.currentParentElementsSelection=[],this.currentParentElementsSelection[0]=e},RuntimeEditor.prototype.computeSelectCorners=function(e,t){var i,n=getComputedStyle(e[0],null);i=t?$(t):$(".select-corners");var o={left:parseFloat(n.getPropertyValue("border-left-width"))+parseFloat(n.getPropertyValue("margin-left")),right:parseFloat(n.getPropertyValue("border-right-width"))+parseFloat(n.getPropertyValue("margin-right")),top:parseFloat(n.getPropertyValue("border-top-width"))+parseFloat(n.getPropertyValue("margin-top")),bottom:parseFloat(n.getPropertyValue("border-bottom-width"))+parseFloat(n.getPropertyValue("margin-bottom"))},r=function_helpers_1.default.getAbsolutePosition(e[0],"scene"),s={x:0,y:0};"scene"!==e[0].parentElement.id&&(s=function_helpers_1.default.calcElementTransformedMatrixCoords(e[0],"scene"));var a=o.left+o.right,d=o.top+o.bottom,l={width:$(e).width()+a+parseFloat(n.getPropertyValue("padding-right"))+parseFloat(n.getPropertyValue("padding-left")),height:$(e).height()+d+parseFloat(n.getPropertyValue("padding-top"))+parseFloat(n.getPropertyValue("padding-bottom")),top:r.top+s.y,left:r.left+s.x},p=this.mappedWidgets[e[0].id].widget;this.transformChildren(p),!p.transformed_position||main_1.default.EXPORTING_WIDGET||main_1.default.EXPORTING_COMPONENT?delete p.transformed_position:(this.transform.transform(p),l=function_helpers_1.default.getTransformedElMaskPos(p)),i.css({top:l.top,left:l.left,width:l.width,height:l.height,position:"absolute"}),1!==this.currentElementsSelection.length||this._isElementRotated||this.updateTransformOriginPoint(p,l,i)},RuntimeEditor.prototype.updateTransformOriginPoint=function(e,t,i){var n=i||$(".select-corners"),o={top:0,left:0};t?o=t:(o.top=parseFloat(n.css("top")),o.left=parseFloat(n.css("left")));var r;r=0===$(".transform-origin-point").length?$('<point class="transform-origin-point" data-origin-id="'+e.id+'"></point>'):$(".transform-origin-point");var s=this.getTransformOriginPositionPoint(e.id),a=s.transformOriginX,d=s.transformOriginY;a-=this.sceneBorderSize*(this.getSceneScale()-.1),d-=this.sceneBorderSize*(this.getSceneScale()-.1),0===$('#scene > .transform-origin-point[data-origin-id="'+e.id+'"]').length&&$(this.scenePreviewEl).append(r),r.css({left:a,top:d})},RuntimeEditor.prototype.removeWidgets=function(e,t){for(var i=$("#sceneTree").jstree(),n=$.extend(!0,{},i),o=0;o<e.length;o++)this.removeWidget(e[o],t,n)},RuntimeEditor.prototype.removeWidget=function(e,t,i){if(i)i.deselect_all(!0),i.search(e);else var i=$("#sceneTree").jstree();var n=i.get_node($('li[data-id="'+e+'"]'));if(this._lastDeletedAnimationWidgets={},n){var o=n.id,r=n.li_attr["data-id"],s=[],a=n.parent,d=$("#edit-menu").find(".btn-dynamic");d.hasClass("disabled")||d.addClass("disabled");for(var l=i.get_node(a).children,p=-1,c=!1,u=!1,m=this.mappedWidgets[r],h=0;h<n.parents.length-1;h++){var f=i.get_node(n.parents[h]);s.push(f.li_attr["data-id"])}for(;p<l.length;)if(p++,l[p]===o){var g=i.get_node(a).children[p-1];void 0!==g?c=i.get_node(g).li_attr["data-id"]:u=s[0];break}var v={widget:m,widgetParentIds:s,parentElementId:s[0],jstreeParent:a,jstreePosition:p,jstreeNodeBeforeId:c,jstreeNodeAppendId:u,isNewWidget:t};this._deleteSceneWidgetObj(s,r),this._deleteWidgetsAndAnimations(r),v.animationData={},v.animationData=this._lastDeletedAnimationWidgets;var y=this.getRedoUndoPrimaryState();this._sceneActionState.deleteElement=!0,this.createUndoRedoCommand(y,r,null,null,null,v),$("#sceneTree").jstree().delete_node(o),$("#"+e).remove(),this.propertiesElBar.empty(),$(".select-corners").remove(),$(".transform-origin-point").remove(),this.exportScene(),$(".info-widgets").getNiceScroll().resize()}},RuntimeEditor.prototype._deleteSceneWidgetObj=function(e,t){var i=e.length,n=this.scene.widgets,o=n.length;if(0===i){for(a=0;a<o;a++)if(t===n[a].id)return void n.splice(a,1)}else{var r,s=0;e.reverse();for(var a=0;a<o;a++)e[0]===n[a].id&&(r=n[a],s++);var d=function(i){for(var n=0;n<r.children.length;n++){if(t===r.children[n].id)return void r.children.splice(n,1);i===r.children[n].id&&(s++,r=r.children[n],d(e[s]))}};d(e[s])}},RuntimeEditor.prototype._deleteWidgetsAndAnimations=function(e){function t(e){for(var n=e.length,o=0;o<n;o++){var r=e[o];i._lastDeletedAnimationWidgets[r.id]=$.extend(!0,{},i.scene.animations[r.id]),i.Animations.deleteWidget(r.id),delete i.mappedWidgets[r.id],r.children.length>0&&t(r.children)}}var i=this;this._lastDeletedAnimationWidgets[e]=$.extend(!0,{},this.scene.animations[e]),t(this.mappedWidgets[e].widget.children),this.Animations.deleteWidget(e),delete this.mappedWidgets[e]},RuntimeEditor.prototype.saveUndoRedo=function(e,t,i,n,o){function r(r){var a=o||t;s.createUndoRedoCommand(r,e,a,t,i,n)}var s=this,a=this._sceneActionState,d=main_1.default.openFiles[this.editorTabName];"new action"!==a.primaryAction&&"redo"!==a.primaryAction||(void 0!==d.redo[0]&&(undoLenCommands=d.redo[0].length),r("undo")),"undo"===a.primaryAction&&(void 0!==d.undo[0]&&(redoLenCommands=d.undo[0].length),r("redo"))},RuntimeEditor.prototype.allowAutoKeyframe=function(e,t){return this.autoKeyframe&&!this._sceneActionState.draggingTimelinePin&&allowedKeyframeProperies_1.default[e]&&!t&&"new action"===this._sceneActionState.primaryAction},RuntimeEditor.prototype.setDropShadowProps=function(e){var t=this.mappedWidgets[e].widget;t["-webkit-filter"]||(t["-webkit-filter"]={}),t["-webkit-filter"].dropShadowY||(t["-webkit-filter"].dropShadowY="0px"),t["-webkit-filter"].dropShadowX||(t["-webkit-filter"].dropShadowX="0px"),t["-webkit-filter"].dropShadowBlur||(t["-webkit-filter"].dropShadowBlur="0px"),t["-webkit-filter"].dropShadowColor||(t["-webkit-filter"].dropShadowColor="rgb(0, 0, 0)")},RuntimeEditor.prototype.saveProperties=function(e,t,i,n,o){var r=enums_1.default.SavePropertiesTypes,s=!1;(this._skipUndoRedoSteps>0||function_helpers_1.default.notAllowedForAnimation(i,n))&&(s=!0);var a=this.scene.animations[e];if(("transform"===t||"-webkit-filter"===t)&&!this._sceneActionState.initialLoad&&a&&a[a.className]&&!this._sceneActionState.draggingTimelinePin&&"new action"===this._sceneActionState.primaryAction&&!this.autoKeyframe){var d=a[a.className].keyframes.transform;d&&(d[i]?d[i]&&(p=d[i][0])&&0===p.time.seconds&&(this.forceAutoKeyframes=!0):this.forceAutoKeyframes=!0);var l=a[a.className].keyframes["-webkit-filter"];if(l)if(l[i]){if(l[i]){var p=l[i][0];p&&0===p.time.seconds&&(this.forceAutoKeyframes=!0)}}else this.forceAutoKeyframes=!0}if(!this.allowAutoKeyframe(i,s)&&!this.forceAutoKeyframes||s||(this._undoCreationStepsLength+=1),"id property"===t&&(this.mappedWidgets[n]={widget:this.mappedWidgets[e].widget},this.mappedWidgets[e].widget[i]=n,e!==n&&delete this.mappedWidgets[e]),0===this._skipUndoRedoSteps){var c=$("#"+e).length;"events"===o||this._sceneActionState.draggingTimelinePin||this._sceneActionState.pasteWidget||"className"===i&&0===c&&"new action"!==this._sceneActionState.primaryAction||this.saveUndoRedo(e,t,i,n,o)}else this._skipUndoRedoSteps--;if("image"===t&&(this.mappedWidgets[e].widget[i]=n),"boxShadow"===t&&("insetOutset"!==i&&"color"!==i&&(n=parseFloat(n)+"px"),this.mappedWidgets[e].widget.boxShadow[i]=n),"-webkit-filter"===t&&("dropShadowColor"!==i&&"dropShadowBlur"!==i&&"dropShadowY"!==i&&"dropShadowX"!==i||this.setDropShadowProps(e),this.mappedWidgets[e].widget["-webkit-filter"]=this.mappedWidgets[e].widget["-webkit-filter"]||{},this.mappedWidgets[e].widget["-webkit-filter"][i]=this.mappedWidgets[e].widget["-webkit-filter"][i]||{},0!==n&&"0deg"!==n&&"0px"!==n||"dropShadowX"===i||"dropShadowY"===i||"dropShadowColor"===i||"dropShadowBlur"===i?this.mappedWidgets[e].widget["-webkit-filter"][i]=n:delete this.mappedWidgets[e].widget["-webkit-filter"][i]),"transform"===t&&(this.mappedWidgets[e].widget.transform[i]=n),"transform-origin"===t&&(this.mappedWidgets[e].widget["transform-origin"][i]=n),"perspective-origin"===t&&(this.mappedWidgets[e].widget["perspective-origin"][i]=n),"css property"!==t&&"set text"!==t&&"class property"!==t&&"checked"!==t&&"font"!==t||(this.mappedWidgets[e].widget[i]=n),"geometry"!==t&&t!==r.Events.Local.modular&&"attrs"!==t&&"styles"!==t&&"dataBindings"!==t||(this.mappedWidgets[e].widget[t][i]=n),t!==r.Events.Engine.call&&t!==r.Events.Engine.trigger&&t!==r.Events.Local.javascript&&t!==r.Events.Engine.blueprint||(this.mappedWidgets[e].widget.events[i]={},this.mappedWidgets[e].widget.events[i][t]=n),"remove property"===t&&delete this.mappedWidgets[e].widget[o][i],t===r.Events.Local.empty&&delete this.mappedWidgets[e].widget.events[i],this.allowAutoKeyframe(i,s)||this.forceAutoKeyframes){var u=this.Timeline.getPinTime();"css property"===t&&(t="styles");var m=this.styleValuesCollector.getValue(t,i,this.mappedWidgets[e].widget),h=enums_1.default.StylePropToKeyframeProp[t][i];if("transform-origin-x"===i||"transform-origin-y"===i){var f="50%",g="50%";this.mappedWidgets[e].widget["transform-origin"]&&(f=this.mappedWidgets[e].widget["transform-origin"]["transform-origin-x"]||"50%",g=this.mappedWidgets[e].widget["transform-origin"]["transform-origin-y"]||"50%"),m=f+" "+g}else if("perspective-origin-x"===i||"perspective-origin-y"===i){var v="50%",y="50%";this.mappedWidgets[e].widget["perspective-origin"]&&(v=this.mappedWidgets[e].widget["perspective-origin"]["perspective-origin-x"]||"50%",y=this.mappedWidgets[e].widget["perspective-origin"]["perspective-origin-y"]||"50%"),m=v+" "+y}else"background"===i?(t="backgroundColor",m=function_helpers_1.default.convertColorValues(m)):"-webkit-filter"===t&&(m=this.getFilterValues(this.mappedWidgets[e].widget,"-webkit-filter",h));var _=this.scene.animations[e];_&&_[_.className].keyframes.transform&&this.forceAutoKeyframes&&(!_[_.className].keyframes.transform[i]||Object.keys(_[_.className].keyframes.transform[i]).length<2)&&(u={offset:-4,seconds:0}),_&&_[_.className].keyframes["-webkit-filter"]&&this.forceAutoKeyframes&&(!_[_.className].keyframes["-webkit-filter"][i]||Object.keys(_[_.className].keyframes["-webkit-filter"][i]).length<2)&&(u={offset:-4,seconds:0}),this.Animations.addKeyframe(e,t,h,m,u)}this._sceneActionState.draggingTimelinePin||1!==this._undoCreationStepsLength||0!==this._skipUndoRedoSteps||(this.exportScene(),s&&(s=!1)),"transform"===t&&function_helpers_1.default.syncTransformAnimations(e,i),"-webkit-filter"===t&&function_helpers_1.default.syncFiltersAnimations(e,i),this.forceAutoKeyframes=!1},RuntimeEditor.prototype._setUndoRedoType=function(e,t){var i;return!0===this._sceneActionState.createElement?(i="createElement",this._sceneActionState.createElement=!1):!0===this._sceneActionState.createNewWidget?(i="createElement",this._sceneActionState.createNewWidget=!1):!0===this._sceneActionState.deleteElement?(i="deleteElement",this._sceneActionState.deleteElement=!1):!0===this._sceneActionState.widgetOption?(i="widgetOption",this._sceneActionState.widgetOption=!1):!0===this._sceneActionState.moveElement?(i="moveElement",this._sceneActionState.moveElement=!1):!0===this._sceneActionState.addFile?(i="deleteFile",this._sceneActionState.addFile=!1):!0===this._sceneActionState.deleteFile?(i="addFile",this._sceneActionState.deleteFile=!1):!0===this._sceneActionState.addKeyframe?(i="addKeyframe",this._sceneActionState.addKeyframe=!1):!0===this._sceneActionState.deleteKeyframe?(i="deleteKeyframe",this._sceneActionState.deleteKeyframe=!1):!0===this._sceneActionState.moveKeyframe?(i="moveKeyframe",this._sceneActionState.moveKeyframe=!1):!0===this._sceneActionState.deleteAnimationClassGlobal?(i="deleteAnimationClassGlobal",this._sceneActionState.deleteAnimationClassGlobal=!1):!0===this._sceneActionState.addAnimationClassGlobal?(i="addAnimationClassGlobal",this._sceneActionState.addAnimationClassGlobal=!1):!0===this._sceneActionState.createComponent?(i="createComponent",this._sceneActionState.createComponent=!1):!0===this._sceneActionState.deleteComponent?(i="deleteComponent",this._sceneActionState.deleteComponent=!1):!0===this._sceneActionState.setAnimationOptions?(i="setAnimationOptions",this._sceneActionState.setAnimationOptions=!1):i="background"===t||"color"===t||"borderColor"===t||"dropShadowColor"===t||"boxShadow"===e&&"color"===t?"color":"property",i},RuntimeEditor.prototype.createUndoRedoCommand=function(e,t,i,n,o,r){var s=this,a=this._sceneActionState.createNewWidget,d=this._setUndoRedoType(i,o),l={};if(l[d]={widgetId:t,propGroup:i,propKey:o},"object"==typeof r)switch(d){case"deleteComponent":l[d].createComponent=r;break;case"createComponent":l[d].deleteComponent=r;break;case"deleteElement":l[d].createWidget=r;break;case"createElement":l[d].deleteWidget=r,l[d].isNewWidget=a;break;case"moveElement":l[d].moveWidget=r;break;case"widgetOption":l[d].options=r;break;case"addFile":case"deleteFile":l[d].params=r;break;case"addKeyframe":l[d].deleteKeyframe=r;break;case"deleteKeyframe":l[d].addKeyframe=r;break;case"moveKeyframe":case"setAnimationOptions":case"deleteAnimationClassGlobal":case"addAnimationClassGlobal":l[d].params=r}switch(i){case"geometry":l[d].value=s.mappedWidgets[t].widget[n][o]||"0";break;case"image":l[d].value=r;break;case"units":"fontSize"===o?l[d].value=s.mappedWidgets[t].widget[o]||"auto":function_helpers_1.default.isTransformProperty(o)?l[d].value=s.mappedWidgets[t].widget[n][o]||enums_1.default.TransformDefaultValue[o]:void 0!==s.mappedWidgets[t].widget[n]?l[d].value=s.mappedWidgets[t].widget[n][o]||"auto":l[d].value="auto";break;case"css property":l[d].value=s.mappedWidgets[t].widget[o];break;case"element-text":case"element-class":this._sceneActionState.editAnimationClass&&(l[d].editAnimationClass=this._sceneActionState.editAnimationClass),l[d].value=s.mappedWidgets[t].widget[o]||"";break;case"checked":l[d].value=s.mappedWidgets[t].widget[o];break;case"dataBindings":n="remove property"===n?i:n,l[d].value=s.mappedWidgets[t].widget[n][o]||"";break;case"element-id":l[d].widgetId=r,l[d].value=t;break;case"transform":case"-webkit-filter":case"transform-origin":case"perspective-origin":case"boxShadow":if(function_helpers_1.default.isTransformProperty(o))if("deleteKeyframe"!==d){var p;if("perspective-origin-x"===o||"perspective-origin-y"===o)p=s.mappedWidgets[t].widget[i][o]||enums_1.default.TransformDefaultValue[o];else if("transform-origin"!==o)p=s.mappedWidgets[t].widget[i][o]||enums_1.default.TransformDefaultValue[o];else{var c=s.mappedWidgets[t].widget[i];p=(c["transform-origin-x"]||enums_1.default.TransformDefaultValue[o])+" "+(c["transform-origin-y"]||enums_1.default.TransformDefaultValue[o])}l[d].value=function_helpers_1.default.getTransformProperty(p,o)}else l[d].value=r.value;else"rotate"===o?l[d].value=s.mappedWidgets[t].widget[n][o]||"0deg":"color"!==o&&"insetOutset"!==o?l[d].value=s.mappedWidgets[t].widget[n][o]||enums_1.default[n+"DefaultValues"][o]:"color"===o?l[d].value=s.mappedWidgets[t].widget[n][o]||"#000":"insetOutset"===o&&(l[d].value=s.mappedWidgets[t].widget[n][o]||"remove");break;case"attrs":case"styles":var u="";"backgroundSizeWidth"===o||"backgroundSizeHeight"===o?u="auto":"transformStyle"===o?u="flat":"perspective"===o&&(u="0px"),l[d].value=s.mappedWidgets[t].widget[n][o]||u;break;case"font":l[d].value=s.mappedWidgets[t].widget[o]||"auto"}this._setUndoRedoCommandsFill(l)},RuntimeEditor.prototype._setUndoRedoCommandsFill=function(e){main_1.default.tabEdited(!0);var t=Object.keys(e)[0],i=this.getRedoUndoPrimaryState();"undo"!==i&&"new action"!==i||this._undoCommandsFill(e,t),"redo"===i&&this._redoCommandsFill(e)},RuntimeEditor.prototype._undoCommandsFill=function(e,t){var i=this._sceneActionState;if("new action"===i.primaryAction){if(this._undoCreationStepsLength>1)return commandUndo.push(e),void this._undoCreationStepsLength--;this.clearRedoCommands()}if("redo"===i.primaryAction&&undoLenCount!==undoLenCommands)return commandUndo.push(e),void undoLenCount++;commandUndo.push(e),main_1.default.openFiles[this.editorTabName].undo.unshift(commandUndo),undoLenCount=1,undoLenCommands=0,this._undoCreationStepsLength=1,commandUndo=[]},RuntimeEditor.prototype.clearRedoCommands=function(){main_1.default.openFiles[this.editorTabName].redo=[]},RuntimeEditor.prototype._redoCommandsFill=function(e){if(redoLenCount!==redoLenCommands)return commandRedo.push(e),void redoLenCount++;commandRedo.push(e),main_1.default.openFiles[this.editorTabName].redo.unshift(commandRedo),redoLenCount=1,redoLenCommands=0,commandRedo=[]},RuntimeEditor.prototype.addEvent=function(e,t,i){document.getElementById(e).addEventListener(t,window.editorEvents[i],!1)},RuntimeEditor.prototype.removeEvent=function(e,t,i){document.getElementById(e).removeEventListener(t,window.editorEvents[i],!1)},RuntimeEditor.prototype.inputNumbersFocusInOutHandler=function(e){$("#"+e+' input[type="number"]').focusin(function(){$(this).addClass("dark-arrows-numbers")}),$("#"+e+' input[type="number"]').focusout(function(){$(this).removeClass("dark-arrows-numbers")})},RuntimeEditor.prototype.initKendoProperties=function(e){$("#properties-wrap").kendoPanelBar({animation:"none"}),$("#properties").kendoPanelBar({animation:"none"}),$(".k-list-container:not(#scene-aspect-ratio-list, #scene-events-split-button_optionlist)").remove(),$("#left-pane select").kendoDropDownList({animation:!1}),void 0!==e.boxShadow&&this.initBoxShadowColorPicker(e),void 0!==e["-webkit-filter"]&&this.initFilterColorPicker(e),main_1.default.isBasicPanelOpen||$("#properties").data("kendoPanelBar").collapse("#basic-properties")},RuntimeEditor.prototype.kendoPropertiesHandler=function(){var e=$("#properties").data("kendoPanelBar"),t=function(e){"basic-properties"===e.item.id&&(main_1.default.isBasicPanelOpen=!0),-1===main_1.default.currentOpenedTabs.indexOf(e.item.id)&&main_1.default.currentOpenedTabs.push(e.item.id)},i=function(e){if("basic-properties"!==e.item.id||(main_1.default.isBasicPanelOpen=!1,-1!==main_1.default.currentOpenedTabs.indexOf("basic-properties"))){var t=main_1.default.currentOpenedTabs.indexOf(e.item.id);main_1.default.currentOpenedTabs.splice(t,1)}};e.unbind("expand",t),e.bind("expand",t),e.unbind("collapse",i),e.bind("collapse",i)},RuntimeEditor.prototype.expandKendoPanels=function(e,t){var i=this,n=t,o=function(e){return-1===enums_1.default.noBorderPropertyElements.indexOf(e)},r={"geometry-properties":function(){$("#geometry-properties").off(),i._renderGeometryPropertiesPanel(e)},"text-properties":function(){$("#text-properties").off(),i._renderTextPropertiesPanel(e)},"border-style-properties":function(){$("#border-style-properties").off(),o(e.type)&&i._renderBorderPropertiesPanel(e)},"events-properties":function(){$("#events-propertie").off(),i._renderEventPropertiesBar(e)},"transform-properties":function(){$("#transform-properties").off(),i._renderTransformPropertiesBar(e)},"data-binding-properties":function(){$("#data-binding-properties").off(),i._renderDataBindingPropertiesBar(e)},"blend-modes-properties":function(){$("#blend-modes-properties").off(),i._renderBlendModesPanel(e)}};if(n.length>0)for(var s=0;s<n.length;s++){var a=n[s];"function"==typeof r[n[s]]&&r[a](),$("#properties").data("kendoPanelBar").expand("#"+t[s])}},RuntimeEditor.prototype.initBoxShadowColorPicker=function(e){var t=this,i=$("#boxShadow-picker"),n=function(i){t.saveProperties(e.id,"boxShadow","color",i);var n=t.buildBoxShadowProperty(e);t.applyProperties(e.id,"css property","boxShadow",n)};i.kendoColorPicker({buttons:!1,open:function(){t.colorPickerLeftReposition()},close:function(){t.colorPickerRemoveLeftReposition();var e=i.data("kendoColorPicker").value();t._sceneActionState.primaryAction="new action",n(e)},select:function(n){i.data("kendoColorPicker").value(n.value);var o=t.buildBoxShadowProperty(e);t.applyProperties(e.id,"css property","boxShadow",o)},value:e.boxShadow.color,opacity:!0})},RuntimeEditor.prototype.initFilterColorPicker=function(e){var t=this,i=$("#dropShadow-picker"),n=function(){var n=i.data("kendoColorPicker").value(),o=document.getElementById(e.id);t.saveProperties(e.id,"-webkit-filter","dropShadowColor",n),function_helpers_1.default.splitCssStringProperties(e.id,o.style.webkitFilter,"webkitFilter","dropShadowColor",n,function(i){t.applyProperties(e.id,"css property","-webkit-filter",i)})},o=e["-webkit-filter"].dropShadowColor,r="#000";o&&(r=o instanceof Array?o[0]:o),i.kendoColorPicker({buttons:!1,open:function(){t.colorPickerLeftReposition(),$("body").on("mouseup",function(){t._sceneActionState.primaryAction="new action",n()})},close:function(){t.colorPickerRemoveLeftReposition(),$("body").off("mouseup")},select:function(e){i.data("kendoColorPicker").value(e.value),n()},value:r,opacity:!0})},RuntimeEditor.prototype.setUnitNumberToolbar=function(e,t){var i=t.replace(/[^\d.-]+/,""),n=function_helpers_1.default.getUnitStyle(t),o=$('input[data-property-key="'+e+'"]');o.attr("disabled",!1),"px"===n||"deg"===n?(o.attr("step",1),o.val(Math.round(i))):"auto"===n||function_helpers_1.default.isBackgroundPositionString(t)?function_helpers_1.default.disableKendoInput(e):(o.attr("step",.1),o.val(i))},RuntimeEditor.prototype._setUnits=function(e,t,i,n,o,r){var s,a,d,l="css property",p=n,c=this._getPropertyGroup(o);if(void 0!==r)return function_helpers_1.default.isBackgroundPositionString(r)?(d=r,s=function_helpers_1.default.getStringPropertyPercent(r)):(d=function_helpers_1.default.getUnitStyle(r),s=units_conversion_1.default.convertUnitsToPixel(i,r,o)),this.selectKendoDropdownItem(p,o,d),this.setUnitNumberToolbar(o,r),this.saveProperties(i,c,o,r,p),void this.applyProperties(i,l,o,s);if(d=e.find(":selected").val(),function_helpers_1.default.isBackgroundPositionString(d))return a=function_helpers_1.default.getStringPropertyPercent(d),this.setUnitNumberToolbar(o,d),this.saveProperties(i,c,o,d,p),void this.applyProperties(i,l,o,a);a=t[c]?t[c][o]:t[o],function_helpers_1.default.isTransformProperty(o)&&void 0===a&&(a=enums_1.default.TransformDefaultValue[o]),function_helpers_1.default.isBackgroundPositionString(a)&&(a="center"===a||"bottom"===a||"right"===a?this._fixBackgroundPercentage(a,i,o):function_helpers_1.default.getStringPropertyPercent(a)),"auto"!==d?s=units_conversion_1.default.convertUnitsToPixel(i,a,o):("geometry"!==c&&"-webkit-mask-sizeHeight"!==o&&"-webkit-mask-sizeWidth"!==o&&(l="remove css property",c="remove property"),s=d);var u=units_conversion_1.default.convertPixelToUnit(i,s,d,o);if("auto"!==u){var m=function_helpers_1.default.getUnitStyle(u);u=parseFloat(u).toFixed(this.formatTo)+m}function_helpers_1.default.isTransformProperty(o)&&(l="transform"),"width"!==o&&"height"!==o||"%"!==function_helpers_1.default.getUnitStyle(u)||(s=u),this.setUnitNumberToolbar(o,u),this.saveProperties(i,c,o,u,p),this.applyProperties(i,l,o,s),"auto"!==s||"top"!==o&&"left"!==o||(this.clearSelectedElements(),this.selectJstreeItem(t.id))},RuntimeEditor.prototype._fixBackgroundPercentage=function(e,t,i){var n=function_helpers_1.default.getStringPropertyPercent(e),o=function_helpers_1.default.getBackgroundSize($("#"+t)[0]),r=parseFloat(units_conversion_1.default.convertUnitsToPixel(t,n,i));return"center"===e?r-="backgroundPositionX"===i?o.width/2:o.height/2:"bottom"!==e&&"right"!==e||(r-="backgroundPositionX"===i?o.width:o.height),units_conversion_1.default.convertPixelToUnit(t,r,"%",i)},RuntimeEditor.prototype._getPropertyGroup=function(e){return"fontSize"===e?"font":"borderWidth"===e||"borderTopLeftRadius"===e||"borderTopRightRadius"===e||"borderBottomLeftRadius"===e||"borderBottomRightRadius"===e||"backgroundSizeWidth"===e||"backgroundSizeHeight"===e||"backgroundPositionX"===e||"backgroundPositionY"===e||"-webkit-mask-position-x"===e||"-webkit-mask-position-y"===e||"-webkit-mask-sizeWidth"===e||"-webkit-mask-sizeHeight"===e||"padding"===e?"styles":function_helpers_1.default.isTransformProperty(e)?"transform":"geometry"},RuntimeEditor.prototype._setBackgroundColor=function(e,t,i,n,o,r){this.setPropertiesBarValue(i,n,o,r),this.saveProperties(i,"css property","background",r),this.applyProperties(i,"css property","background",r)},RuntimeEditor.prototype._setBorderColor=function(e,t,i,n,o,r){this.setPropertiesBarValue(i,n,o,r),this.saveProperties(i,"css property","borderColor",r),this.applyProperties(i,"css property","borderColor",r)},RuntimeEditor.prototype._setColor=function(e,t,i,n,o,r){this.setPropertiesBarValue(i,n,o,r),this.saveProperties(i,"css property","color",r),this.applyProperties(i,"css property","color",r)},RuntimeEditor.prototype._setPositionType=function(e,t){var i=$('select[data-property-set="units"][data-property-key="top"]').data("kendoDropDownList"),n=$('select[data-property-set="units"][data-property-key="left"]').data("kendoDropDownList");if("relative"===t)$('input[data-property-key="left"]').prop("disabled",!0),$('input[data-property-key="top"]').prop("disabled",!0),this.setPropertiesBarValue(e.id,"geometry","left","auto"),this.setPropertiesBarValue(e.id,"geometry","top","auto"),"new action"===this._sceneActionState.primaryAction&&(this._sceneActionState.hierarchyElementMove?this._undoCreationStepsLength=4:this._undoCreationStepsLength=3,this._setProperties(e,null,"geometry","left","auto"),this._setProperties(e,null,"geometry","top","auto")),i&&(i.enable(!1),n.enable(!1));else if("absolute"===t&&(this._sceneActionState.hierarchyElementMove||($('input[data-property-key="left"]').prop("disabled",!1),$('input[data-property-key="top"]').prop("disabled",!1)),i)){var o=document.getElementById(e.id),r=o.getBoundingClientRect(),s=document.getElementById("scene").getBoundingClientRect();i.enable(!0),n.enable(!0),this._undoCreationStepsLength+=2;var a=(r.top-s.top)/this.getSceneScale()-this.sceneBorderSize,d=(r.left-s.left)/this.getSceneScale()-this.sceneBorderSize,l=function_helpers_1.default.getAbsolutePosition(o,"scene");a-=l.top,d-=l.left,this._setProperties(e,null,"geometry","left",units_conversion_1.default.convertPixelToVw(d).toFixed(2)+"vw"),this._setProperties(e,null,"geometry","top",units_conversion_1.default.convertPixelToVw(a).toFixed(2)+"vw")}this.applyProperties(e.id,"css property","position",t)},RuntimeEditor.prototype._setGeometry=function(e,t,i,n,o,r){var s,a,d,l,p=n;void 0===r?"position"===o?(a=s=e.find(":selected").val(),this._setPositionType(t,s)):(l=function_helpers_1.default.patchInputNumberBehavior({$this:e,currentWidget:t,propGroup:n,propKey:o}),d=$('select[data-property-key="'+o+'"]').find(":selected").val(),"rotation"===o?s=units_conversion_1.default.toRadians(l)+"rad":("width"===o||"height"===o)&&parseFloat(l)<0?(l=0,s=0+d,e.val(0)):s=l+d,a="width"!==o&&"height"!==o||"%"!==d?units_conversion_1.default.convertUnitsToPixel(i,e.val()+d,o):s):(s=r,a="%"===(d=function_helpers_1.default.getUnitStyle(s))?s:units_conversion_1.default.convertUnitsToPixel(i,r,o),"position"===o?(a=s,this._setPositionType(t,s),this.selectKendoDropdownItem(n,o,s)):this.setPropertiesBarValue(i,p,o,s)),""!==l&&null!==l&&(this.saveProperties(i,n,o,s,p),this.applyProperties(i,"css property",o,a),this.setUnitNumberToolbar(o,s))},RuntimeEditor.prototype._setBindings=function(e,t,i,n,o,r){var s,a=n;""===(s=r||""===r?r:e.val()).trim()&&(n="remove property"),o=function_helpers_1.default.translateDataBindNames(o,!1),t.dataBindings[o],this.saveProperties(i,n,o,s,a),this.applyProperties(i,"dataBindings",o,s),this.setDataBindingInput(a,o,s)},RuntimeEditor.prototype._setEvents=function(e,t,i,n,o,r){var s,a=enums_1.default.SavePropertiesTypes.Events,d=n,l=e.attr("data-event-type");if(t.events[o],l===a.Engine.blueprint)s=e.val(),n=a.Engine.blueprint;else if(l===a.Engine.call)s=this.buildEngineEventArray(e,"engine-call"),n=a.Engine.call;else if(l===a.Engine.trigger)s=this.buildEngineEventArray(e,"engine-trigger"),n=a.Engine.trigger;else if(l===a.Local.javascript)s=e.val(),n=a.Local.javascript;else{var p=this._setEventsByDropDown(e,n,o,d);s=p.val,n=p.propGroup}s===a.Local.empty&&(n=a.Local.empty),this.saveProperties(i,n,o,s,d),this.applyProperties(i,"events",o,s)},RuntimeEditor.prototype._setEventsByDropDown=function(e,t,i,n){var o=enums_1.default.SavePropertiesTypes.Events,r=this,s=e.find(":selected").val(),a="";if(s===o.Engine.blueprint)this.hideShowEventParams(e,"blueprintFunction"),t=o.Engine.blueprint,a=e.parents(".events-wrap").find(".set-blueprint-function").val();else if(s===o.Local.javascript){this.hideShowEventParams(e,"javascriptFunction"),t=o.Local.javascript;var d=$("#selected-element").attr("data-element-id"),l=this.mappedWidgets[d].widget.events;l[i]||(l[i]={javascriptFunction:""}),a=l[i].javascriptFunction,r.createModalJsEditor(i,o.Local.javascript,a,n)}else s===o.Engine.call?(this.hideShowEventParams(e,"engineCall"),t=o.Engine.call,a=this.buildEngineEventArray(e,"engine-call")):s===o.Engine.trigger?(this.hideShowEventParams(e,"engineTrigger"),t=o.Engine.trigger,a=this.buildEngineEventArray(e,"engine-trigger")):(this.hideShowEventParams(e),a=e.val());return{propGroup:t,val:a}},RuntimeEditor.prototype._setFonts=function(e,t,i,n,o,r){var s;if(void 0!==r)s=r;else{var a=e.val();"fontSize"===o&&a<0&&(a=0),s=a+function_helpers_1.default.getUnitStyle(t[o])}void 0===t.fontSize&&(t.fontSize="");var d=units_conversion_1.default.convertUnitsToPixel(i,s,o);this.saveProperties(i,n,o,s,n),this.applyProperties(i,"css property",o,d),this.setPropertiesBarValue(i,n,o,s)},RuntimeEditor.prototype._setAttrs=function(e,t,i,n,o,r){var s,a=n;void 0!==r?(s=r,$('[data-property-set="'+n+'"][data-property-key="'+o+'"]').val(s)):s=e.val(),this.saveProperties(i,"attrs",o,s,a),this.applyProperties(i,"attrs",o,s)},RuntimeEditor.prototype._setStyles=function(e,t,i,n,o,r){var s,a,d=n;if("borderWidth"===o||"borderTopLeftRadius"===o||"borderTopRightRadius"===o||"borderBottomLeftRadius"===o||"borderBottomRightRadius"===o||"backgroundPositionX"===o||"backgroundPositionY"===o||"-webkit-mask-position-x"===o||"-webkit-mask-position-y"===o||"padding"===o||"backgroundSizeWidth"===o||"backgroundSizeHeight"===o||"-webkit-mask-sizeWidth"===o||"-webkit-mask-sizeHeight"===o||"perspective"===o){if(void 0!==r)s=r,this.setPropertiesBarValue(i,n,o,s),a=units_conversion_1.default.convertUnitsToPixel(i,s,o);else{var l=$('select[data-property-key="'+o+'"]').find(":selected").val()||"";s=function_helpers_1.default.patchInputNumberBehavior({$this:e,currentWidget:t,propGroup:n,propKey:o})+l,a=units_conversion_1.default.convertUnitsToPixel(i,s,o)}if("backgroundSizeWidth"===o||"backgroundSizeHeight"===o)return void this.setBackgroundSizeWidthHeight(i,o,s);if("-webkit-mask-sizeWidth"===o||"-webkit-mask-sizeHeight"===o)return void this.setWebkitMaskSizeWidthHeight(i,o,s);"perspective"===o&&0===parseFloat(s)&&(a="none")}else if("perspective-origin-x"===o||"perspective-origin-y"===o){if("perspective-origin-x"===o&&!t[n]["perspective-origin-y"]){var p=$('[data-property-set="styles"][data-property-key="perspective-origin-y"]').val();t[n]["perspective-origin-y"]=p}if("perspective-origin-y"===o&&!t[n]["perspective-origin-x"]){var c=$('[data-property-set="styles"][data-property-key="perspective-origin-x"]').val();t[n]["perspective-origin-x"]=c}s=void 0!==r?r:e.val(),this.setPropertiesBarValue(i,n,o,s)}else"backgroundSize"===o||"backgroundRepeat"===o?(s=a=void 0!==r?r:e.val(),this._setBackgroundRepeatOrSize(e,t,o,n,s)):"-webkit-mask-size"===o||"webkitMaskRepeat"===o?(s=a=void 0!==r?r:e.val(),a=this._setWebkitMaskRepeatOrSize(e,t,o,n,s)):"fontFamily"===o?s=a=r:void 0!==r?(s=a=r,"textAlign"===o||"textTransform"===o||"textDecoration"===o?$('[data-property-set="'+n+'"][value="'+s+'"]').prop("checked",!0):"zIndex"===o||"flex"===o||"order"===o||"opacity"===o?$('[data-property-set="'+n+'"][data-property-key="'+o+'"]').val(s):"webkitMaskImage"===o?" "===s?this.updateBackgroundFilePathInfo("hide"):this.updateBackgroundFilePathInfo("show",s):"fontFamily"===o?$('select[data-property-set="'+n+'"][data-property-key="'+o+'"]').data("kendoDropDownList").select(function(e){return e.style===s}):this.selectKendoDropdownItem(n,o,s)):s=a=function_helpers_1.default.patchInputNumberBehavior({$this:e,currentWidget:t,propGroup:n,propKey:o});this.saveProperties(i,n,o,s,d),this.applyProperties(i,"css property",o,a)},RuntimeEditor.prototype._setBackgroundRepeatOrSize=function(e,t,i,n,o){if("auto"===o||"backgroundRepeat"===i){var r,s,a,d,l=t.styles.backgroundSizeWidth,p=t.styles.backgroundSizeHeight,c=$('input[data-property-key="backgroundSizeWidth"]'),u=$('input[data-property-key="backgroundSizeHeight"]');if("auto"===l||"auto"===p){d="px",a="px";var m=t.geometry.width,h=t.geometry.height;r=units_conversion_1.default.convertUnitsToPixel(t.id,m,i),s=units_conversion_1.default.convertUnitsToPixel(t.id,h,i),c.attr("step",1),u.attr("step",1),r=parseInt(r),s=parseInt(s)}else r=function_helpers_1.default.getUnitValue(l),s=function_helpers_1.default.getUnitValue(p),d=function_helpers_1.default.getUnitStyle(l),a=function_helpers_1.default.getUnitStyle(p),"pt"===d||"px"===d?c.attr("step",1):c.attr("step",.1),"pt"===a||"px"===a?u.attr("step",1):u.attr("step",.1),r=parseFloat(r).toFixed(this.formatTo),s=parseFloat(s).toFixed(this.formatTo);c.val(r),u.val(s),c.attr("value",r),u.attr("value",s),this.selectKendoDropdownItem("units","backgroundSizeWidth",d),this.selectKendoDropdownItem("units","backgroundSizeHeight",a),t[n].backgroundSizeWidth=r+d,t[n].backgroundSizeHeight=s+a}this.selectKendoDropdownItem(n,i,o)},RuntimeEditor.prototype._setMaskSizeKendoInputs=function(e){"auto"===e.styles["-webkit-mask-sizeHeight"]?function_helpers_1.default.disableKendoInput("-webkit-mask-sizeHeight"):function_helpers_1.default.enableKendoInput("-webkit-mask-sizeHeight"),"auto"===e.styles["-webkit-mask-sizeWidth"]?function_helpers_1.default.disableKendoInput("-webkit-mask-sizeWidth"):function_helpers_1.default.enableKendoInput("-webkit-mask-sizeWidth")},RuntimeEditor.prototype._setWebkitMaskRepeatOrSize=function(e,t,i,n,o){if("auto"===o||"backgroundRepeat"===i){var r,s,a,d,l=t.styles["-webkit-mask-sizeWidth"],p=t.styles["-webkit-mask-sizeHeight"],c=$('input[data-property-key="-webkit-mask-sizeWidth"]'),u=$('input[data-property-key="-webkit-mask-sizeHeight"]');if("auto"===l||"auto"===p){d="px",a="px";var m=t.geometry.width,h=t.geometry.height;r=units_conversion_1.default.convertUnitsToPixel(t.id,m,i),s=units_conversion_1.default.convertUnitsToPixel(t.id,h,i),c.attr("step",1),u.attr("step",1),r=parseInt(r),s=parseInt(s)}else r=function_helpers_1.default.getUnitValue(l),s=function_helpers_1.default.getUnitValue(p),d=function_helpers_1.default.getUnitStyle(l),a=function_helpers_1.default.getUnitStyle(p),"pt"===d||"px"===d?c.attr("step",1):c.attr("step",.1),"pt"===a||"px"===a?u.attr("step",1):u.attr("step",.1),r=parseFloat(r).toFixed(this.formatTo),s=parseFloat(s).toFixed(this.formatTo);return c.val(r),u.val(s),c.attr("value",r),u.attr("value",s),this.selectKendoDropdownItem("units","-webkit-mask-sizeWidth",d),this.selectKendoDropdownItem("units","-webkit-mask-sizeHeight",a),t[n]["-webkit-mask-sizeWidth"]=r+d,t[n]["-webkit-mask-sizeHeight"]=s+a,r+d+" "+s+a}return this.selectKendoDropdownItem(n,i,o),o},RuntimeEditor.prototype.setWebkitMaskSizeWidthHeight=function(e,t,i){var n=$('input[data-property-key="-webkit-mask-sizeWidth"]'),o=$('input[data-property-key="-webkit-mask-sizeHeight"]'),r=n.val(),s=o.val(),a=$('select[data-property-key="-webkit-mask-sizeWidth"]').find(":selected").val(),d=$('select[data-property-key="-webkit-mask-sizeHeight"]').find(":selected").val();if(void 0!==i){var l=function_helpers_1.default.getUnitStyle(i),p=function_helpers_1.default.getUnitValue(i);p="px"===l?parseInt(p):parseFloat(p).toFixed(this.formatTo)}var c=units_conversion_1.default.convertUnitsToPixel(e,r+a,"-webkit-mask-sizeWidth")+" "+units_conversion_1.default.convertUnitsToPixel(e,s+d,"-webkit-mask-sizeHeight");this.saveProperties(e,"styles",t,i),this.applyProperties(e,"css property","-webkit-mask-size",c)},RuntimeEditor.prototype.setBackgroundSizeWidthHeight=function(e,t,i){var n=$('input[data-property-key="backgroundSizeWidth"]'),o=$('input[data-property-key="backgroundSizeHeight"]'),r=n.val(),s=o.val(),a=$('select[data-property-key="backgroundSizeWidth"]').find(":selected").val(),d=$('select[data-property-key="backgroundSizeHeight"]').find(":selected").val();if(void 0!==i){var l=function_helpers_1.default.getUnitStyle(i),p=function_helpers_1.default.getUnitValue(i);p="px"===l?parseInt(p):parseFloat(p).toFixed(this.formatTo)}var c=units_conversion_1.default.convertUnitsToPixel(e,r+a,"backgroundSizeWidth")+" "+units_conversion_1.default.convertUnitsToPixel(e,s+d,"backgroundSizeHeight");this.saveProperties(e,"styles",t,i),this.applyProperties(e,"css property","backgroundSize",c)},RuntimeEditor.prototype.updateSelection=function(e,t){this.TEMPLATE_CACHE.set(e,t);for(i=0;i<this.currentElementsSelection.length;i++)this.currentElementsSelection[i]===e&&(this.currentElementsSelection[i]=t);for(var i=0;i<this.currentParentElementsSelection.length;i++)this.currentParentElementsSelection[i]===e&&(this.currentParentElementsSelection[i]=t)},RuntimeEditor.prototype._showValidationWarning=function(e,t){$("#top-scene-holder").trigger("mouseup"),vex.dialog.open({message:e,contentClassName:"modal-about",buttons:[$.extend({},vex.dialog.buttons.YES,{text:"OK"})],callback:t})},RuntimeEditor.prototype._setId=function(e,t,i,n,o,r){function s(){var e=t.id;$('[data-property-set="'+n+'"][data-property-key="'+o+'"]').val(e),$('[data-timeline-info-widget-id="'+i+'"] .info-widget-name').val(e)}var a,d=n;void 0!==r?(a=r,i===this.getSelectedWidgetId()&&$('[data-property-set="'+n+'"][data-property-key="'+o+'"]').val(a)):a=e.val();var l=function_helpers_1.default.validateId(a),p=void 0===this.mappedWidgets[a];""===a||" "===a?this._showValidationWarning(enums_1.default.warnMessages.idValidationWarning("ID"),function(){s()}):l&&p?(this.updateSelection(i,a),this.saveProperties(i,"id property",o,a,d),this.applyProperties(i,"id property",o,a)):l&&!p?this._showValidationWarning(enums_1.default.warnMessages.idNamesCollisionWarning,function(){s()}):l||this._showValidationWarning(enums_1.default.warnMessages.invalidCharacter,function(){s()})},RuntimeEditor.prototype._setFilter=function(e,t,i,n,o,r){var s,a=this;s=void 0!==r?"dropShadowColor"!==o?parseFloat(r):r:e.val(),this.setPropertiesBarValue(i,n,o,s);var d=n,l=$("#"+i);"blur"===o&&(s+="px"),"hue-rotate"===o&&(s+="deg"),"dropShadowBlur"!==o&&"dropShadowColor"!==o&&"dropShadowX"!==o&&"dropShadowY"!==o||this.saveProperties(i,"-webkit-filter",o,s,d),function_helpers_1.default.splitCssStringProperties(i,l[0].style[n],"webkitFilter",o,s,function(e){"dropShadowBlur"!==o&&"dropShadowColor"!==o&&"dropShadowX"!==o&&"dropShadowY"!==o&&a.saveProperties(i,"-webkit-filter",o,s,d),a.applyProperties(i,"css property","-webkit-filter",e)})},RuntimeEditor.prototype._setBoxShadow=function(e,t,i,n,o,r){var s;void 0!==r?(s=r,this.setPropertiesBarValue(i,n,o,r)):s=e.val();var a=n,d=this.mappedWidgets[i].widget;if("remove"!==s||r){this.saveProperties(i,"boxShadow",o,s,a);var l=this.buildBoxShadowProperty(d);this.applyProperties(i,"css property","boxShadow",l)}else{this._undoCreationStepsLength=6;var p=$('[data-property-set="'+n+'"][data-property-key="horizontalLength"]'),c=$('[data-property-set="'+n+'"][data-property-key="verticalLength"]'),u=$('[data-property-set="'+n+'"][data-property-key="blurRadius"]'),m=$('[data-property-set="'+n+'"][data-property-key="spreadRadius"]');this.saveProperties(i,"boxShadow","horizontalLength","0",a),this.saveProperties(i,"boxShadow","verticalLength","0",a),this.saveProperties(i,"boxShadow","blurRadius","0",a),this.saveProperties(i,"boxShadow","spreadRadius","0",a),this.saveProperties(i,"boxShadow","color","#000",a),this.saveProperties(i,"boxShadow",o,"remove",a),this.applyProperties(i,"css property","boxShadow",""),p.val(0),c.val(0),u.val(0),m.val(0)}},RuntimeEditor.prototype._setPerspectiveOrigin=function(e,t,i,n,o,r){var s,a;if(void 0!==r){if(a=!0,r.split(" ").length>1){var d=void 0,l=void 0,p=r.split(" ");l=["perspective-origin-x","perspective-origin-y"],d={"perspective-origin-x":p[0],"perspective-origin-y":p[1]};for(var c=0;c<l.length;c++)r=d[o=l[c]],this.setPropertiesBarValue(i,n,o,r),t[n][o]=r;return void this.exportScene()}s=r}else a=!1,s=function_helpers_1.default.patchInputNumberBehavior({$this:e,currentWidget:t,propGroup:n,propKey:o}),s+=$('select[data-property-set="units"][data-property-key="'+o+'"]').find(":selected").val()||"";this.saveProperties(i,"perspective-origin",o,s,n);var u=s;n=o,this.applyProperties(i,"css property",n,u),a&&this.setPropertiesBarValue(i,"perspective-origin",o,s)},RuntimeEditor.prototype._setTransformOrigin=function(e,t,i,n,o,r){var s,a;if(void 0!==r){if(a=!0,r.split(" ").length>1){var d=void 0,l=void 0,p=r.split(" ");l=["transform-origin-x","transform-origin-y"],d={"transform-origin-x":p[0],"transform-origin-y":p[1]};for(var c=0;c<l.length;c++){var u=d[o=l[c]];this.setPropertiesBarValue(i,n,o,u),t[n]||(t[n]={}),t[n][o]=u,this.applyProperties(i,"css property",o,u)}return this.computeSelectCorners($("#"+i)),void this.exportScene()}s=r}else a=!1,s=function_helpers_1.default.patchInputNumberBehavior({$this:e,currentWidget:t,propGroup:n,propKey:o}),s+=$('select[data-property-set="units"][data-property-key="'+o+'"]').find(":selected").val()||"";this.saveProperties(i,"transform-origin",o,s,n);var m=s;n=o,this.applyProperties(i,"css property",n,m),a&&this.setPropertiesBarValue(i,"transform-origin",o,s),this.computeSelectCorners($("#"+i))},RuntimeEditor.prototype._setTransform=function(e,t,i,n,o,r){var s,a;if(void 0!==r){if(a=!0,r.split(" ").length>1){var d=void 0,l=void 0;d=function_helpers_1.default.createFilterPropertyGroup(r),l=Object.keys(d);for(var p=0;p<l.length;p++)r=d[o=l[p]],this.setPropertiesBarValue(i,n,o,r),t[n][o]=r;return void this.exportScene()}s=r}else a=!1,s=function_helpers_1.default.patchInputNumberBehavior({$this:e,currentWidget:t,propGroup:n,propKey:o}),s+=$('select[data-property-set="units"][data-property-key="'+o+'"]').find(":selected").val()||"";this.saveProperties(i,"transform",o,s,n);var c=function_helpers_1.default.buildTransformStyles(t);this.applyProperties(i,"css property",n,c),a&&this.setPropertiesBarValue(i,"transform",o,s),this.transformChildren(t)},RuntimeEditor.prototype.transformChildren=function(e){if(!(main_1.default.EXPORTING_WIDGET||main_1.default.EXPORTING_COMPONENT||"undo"===this.getRedoUndoPrimaryState()||"redo"===this.getRedoUndoPrimaryState()||this._sceneActionState.pasteWidget)){var t=e.children,i=t.length;if(this.transform.transform(e),i)for(var n=0;n<i;n++){if(!this.mappedWidgets[t[n].id])return;this.transform.transform(t[n])}}},RuntimeEditor.prototype.editAnimationClassName=function(e,t,i){if(""!==i.trim())if(function_helpers_1.default.validateAnimationName(i)){var n=this.scene.animationClasses,o=this.scene.animations;n.renameProperty(t,i),n[i].className=i,this._sceneActionState.editAnimationClass={oldClassName:t,newClassName:i};var r=function_helpers_1.default.getFromTimeline('.info-class-name [data-old-animation-class="'+t+'"]').length;this._undoCreationStepsLength=r;for(var s in o)if(o[s].className===t){o[s][i]=n[i],o[s].className=i;var a=this.mappedWidgets[s].widget.className,d=function_helpers_1.default.replaceAnimationName(a,t,i);delete o[s][t],this.setClassName(null,s,d,!1),this.Timeline.setNewAnimationClass(s,i,t),this.Timeline.setOldAnimationClass(s,i,t)}this._sceneActionState.editAnimationClass=null}else{var l=this;this._showValidationWarning(enums_1.default.warnMessages.animationNameNotAllowed,function(){var t=l.mappedWidgets[e].widget.className;$('.widget-timeline-holder[data-timeline-info-widget-id="'+e+'"]').find(".animation-class-name-input").val(t)})}else this.Timeline.removeAnimationClassFromWidget(e,t,!0)},RuntimeEditor.prototype.switchAnimationClassName=function(e,t,i,n,o){void 0===o&&(o=!1);var r=this.scene.animationClasses,s=this.scene.animations,a=n;if(s[e]=s[e]||{},s[e].id=e,s[e].className=i,s[e][i]=r[i]||{},a)this.saveProperties(e,"class property","className",a,"element-class");else{a=this.mappedWidgets[e].widget.className;var d=function_helpers_1.default.replaceAnimationName(a,t,i);this._sceneActionState.switchAnimationClass||(this._skipUndoRedoSteps=1),this.setClassName(null,e,d,!0)}""!==t&&t!==i&&(this.Timeline.removeClassNameFromDOM(e,t),s[e].className?delete s[e][t]:delete s[e]),o||t===i||this.Animations.loadKeyframes(r),this.Timeline.setInputClassName(e,i,t);var l=function_helpers_1.default.getFromTimeline('[data-timeline-info-widget-id="'+e+'"] .info-class-name');l.is(":visible")?void 0===i&&(l.hide(),function_helpers_1.default.getFromTimeline('.widget-name-line[data-widget-id="'+e+'"] .keyframe-line-class-name').hide(),function_helpers_1.default.getFromTimeline('[data-timeline-info-widget-id="'+e+'"] .animation-class-name-input').hide()):(l.show(),function_helpers_1.default.getFromTimeline('.widget-name-line[data-widget-id="'+e+'"] .keyframe-line-class-name').show(),function_helpers_1.default.getFromTimeline('[data-timeline-info-widget-id="'+e+'"] .animation-class-name-input').show()),this.exportScene()},RuntimeEditor.prototype.setClassName=function(e,t,i,n){var o;if(void 0!==i){o=i;var r=$('[data-property-set="element-class"][data-property-key="className"]');this.getSelectedWidgetId()===t&&r.length>0&&r.val(o)}else o=e.val();n?o=this.loopAnimationClasses(t,o):this.saveProperties(t,"class property","className",o,"element-class"),this.applyProperties(t,"class property","className",o)},RuntimeEditor.prototype.loopAnimationClasses=function(e,t){var i="",n=this.scene.animations;if(n[e])for(var o in n[e])n[e][o]&&n[e][o].className&&(i=o);if(""!==t&&t){var r=function_helpers_1.default.doesClassNameExist(t,i),s=function_helpers_1.default.getAnimationClassesFromClassNames(t);if(!r&&""!==i)return void this.switchAnimationClassName(e,i,s[0],t);var a=s.length;a>0?(1!==a&&(t=function_helpers_1.default.removeMoreThanOneAnimationClasses(s,t)),this.switchAnimationClassName(e,i,s[0],t)):this.saveProperties(e,"class property","className",t,"element-class")}else this.Timeline.removeAnimationClassFromWidget(e,i,!1);return t},RuntimeEditor.prototype._setText=function(e,t,i,n,o,r){var s,a=$('[data-property-set="'+n+'"][data-property-key="'+o+'"]'),d=n;if(void 0!==r){var l=function_helpers_1.default.getTextSelection(a[0]),p=l.start,c=l.end;s=r,a.val(s),a[0].setSelectionRange(p,c)}else s=e.val();this.saveProperties(i,"set text",o,s,d),this.applyProperties(i,"set text",o,s)},RuntimeEditor.prototype._setChecked=function(e,t,i,n,o,r){var s,a=n;void 0!==r?("on"===(s=r)?s=!0:"off"===s&&(s=!1),$('[data-property-set="'+n+'"][data-property-key="'+o+'"]').prop("checked",s)):s=e.is(":checked"),"-coherent-layer-clip-aa"===o&&(s=s?"on":"off"),this.saveProperties(i,"checked",o,s,a),this.applyProperties(i,"checked",o,s)},RuntimeEditor.prototype.setPropertiesBarValue=function(e,t,i,n){var o,r,s=function_helpers_1.default.getUnitStyle(n);"auto"===s||"relative"===s?o=s:"rotate"===i||function_helpers_1.default.isTransformProperty(i)?o="rad"===s?(r=function_helpers_1.default.getUnitValue(n.toString())).toFixed(1):function_helpers_1.default.getUnitValue(n.toString()):"boxShadowColor"===i||"dropShadowColor"===i?o=function_helpers_1.default.getColorValue(n):"px"===s||""===s||"boxShadow"===t||"fontStyle"===i?o=n:(r=function_helpers_1.default.getUnitValue(n),o=parseFloat(r).toFixed(this.formatTo)+s);for(var a=this.currentElementsSelection.length,d=0;d<a;d++)if(this.currentElementsSelection[d]===e)switch(t){case"font":this.setFontSizeInput(n);break;case"-webkit-filter":this.setFilterInput(t,i,o);break;case"boxShadow":this.setBoxShadowInput(t,i,o);break;case"backgroundColor":this.setBackgroundInput(t,i,o);break;case"styles":"color"===i?this.setColorInput(t,i,o):"borderColor"===i?this.setBorderColorInput(t,i,o):"backgroundPositionX"===i||"backgroundPositionY"===i?function_helpers_1.default.isBackgroundPositionString(n)?($('select[data-property-set="units"][data-property-key="'+i+'"]').data("kendoDropDownList").value(n),this.setUnitNumberToolbar(i,n)):(this.setStyleInput(t,i,o,s),this.setUnitNumberToolbar(i,n)):this.setStyleInput(t,i,o,s);break;case"geometry":this.setGeometryInput(t,i,o);break;case"transform":this.setTransformInput(t,i,o);break;case"transform-origin":this.setTransformOriginInput(t,i,o);break;case"perspective-origin":this.setPerspectiveOriginInput(t,i,o)}},RuntimeEditor.prototype.setFontSizeInput=function(e){var t=$('select[data-property-set="units"][data-property-key="fontSize"]').data("kendoDropDownList");if(t){this.setUnitNumberToolbar("fontSize",e);var i=function_helpers_1.default.getUnitStyle(e);t.value(i)}},RuntimeEditor.prototype.setBackgroundInput=function(e,t,i){var n=$("#background-picker");n.length>0&&n.data("kendoColorPicker").value(i)},RuntimeEditor.prototype.setBorderColorInput=function(e,t,i){var n=$("#borderColor-picker");n.length>0&&n.data("kendoColorPicker").value(i)},RuntimeEditor.prototype.setColorInput=function(e,t,i){var n=$("#color-picker");n.length>0&&n.data("kendoColorPicker").value(i)},RuntimeEditor.prototype.setBoxShadowInput=function(e,t,i){if("insetOutset"===t)$('[data-property-set="'+e+'"][value="'+i+'"]').prop("checked",!0);else if("color"===t){var n=$("#"+e+"-picker");n.length>0&&n.data("kendoColorPicker").value(i)}else i=parseFloat(i),$('[data-property-set="'+e+'"][data-property-key="'+t+'"]').val(i)},RuntimeEditor.prototype.setTransformInput=function(e,t,i){$('input[data-property-set="'+e+'"][data-property-key="'+t+'"]').val(i)},RuntimeEditor.prototype.setTransformOriginInput=function(e,t,i){$('input[data-property-set="'+e+'"][data-property-key="'+t+'"]').val(i)},RuntimeEditor.prototype.setPerspectiveOriginInput=function(e,t,i){$('input[data-property-set="'+e+'"][data-property-key="'+t+'"]').val(i)},RuntimeEditor.prototype.setFilterInput=function(e,t,i){var n=i.toString();if("dropShadowColor"===t)$('#dropShadow-picker[data-property-set="'+e+'"][data-property-key="'+t+'"]').data("kendoColorPicker").value(n);else{var o=isNaN(Number(n))?n.match(/([-|+|#]?\d*\.?\d+)/g)[0]:n;"."===o.charAt(n.length-1)||(o=parseFloat(o)),$('[data-property-set="'+e+'"][data-property-key="'+t+'"]').val(o),$('[data-property-set="'+e+'"][data-property-key="'+t+'"]').attr("value",o)}},RuntimeEditor.prototype.setDataBindingInput=function(e,t,i){t=function_helpers_1.default.translateDataBindNames(t,!0),$('[data-property-set="'+e+'"][data-property-key="'+t+'"]').val(i)},RuntimeEditor.prototype.setGeometryInput=function(e,t,i){var n=$('select[data-property-set="units"][data-property-key="'+t+'"]').data("kendoDropDownList");if("auto"!==i){$('[data-property-set="'+e+'"][data-property-key="'+t+'"]').val(parseFloat(i));var o=function_helpers_1.default.getUnitStyle(i);n&&n.value(o)}else $('[data-property-set="'+e+'"][data-property-key="'+t+'"]').val(0),n&&n.value("auto")},RuntimeEditor.prototype.setStyleInput=function(e,t,i,n){var o;"fontWeight"===t||"fontStyle"===t?(o=$('select[data-property-set="styles"][data-property-key="'+t+'"]').data("kendoDropDownList"))&&(""!==n.trim()?o.value(n):o.value(i)):"perspective-origin-x"===t||"perspective-origin-y"===t?$('input[data-property-set="'+e+'"][data-property-key="'+t+'"]').val(i):((o=$('select[data-property-set="units"][data-property-key="'+t+'"]').data("kendoDropDownList"))&&o.value(n),$('input[data-property-set="'+e+'"][data-property-key="'+t+'"]').val(parseFloat(i)))},RuntimeEditor.prototype.buildEngineEventArray=function(e,t){for(var i=e.parents(".events-wrap").find(".form-"+t).serializeArray(),n=i.length,o=[],r=0;r<n;r++)o.push(i[r].value);return o},RuntimeEditor.prototype.initRemoveFilterPropsHandlers=function(e,t){var i=this;e.off("click"),e.on("click",{widget:t},function(e){var t=$(e.currentTarget).attr("data-type");i.setFiltersDefaults(e,t)})},RuntimeEditor.prototype.initPropertiesBarHandlers=function(e,t){function i(t){n._sceneActionState.primaryAction="new action",n._setProperties(e,$(this))}var n=this,o=$("#"+t),r=o.find('input[type="number"], input[type="text"]'),s=o.find("span.remove-filter-property, .dismiss-filters");this.initRemoveFilterPropsHandlers(s,e),n.addFontClickHandler(),r.off("input paste"),r.on("input paste",function(t){var i=this.value,o=this.getAttribute("data-property-key"),r=this.getAttribute("data-property-set"),s=function_helpers_1.default.getWidgetState(e,o,r);input_type_validations_1.configuration[o].parse&&(s=String(parseFloat(s))),s===i||input_type_validations_1.configuration[o].validateOnBlur||""===i||"."===i.substr(-1)||(n.inputValidator.validate(i,o)?(n._sceneActionState.primaryAction="new action",n._setProperties(e,$(this))):this.value=s)}),r.off("keyup"),r.on("keyup",function(e){e.keyCode!==enums_1.default.Keys.esc&&e.keyCode!==enums_1.default.Keys.enter||$(e.target).blur()}),r.off("focusout"),r.on("focusout",function(t){if(t.originalEvent){var i=this.value,o=$(this).attr("data-property-set"),r=$(this).attr("data-property-key");function_helpers_1.default.getWidgetState(e,r,o)!==i&&(n._sceneActionState.primaryAction="new action",n._setProperties(e,$(this)))}}),o.find('[type="radio"], [type="checkbox"]').bind("change",i),o.find("select").bind("change",i),o.find('input[type="range"]').bind("mouseup",i),o.find('input[type="range"]').bind("input",i),this.Animations.attachKeyframeHandlers("#"+t),o.find(".add-js-code").on("click",function(){var t=$(this).attr("data-property-set"),i=$(this).attr("data-property-key"),o=n.mappedWidgets[e.id].widget.events[i].javascriptFunction,r=enums_1.default.SavePropertiesTypes.Events;n.createModalJsEditor(i,r.Local.javascript,o,t)}),this.inputNumbersFocusInOutHandler(t)},RuntimeEditor.prototype.blurOutTextInputs=function(){this.propertiesElBar.find('input[type="text"]').blur()},RuntimeEditor.prototype.selectKendoDropdownItem=function(e,t,i){if("backgroundSize"===t||"-webkit-mask-size"===t){var n=i.split(" ");n.length>1?($("#background-properties-content .input-"+t+".wrap-property.clearfix").css("display","block"),this.setUnitNumberToolbar(t+"Width",n[0]),this.setUnitNumberToolbar(t+"Height",n[1]),this.selectKendoDropdownItem("units",t+"Width",function_helpers_1.default.getUnitStyle(n[0])),this.selectKendoDropdownItem("units",t+"Height",function_helpers_1.default.getUnitStyle(n[1])),i="auto"):"auto"!==n[0]&&$("#background-properties-content .input-"+t+".wrap-property.clearfix").css("display","none")}var o=$('select[data-property-set="'+e+'"][data-property-key="'+t+'"]');o.length>0&&o.data("kendoDropDownList").select(function(e){return e.value===i})},RuntimeEditor.prototype._setProperties=function(e,t,i,n,o){var r=this,s=i||t.attr("data-property-set"),a=n||t.attr("data-property-key");if(t){var d=o||t.context.value,l=function_helpers_1.default.getWidgetState(e,a,s);if(this.inputValidator.shouldValidate(t)&&(input_type_validations_1.configuration[a].parse&&(l=String(parseFloat(l))),!r.inputValidator.validate(d,a)))return void t.val(l)}if(void 0!==s){var p=r.mappedWidgets[e.id].widget,c=p.id;if(void 0===p[s]&&"units"!==s&&"font"!==s&&"-coherent-layer-clip-aa"!==a&&(p[s]={}),"geometry"===s&&(r._setGeometry(t,p,c,s,a,o),r.computeSelectCorners($("#"+c))),"image"===s&&r.insertImage(c,o),"transform"===s&&(r._setTransform(t,p,c,s,a,o),r.computeSelectCorners($("#"+c))),"perspective-origin"===s&&r._setPerspectiveOrigin(t,p,c,s,a,o),"transform-origin"===s&&r._setTransformOrigin(t,p,c,s,a,o),"-webkit-filter"===s&&r._setFilter(t,p,c,s,a,o),"boxShadow"===s&&r._setBoxShadow(t,p,c,s,a,o),"events"===s&&r._setEvents(t,p,c,s,a,o),"dataBindings"===s&&r._setBindings(t,p,c,s,a,o),"units"===s&&(!t||"-webkit-mask-sizeWidth"!==a&&"-webkit-mask-sizeHeight"!==a||this.forceMaskSizeUnits(t,a,p),this._setUnits(t,p,c,s,a,o)),"font"===s&&r._setFonts(t,p,c,s,a,o),"element-id"===s&&r._setId(t,p,c,s,a,o),"element-text"===s&&r._setText(t,p,c,s,a,o),"element-class"===s&&r.setClassName(t,p.id,o,!0),"checked"===s&&r._setChecked(t,p,c,s,a,o),"attrs"===s&&r._setAttrs(t,p,c,s,a,o),"styles"===s){if("borderWidth"!==a&&"padding"!==a||r.computeSelectCorners($("#"+c)),"backgroundSize"===a||"backgroundSizeWidth"===a||"backgroundSizeHeight"===a){var u=o||t[0].value,m=$(".input-"+a);"cover"===u||"contain"===u||"inherit"===u?m.is(":visible")&&m.hide():m.show()}if("-webkit-mask-size"===a||"-webkit-mask-sizeWidth"===a||"-webkit-mask-sizeHeight"===a){var h=o||t[0].value,f=$(".input-"+a);"cover"===h||"contain"===h||"inherit"===h?f.is(":visible")&&f.hide():f.show()}r._setStyles(t,p,c,s,a,o),this._setMaskSizeKendoInputs(p)}}},RuntimeEditor.prototype.forceMaskSizeUnits=function(e,t,i){var n=i.styles["-webkit-mask-sizeWidth"],o=i.styles["-webkit-mask-sizeHeight"],r=e.find(":selected").val();if("auto"===r){if("-webkit-mask-sizeWidth"===t){this._undoCreationStepsLength+=1;var s=$('[data-property-set="units"][data-property-key="-webkit-mask-sizeHeight"]');this._setProperties(i,s,"units","-webkit-mask-sizeHeight","auto")}else if("-webkit-mask-sizeHeight"===t){this._undoCreationStepsLength+=1;var a=$('[data-property-set="units"][data-property-key="-webkit-mask-sizeWidth"]');this._setProperties(i,a,"units","-webkit-mask-sizeWidth","auto")}}else if("auto"===n||"auto"===o){this._undoCreationStepsLength+=2;var d="100",l="100",p="0",c="0";"%"===r?(d+="%",l+="%"):(p=$("#"+i.id)[0].style.width,c=$("#"+i.id)[0].style.height,"px"===r?(d=p,l=c):(d=units_conversion_1.default.convertPixelToUnit(i.id,p,r,t),l=units_conversion_1.default.convertPixelToUnit(i.id,c,r,t))),this._setProperties(i,null,"styles","-webkit-mask-sizeWidth",d),this._setProperties(i,null,"styles","-webkit-mask-sizeHeight",l)}},RuntimeEditor.prototype.getStyleValue=function(e,t,i){return"color"===i?this.getTextColorValue():"borderColor"===i?this.getBorderColorValue():"borderWidth"===i||"borderTopLeftRadius"===i||"borderTopRightRadius"===i||"borderBottomLeftRadius"===i||"borderBottomRightRadius"===i||"perspective"===i?e.find('input[data-property-set="'+t+'"][data-property-key="'+i+'"]').val()+e.find('[data-property-set="units"][data-property-key="'+i+'"]').find(":selected").val():"zIndex"===i||"opacity"===i||"perspective-origin-x"===i||"perspective-origin-y"===i?e.find('input[data-property-set="'+t+'"][data-property-key="'+i+'"]').val():"backgroundPositionX"===i||"backgroundPositionY"===i||"-webkit-mask-position-x"===i||"-webkit-mask-position-y"===i?this.getBackgroundPosition(e,i):"backgroundSize"===i||"-webkit-mask-size"===i?this.getBackgroundSizeValue(e,i):"fontWeight"===i||"fontStyle"===i?this.getFontValue(null,null,i):(console.error("Attempt to get an unsupported style"),"")},RuntimeEditor.prototype.getFontValue=function(e,t,i){switch(i){case"fontSize":var n=e.find('[data-property-set="units"][data-property-key="'+i+'"]').find(":selected").val();return"auto"!==n?e.find('input[data-property-set="'+t+'"][data-property-key="'+i+'"]').val()+n:n;case"fontWeight":case"fontStyle":return $('select[data-property-set="styles"][data-property-key="'+i+'"]').data("kendoDropDownList").value()}},RuntimeEditor.prototype.getBackgroundSizeValue=function(e,t){var i=e.find('select[data-property-set="styles"][data-property-key="'+t+'"]').val();if("auto"!==i)return i;var n=this.currentElementsSelection[0],o=this.mappedWidgets[n].widget.styles;return o[t+"Width"]+" "+o[t+"Height"]},RuntimeEditor.prototype.getBackgroundPosition=function(e,t){var i=e.find('[data-property-set="units"][data-property-key="'+t+'"]').find(":selected").val();return function_helpers_1.default.isBackgroundPositionString(i)?i:e.find('input[data-property-set="styles"][data-property-key="'+t+'"]').val()+i},RuntimeEditor.prototype.getTextColorValue=function(){return $("#color-picker").data("kendoColorPicker").value()},RuntimeEditor.prototype.getBorderColorValue=function(){return $("#borderColor-picker").data("kendoColorPicker").value()},RuntimeEditor.prototype.getBackgroundColorValue=function(){return $("#background-picker").data("kendoColorPicker").value()},RuntimeEditor.prototype.getTransformValue=function(e,t,i){var n="";if("transform"===i)for(var o=enums_1.default.TransformTypes.filter(function(e){return"transform-origin-x"!==e&&"transform-origin-y"!==e}),r=0;r<o.length;r++){var s=o[r];n=n+(s+"(")+($('input[data-property-set="'+t+'"][data-property-key="'+s+'"]').val()+($('[data-property-set="units"][data-property-key="'+s+'"]').find(":selected").val()||""))+") "}else n=e.find('input[data-property-set="'+t+'"][data-property-key="'+i+'"]').val()+(e.find('[data-property-set="units"][data-property-key="'+i+'"]').find(":selected").val()||"");return n.trim()},RuntimeEditor.prototype.getTransformOriginValue=function(e,t,i){return e.find('input[data-property-set="'+t+'"][data-property-key="'+i+'"]').val()+(e.find('[data-property-set="units"][data-property-key="'+i+'"]').find(":selected").val()||"").trim()},RuntimeEditor.prototype.getGeometryValue=function(e,t,i){return e.find('input[data-property-set="'+t+'"][data-property-key="'+i+'"]').val()+e.find('[data-property-set="units"][data-property-key="'+i+'"]').find(":selected").val()},RuntimeEditor.prototype.getFilterValues=function(e,t,i){var n="",o='input[data-property-set="'+t+'"][data-property-key="'+i+'"]',r=$(".wrap-property "+o).val();if(-1===["dropShadowColor","dropShadowY","dropShadowX","dropShadowBlur","drop-shadow"].indexOf(i)){var s=filters_config_1.default[t][i].unit;"hue-rotate"===i&&e["-webkit-filter"]["hue-rotate"]&&(r=e["-webkit-filter"]["hue-rotate"],s=""),n=r+s}else this.setDropShadowProps(e.id),n+=e["-webkit-filter"][i];return n},RuntimeEditor.prototype.undoRedoScene=function(e){var t=main_1.default.openFiles[this.editorTabName][e][0],i=[];if(void 0!==t){for(var n=t.length,o=Object.keys(t[n-1])[0],r=n-1;r>=0;r--){var s=Object.keys(t[r])[0];t[r].property&&"element-id"===t[r].property.propGroup?i.push(t[r][s].value):i.push(t[r][s].widgetId),this.executeCommand(t[r],e)}main_1.default.openFiles[this.editorTabName][e].splice(0,1);var a=JSON.parse(localStorage.getItem(this.editorTabName));a[this.editorTabName][e]=main_1.default.openFiles[this.editorTabName][e],localStorage.setItem(this.editorTabName,JSON.stringify(a)),i=function_helpers_1.default.removeDuplicates(i),"createElement"!==o&&this.selectMultiJstreeItems(i),this.inputSearch.trigger("input")}redoLenCount=1,redoLenCommands=0,undoLenCount=1,undoLenCommands=0},RuntimeEditor.prototype.executeCommand=function(e,t){var i=Object.keys(e)[0];this._sceneActionState.primaryAction=t,this["_undoRedo_"+i](e,t)},RuntimeEditor.prototype._undoRedo_setAnimationOptions=function(e){var t=e.setAnimationOptions;this.Timeline["setAnimation"+t.params.type](t.widgetId,t.propGroup,t.propKey,t.params.value,t.params.className)},RuntimeEditor.prototype._undoRedo_deleteComponent=function(e){var t=e.deleteComponent.createComponent,i=t.json,n=t.name;main_1.default.openFiles[main_1.default.selectedEditor].components.create(n,i),document.body.dispatchEvent(new CustomEvent("coui.editor.rebuild")),this._initAssetsKendoToolbar(),this.Animations.loadKeyframes(this.scene.animationClasses)},RuntimeEditor.prototype._undoRedo_createComponent=function(e){var t=e.createComponent.deleteComponent.componentName;this.removeWidgetAsset(t,"widget"),this.assetsDOM=helpers_1.createVDOM(this.createAssetDOM(main_1.default.assets).template),this.activeFilterButtons&&utils_1.dispatch("coui.assets.filter",sort_helpers.filterVDOM(this.activeFilterButtons,this.assetsDOM))},RuntimeEditor.prototype._undoRedo_deleteAnimationClassGlobal=function(e){this.Timeline._addGlobalAnimationClassName(e.deleteAnimationClassGlobal.params)},RuntimeEditor.prototype._undoRedo_addAnimationClassGlobal=function(e){this.Timeline._deleteGlobalAnimationClassName(e.addAnimationClassGlobal.params.className)},RuntimeEditor.prototype._undoRedo_addKeyframe=function(e){var t=e.addKeyframe,i=t.deleteKeyframe.oldKeyframe;if(i)this.Animations.addKeyframe(t.widgetId,i.group,i.property,i.values[0],i.time);else{var n={time:t.deleteKeyframe.positions.seconds,id:t.widgetId,group:t.propGroup,prop:t.propKey,value:t.deleteKeyframe.value,className:t.deleteKeyframe.className};this.Animations.deleteKeyframe(n)}},RuntimeEditor.prototype._undoRedo_deleteKeyframe=function(e){var t=e.deleteKeyframe;this.Animations.addKeyframe(t.widgetId,t.propGroup,t.propKey,t.addKeyframe.value,t.addKeyframe)},RuntimeEditor.prototype._undoRedo_moveKeyframe=function(e){var t=e.moveKeyframe,i=function_helpers_1.default.getFromTimeline('[data-widget-id="'+t.widgetId+'"] [data-property-type="'+t.propKey+'"] [data-current-time="'+t.params.currentTime+'"]');this.Animations.onKeyframeChange(i,t.params.currentTime,t.params.oldTime)},RuntimeEditor.prototype._undoRedo_property=function(e){var t=e.property,i=this.mappedWidgets[t.widgetId],n=this.getSelectedWidgetId();this.clearSelectedElements(),n!==t.widgetId&&this.selectJstreeItem(t.widgetId);var o=t.propKey;"units"===t.propGroup&&"auto"===i.widget.geometry[o]&&(this._setProperties(i.widget,null,"geometry",t.propKey,t.value),this._skipUndoRedoSteps=1),t.editAnimationClass?this.editAnimationClassName(t.widgetId,t.editAnimationClass.newClassName,t.editAnimationClass.oldClassName):this._setProperties(i.widget,null,t.propGroup,t.propKey,t.value)},RuntimeEditor.prototype._undoRedo_color=function(e){var t,i=this,n=e.color,o=this.mappedWidgets[n.widgetId].widget,r=n.propKey,s=n.propGroup,a=r,d=n.value;this.getSelectedWidgetId()!==n.widgetId&&this.selectJstreeItem(n.widgetId);var l=!1;if(n.value instanceof Array?l=n.value[0].startsWith("url"):n.value instanceof String&&(l=n.value.startsWith("url")),!l&&(t="boxShadow"===s?$("#boxShadow-picker"):"dropShadowColor"===r?$("#dropShadow-picker"):$("#"+a+"-picker")).length>0){var p=function_helpers_1.default.getColorValue(n.value)[0];t.data("kendoColorPicker").value(p)}if(this.saveProperties(o.id,s,r,d),"boxShadow"===s){var c=this.buildBoxShadowProperty(o);this.applyProperties(o.id,"css property","-webkit-box-shadow",c)}else if("dropShadowColor"===r){var u=document.getElementById(o.id);function_helpers_1.default.splitCssStringProperties(o.id,u.style.webkitFilter,"webkitFilter","dropShadowColor",null,function(e){i.applyProperties(o.id,"css property","-webkit-filter",e)})}else"borderColor"===r&&(s="css property"),this.applyProperties(o.id,s,a,d)},RuntimeEditor.prototype._undoRedo_createElement=function(e){var t=e.createElement.widgetId,i=e.createElement.isNewWidget;this.removeWidget(t,i)},RuntimeEditor.prototype._undoRedo_widgetOption=function(e){this[e.widgetOption.options.fn](e.widgetOption.widgetId)},RuntimeEditor.prototype._undoRedo_addFile=function(e){var t=e.addFile.params;this.assetChosen(t.url,null,t.type,t.type)},RuntimeEditor.prototype._undoRedo_deleteFile=function(e){var t=e.deleteFile.params;this.deleteFile(t.index,t.type,t.url)},RuntimeEditor.prototype._undoRedo_deleteElement=function(e){var t=e.deleteElement.createWidget,i=t.widgetParentIds.reverse(),n=t.widget.widget;if(this.createElementsOnTheScene({currentWidget:n,parentWidgetId:i[0],parentJstreeNode:t.jstreeParent,jstreePosition:t.jstreePosition,jstreeAfterNodeId:t.jstreeNodeBeforeId,jstreeNodeAppendId:t.jstreeNodeAppendId,isNewWidget:t.isNewWidget}),function_helpers_1.default.isComponent(n)){var o={__Type:"widget",isFile:!0,name:n.widgetkit,url:""};main_1.default.assets.widget.some(function(e){return e.name===o.name})||main_1.default.assets.widget.push(o),this.assetsDOM=helpers_1.createVDOM(this.createAssetDOM(main_1.default.assets).template),this.virtualList.updateDOM(this.assetsDOM)}this.Animations.loadKeyframes(t.animationData[n.id])},RuntimeEditor.prototype._undoRedo_moveElement=function(e){var t=e.moveElement.widgetId,i=e.moveElement.moveWidget.oldParentJstreeId,n=e.moveElement.moveWidget.currentParentJstreeId,o=e.moveElement.moveWidget.position,r=e.moveElement.moveWidget.oldPosition;this.undoRedoMoveWidget(t,n,i,r,o)},RuntimeEditor.prototype._undoRedo_sceneProperty=function(e,t){this.setSceneStyleProperty("backgroundColor",e.sceneProperty.style.backgroundColor),$("#scene-background-picker").data("kendoColorPicker").value(e.sceneProperty.style.backgroundColor)},RuntimeEditor.prototype._undoRedo_aspectRatio=function(e,t){var i=e.aspectRatio.type;"new action"!==t&&this._setUndoRedoCommandsFill({aspectRatio:{type:this.scene.sceneSize.type,width:this.scene.sceneSize.width,height:this.scene.sceneSize.height}}),"aspectRatio_custom"===i&&(this.scene.sceneSize.width=e.aspectRatio.width,this.scene.sceneSize.height=e.aspectRatio.height),this.setAspectRatio(i),window.requestAnimationFrame(function(){var e=main_1.default.selectedEditor;main_1.default.focusCUIFile(e)})},RuntimeEditor.prototype.buildBoxShadowProperty=function(e){if(0===Object.keys(e.boxShadow).length||!e.boxShadow)return"0px 0px 0px 0px #000;";var t=e.boxShadow,i=t.insetOutset;return"none"===i&&(i=""),i+" "+t.horizontalLength+" "+t.verticalLength+" "+t.blurRadius+" "+t.spreadRadius+" "+t.color},RuntimeEditor.prototype.evalScripts=function(e,t){Promise.all(t.map(function(e){return null===/(.js)$/g.exec(e)?function(e){return $(e).html()}(e):new Promise(function(t){$.ajax({type:"GET",url:"coui://uiresources/editor/"+e,dataType:"text",success:function(e){t(e)}})})})).then(function(t){for(var i=0;i<t.length;i++)e.self===e&&e.eval(t[i])})},RuntimeEditor.prototype.removeMultipleWidgets=function(){this._sceneActionState.primaryAction="new action";var e=this.currentParentElementsSelection.filter(Boolean);this._undoCreationStepsLength=e.length,this.removeWidgets(e)},RuntimeEditor.prototype.isTopLevel=function(e){var t=document.getElementById(e);return!(!t||"scene"!==t.parentElement.id)},RuntimeEditor.prototype.isWidget=function(e){return"widget"===this.mappedWidgets[e].widget.type},RuntimeEditor.prototype.renderProperties=function(e){var t=this,i={};i.widget=e,i.env=main_1.default.preferences.couiEnvironment;var n=this.templateProperties(i);this.propertiesElBar[0].innerHTML=n,this.initKendoProperties(e),this.kendoPropertiesHandler(),this.propertiesElBar.find("#remove-widget").off(),this.propertiesElBar.find("#remove-widget").on("click",function(){t.removeMultipleWidgets()}),this.initPropertiesBarHandlers(e,"basic-properties"),this.initPropertiesBarHandlers(e,"filter-properties"),this.initPropertiesBarHandlers(e,"transform-properties"),this.initPropertiesBarHandlers(e,"boxshadow-properties"),this.initPropertiesBarHandlers(e,"blend-modes-properties"),this.textPropertiesBarHandler(e),this.blendModesBarHandler(e),this.eventsPropertiesBarHandler(e),this.filtersPropertiesBarHandler(e),this.geometryPropertiesBarHandler(e),this.transformPropertiesBarHandler(e),this.backgroundPropertiesBarHandler(e),this.borderStylePropertiesBarHandLer(e),this.dataBindingPropertiesBarHandler(e),this.expandKendoPanels(e,main_1.default.currentOpenedTabs),void 0!==e.url&&this.uploadVideoHandlers(e),"create"!==this.interactElementsState&&(this.interactElementsState="resize")},RuntimeEditor.prototype.uploadImageHandlers=function(e){$("#upload-image").on("click",function(t){main_1.default.pickAsset(e.id,"image").otherwise(function(e){console.log("error = ",e)})})},RuntimeEditor.prototype.uploadMaskImageHandlers=function(e){var t=this;$("#upload-mask-image").on("click",function(){t._sceneActionState.insertMaskImage=!0,main_1.default.pickAsset(e.id,"image").otherwise(function(e){console.log("error = ",e)})}),$("#remove-mask-image").on("click",function(){var i=e.styles.webkitMaskImage;i&&" "!==i&&(t._sceneActionState.insertMaskImage=!0,t.insertImage(e.id,""))})},RuntimeEditor.prototype.uploadVideoHandlers=function(e){$("#upload-video").on("click",function(t){main_1.default.pickAsset(e.id,"video").otherwise(function(e){console.log("error = ",e)})})},RuntimeEditor.prototype.backgroundPropertiesBarHandler=function(e){if(0!==$("#background-properties").length){var t=this,i={};i.widget=e,i.env=main_1.default.preferences.couiEnvironment;var n=t.templateBackgroundProperties(i);document.getElementById("background-properties-content").innerHTML=n,$("#background-properties-content select").kendoDropDownList({animation:!1});var o=$("#background-picker");o.kendoColorPicker({buttons:!1,open:function(){t.colorPickerLeftReposition(),o.on("mouseup",function(){var i=o.data("kendoColorPicker").value();t._sceneActionState.primaryAction="new action",t.saveProperties(e.id,"css property","background",i)})},close:function(){t.colorPickerRemoveLeftReposition(),o.off("mouseup")},select:function(i){o.data("kendoColorPicker").value(i.value),t.applyProperties(e.id,"css property","background",i.value),t.saveProperties(e.id,"css property","background",i.value)},value:t.isColorbackground(e.background),opacity:!0}),"auto"===e.styles.backgroundSize&&$(".input-backgroundSize").show(),"auto"===e.styles["-webkit-mask-size"]&&$(".input--webkit-mask-size").show(),this._setMaskSizeKendoInputs(e),void 0===e.url&&"responsiveImage"!==e.type||this.uploadImageHandlers(e),void 0!==e.styles.webkitMaskImage&&this.uploadMaskImageHandlers(e),this.initPropertiesBarHandlers(e,"background-properties")}},RuntimeEditor.prototype._renderBlendModesPanel=function(e){var t=document.getElementById("blend-modes-content"),i={};i.widget=e;var n=this.templateBlendModes(i);t&&(t.innerHTML=n,$("#blend-modes-content select").kendoDropDownList({animation:!1}),this.initPropertiesBarHandlers(e,"blend-modes-properties"))},RuntimeEditor.prototype._renderTextPropertiesPanel=function(e){var t=this,i={};i.widget=e;var n=this.templateTextProperties(i);document.getElementById("text-properties-content").innerHTML=n,$("#text-properties-content select").kendoDropDownList({animation:!1});var o=$("#color-picker");o.kendoColorPicker({buttons:!1,open:function(){t.colorPickerLeftReposition(),$("body").on("mouseup",function(){var i=o.data("kendoColorPicker").value();t.saveProperties(e.id,"css property","color",i)})},close:function(){t.colorPickerRemoveLeftReposition(),$("body").off("mouseup")},select:function(i){o.data("kendoColorPicker").value(i.value),t.applyProperties(e.id,"css property","color",i.value),t.saveProperties(e.id,"css property","color",i.value)},value:e.color,opacity:!0});var r=t.scene.fonts.map(function(e){var t=e.replace(/[^\/\\]*$/,""),i=function_helpers_1.default.backwardsShortenString(t,18);return{name:e.replace(/\.[^/.]+$/,"").replace(/^.*[\\\/]/,""),style:e.replace(/\.[^/.]+$/,"").replace(/^.*[\\\/]/,""),location:"Located under: "+i}})||[];$(".font-family").kendoDropDownList({height:"auto",animation:!1,dataSource:[{name:"Default",style:"initial",location:"Reset to default"},{name:"Inherit",style:"inherit",location:"Inherits from parent element",customClass:"last-default"}].concat(r),filter:"contains",dataTextField:"name",dataValueField:"style",template:fontFamilyTemplate,valueTemplate:selectedFontFamily,noDataTemplate:"No fonts found",index:-1,change:function(){t._sceneActionState.primaryAction="new action",t._setProperties(e,null,"styles","fontFamily",this.value())},open:function(){$($(".k-list-filter > input").get(0)).trigger("mousedown")},dataBound:function(){var i=$("select.font-family").data("kendoDropDownList");function_helpers_1.default.fontIsPresent(e.styles.fontFamily,t.scene.fonts)?i.value(e.styles.fontFamily):i.value("Default")}}),this.initPropertiesBarHandlers(e,"text-properties")},RuntimeEditor.prototype.addFontClickHandler=function(){var e=this;$("#add-font").on("click",function(){e.shouldEnableFont=!0,main_1.default.pickAsset("","font").otherwise(function(e){console.log("error = ",e)})})},RuntimeEditor.prototype.blendModesBarHandler=function(e){var t=this;$("#blend-modes-properties").on("click",function(){t._renderBlendModesPanel(e),$(this).off("click")})},RuntimeEditor.prototype.textPropertiesBarHandler=function(e){var t=this;$("#text-properties").on("click",function(){t._renderTextPropertiesPanel(e),$(this).off("click")})},RuntimeEditor.prototype._renderBorderPropertiesPanel=function(e){var t=this,i={};i.widget=e,i.env=main_1.default.preferences.couiEnvironment;var n=this.templateBorderStyleProperties(i);document.getElementById("border-style-properties-content").innerHTML=n;var o=$("#borderColor-picker");void 0!==e.styles&&void 0!==e.styles.borderColor&&o.kendoColorPicker({buttons:!1,open:function(){t.colorPickerLeftReposition(),$("body").on("mouseup",function(){var i=o.data("kendoColorPicker").value();t.saveProperties(e.id,"styles","borderColor",i)})},close:function(){t.colorPickerRemoveLeftReposition(),$("body").off("mouseup")},select:function(i){o.data("kendoColorPicker").value(i.value),t.applyProperties(e.id,"css property","borderColor",i.value),t.saveProperties(e.id,"styles","borderColor",i.value)},value:e.styles.borderColor,opacity:!0}),$("#border-style-properties-content select").kendoDropDownList({animation:!1}),this.initPropertiesBarHandlers(e,"border-style-properties")},RuntimeEditor.prototype.borderStylePropertiesBarHandLer=function(e){var t=this;$("#border-style-properties").on("click",function(){t._renderBorderPropertiesPanel(e),$(this).off("click")})},RuntimeEditor.prototype._addRemoveEngineCallEngineTriggerParamsHandler=function(e){function t(t){var i=t.closest(".events-wrap").find("select").attr("data-property-key"),n=t.attr("data-engine-fn");return e.events[i][n]}var i=this;$(".add-engine-event-param").on("click",function(){t($(this)).push(""),i._renderEventPropertiesBar(e)}),$(".remove-engine-event-param").on("click",function(){var n=$(this).attr("data-param-index");t($(this)).splice(n,1),i._renderEventPropertiesBar(e)})},RuntimeEditor.prototype._renderEventPropertiesBar=function(e){var t={},i=enums_1.default.EventTypes;t.allEvents=window.editorEvents,t.eventTypes={};for(var n=0;n<=i.length-1;n++){var o=i[n];e.events?t.eventTypes[o]=e.events[o]:t.eventTypes[o]=""}var r=this.templateEventsProperties(t);document.getElementById("events-properties-content").innerHTML=r,this._addRemoveEngineCallEngineTriggerParamsHandler(e),main_1.default.globalEditorInfo.backend!==enums_1.default.Backends.Standalone&&main_1.default.globalEditorInfo.backend!==enums_1.default.Backends["Standalone-2"]||$(".blueprint-option").remove(),this.initPropertiesBarHandlers(e,"events-properties"),$("#events-properties-content select").kendoDropDownList({animation:!1})},RuntimeEditor.prototype.updateBackgroundFilePathInfo=function(e,t){if("show"===e){$(".mask-image-remove-area").parent().fadeIn();var i=function_helpers_1.default.cleanBackgroundUrls(t);$(".mask-image-remove-area .url-text").text(i)}else $(".mask-image-remove-area").parent().fadeOut()},RuntimeEditor.prototype.filtersPropertiesBarHandler=function(e){var t=this;$(".dismiss-filter-drop-shadow").on("click",function(){t._undoCreationStepsLength=4,t._setFilter(null,e,e.id,"-webkit-filter","dropShadowX","0px"),t._setFilter(null,e,e.id,"-webkit-filter","dropShadowY","0px"),t._setFilter(null,e,e.id,"-webkit-filter","dropShadowBlur","0px"),t._setFilter(null,e,e.id,"-webkit-filter","dropShadowColor","rgb(0, 0, 0)"),$("#dropShadow-picker").data("kendoColorPicker").value("rgb(0, 0, 0)")})},RuntimeEditor.prototype.eventsPropertiesBarHandler=function(e){var t=this;$("#events-properties").on("click",function(){t._renderEventPropertiesBar(e),$(this).off("click")})},RuntimeEditor.prototype.dataBindingPropertiesBarHandler=function(e){var t=this;$("#data-binding-properties").on("click",function(){t._renderDataBindingPropertiesBar(e),$(this).off("click")})},RuntimeEditor.prototype._renderDataBindingPropertiesBar=function(e){var t={},i=enums_1.default.DataBindingTypes;t.dataBindingTypes={};for(var n=0;n<=i.length-1;n++){var o=i[n],r=function_helpers_1.default.translateDataBindNames(o,!0);e.dataBindings[o]?t.dataBindingTypes[r]=e.dataBindings[o]:t.dataBindingTypes[r]=""}var s=this.templateDataBindingEvents(t);document.getElementById("data-binding-properties-content").innerHTML=s,this.initPropertiesBarHandlers(e,"data-binding-properties")},RuntimeEditor.prototype._renderGeometryPropertiesPanel=function(e){var t={};t.widget=e;var i=this.templateGeometryProperties(t);document.getElementById("geometry-properties-content").innerHTML=i,this.initPropertiesBarHandlers(e,"geometry-properties"),this.couiEnvironmentManagement(),$("#geometry-properties-content select").kendoDropDownList({animation:!1}),"relative"===e.geometry.position&&$('#geometry-properties-content select[data-property-key="top"] , select[data-property-key="left"]').kendoDropDownList({enable:!1})},RuntimeEditor.prototype.geometryPropertiesBarHandler=function(e){var t=this;$("#geometry-properties").on("click",function(){t._renderGeometryPropertiesPanel(e),$(this).off("click")})},RuntimeEditor.prototype.transformPropertiesBarHandler=function(e){var t=this;$("#transform-properties").on("click",function(){t._renderTransformPropertiesBar(e),$(this).off("click")})},RuntimeEditor.prototype._renderTransformPropertiesBar=function(e){var t={};t.widget=$.extend(!0,{},e),t.env=main_1.default.preferences.couiEnvironment;var i=this.templateTransformProperties(t);document.getElementById("transform-properties-content").innerHTML=i,this.initPropertiesBarHandlers(e,"transform-properties"),this._initTransformHandlers(e),$("#transform-properties-content select").kendoDropDownList({animation:!1})},RuntimeEditor.prototype.setFiltersDefaults=function(e,t){if("all"===t)for(var i in filters_config_1.default["-webkit-filter"])this.resetFilterProps(e,i,filters_config_1.default["-webkit-filter"][i].default);else this.resetFilterProps(e,t,filters_config_1.default["-webkit-filter"][t].default)},RuntimeEditor.prototype.resetFilterProps=function(e,t,i){this._setProperties(e.data.widget,null,"-webkit-filter",t,i)},RuntimeEditor.prototype._initTransformHandlers=function(e){var t=this;$(".remove-property").off("click"),$(".remove-property").on("click",function(i){if(e.transform){var n=$(this).attr("data-type"),o=enums_1.default.TransformDefaultValue[n],r=function_helpers_1.default.getUnitStyle(o);t.selectKendoDropdownItem("units",n,r),t.setUnitNumberToolbar(n,o),t._setTransform(null,e,e.id,"transform",n,o),t.computeSelectCorners($("#"+e.id)),delete e.transform[n],t.exportScene()}}),$(".dismiss-transform").off("click"),$(".dismiss-transform").on("click",function(i){if(e.transform){var n=enums_1.default.TransformTypes;n=n.filter(function(e){return"GT"===main_1.default.preferences.couiEnvironment?"transform-origin-x"!==e&&"transform-origin-y"!==e:"Hummingbird"===main_1.default.preferences.couiEnvironment?"translateX"===e||"translateY"===e||"scaleX"===e||"scaleY"===e||"scaleZ"===e:void 0}),t._undoCreationStepsLength=n.length;for(var o=0;o<n.length;o++){var r=enums_1.default.TransformDefaultValue[n[o]],s=function_helpers_1.default.getUnitStyle(r);t.selectKendoDropdownItem("units",n[o],s),t.setUnitNumberToolbar(n[o],r),t._sceneActionState.primaryAction="new action",t._setTransform(null,e,e.id,"transform",n[o],r),t.computeSelectCorners($("#"+e.id)),delete e.transform[n[o]]}t.exportScene()}}),$(".dismiss-transform-origin").off("click"),$(".dismiss-transform-origin").on("click",function(){if(e.transform){var i=["transform-origin-x","transform-origin-y"];t._undoCreationStepsLength=2;for(var n=0;n<i.length;n++){var o=enums_1.default.TransformDefaultValue[i[n]],r=function_helpers_1.default.getUnitStyle(o);t.selectKendoDropdownItem("units",i[n],r),t.setUnitNumberToolbar(i[n],o),t._sceneActionState.primaryAction="new action",t._setTransformOrigin(null,e,e.id,"transform-origin",i[n],o),t.computeSelectCorners($("#"+e.id)),delete e.transform[i[n]]}t.exportScene()}}),$(".dismiss-perspective-origin").off("click"),$(".dismiss-perspective-origin").on("click",function(){if(e.transform){var i=["perspective-origin-x","perspective-origin-y"];t._undoCreationStepsLength=2;for(var n=0;n<i.length;n++){var o=enums_1.default.TransformDefaultValue[i[n]],r=function_helpers_1.default.getUnitStyle(o);t.selectKendoDropdownItem("units",i[n],r),t.setUnitNumberToolbar(i[n],o),t._sceneActionState.primaryAction="new action",t._setPerspectiveOrigin(null,e,e.id,"perspective-origin",i[n],o),t.computeSelectCorners($("#"+e.id)),delete e.transform[i[n]]}t.exportScene()}})},RuntimeEditor.prototype.couiEnvironmentManagement=function(){editor_settings_1.default.environment.Hummingbird===main_1.default.preferences.couiEnvironment&&$('.units-string option[value="%"]').remove()},RuntimeEditor.prototype.applyProperties=function(e,t,i,n){var o=$("#"+e);if("css property"===t)if("backgroundSize"===i)if("auto"===n){var r=main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor.mappedWidgets[e].widget,s=r.styles.backgroundSizeWidth+" "+r.styles.backgroundSizeHeight;o.css(i,s)}else(n=n.split(" "))[0]=units_conversion_1.default.convertUnitsToPixel(e,n[0],"backgroundSize"),n[1]=units_conversion_1.default.convertUnitsToPixel(e,n[1],"backgroundSize"),n=n.join(" "),o.css(i,n);else"webkitMaskImage"===i&&" "===n?(n=n.trim(),o.css(i,n)):"-webkit-mask-sizeWidth"===i||"-webkit-mask-sizeHeight"===i?(n=this.mappedWidgets[e].widget.styles["-webkit-mask-sizeWidth"]+" "+this.mappedWidgets[e].widget.styles["-webkit-mask-sizeHeight"],o.css("webkit-maskSize",n)):"perspective-origin-x"===i||"perspective-origin-y"===i?this.mappedWidgets[e].widget["perspective-origin"]&&(n=(this.mappedWidgets[e].widget["perspective-origin"]["perspective-origin-x"]||"50%")+" "+(this.mappedWidgets[e].widget["perspective-origin"]["perspective-origin-y"]||"50%"),o.css("perspective-origin",n)):o.css(i,n);else if("id property"===t){o.attr("id",n);var a=$("#sceneTree").jstree().get_node($('li[data-id="'+e+'"]'),!1);a.li_attr["data-id"]=n,$('li[data-id="'+e+'"]').attr("data-id",n),e===this.getSelectedWidgetId()&&($("#selected-element").attr("data-element-id",n),$('[data-property-key="id"]').attr("value",n)),$('[data-widget-id="'+e+'"]').attr("data-widget-id",n);var d=$('li[data-id="'+n+'"] > a');d.find(".jstree-id-item").text(n);var l=d.find(".jstree-extra-html")[0].outerHTML;this.Animations.editId(e,n),a.text=l}else if("class property"===t)o.attr("class",n);else if("checked"===t)o.prop(i,n);else if("attrs"===t)o.attr(i,n),"range"===o[0].type&&o.val(n).trigger("change");else if("remove css property"===t)o.css(i,"auto"),o.css(i,"");else if("set text"===t){o[0].childNodes[0].nodeValue=n;p=$("#"+e);this.highlightSelectedEl(p)}else if("image"===t){o.attr(i,n);var p=$("#"+e);this.highlightSelectedEl(p)}else if("dataBindings"===t){var c=enums_1.default.DataBindingGroups[i];""===n.trim()?o.removeAttr(c):o.attr(c,n)}},RuntimeEditor.prototype._childElMoveCheck=function(e,t,i){if("new action"===this._sceneActionState.primaryAction){var n=$("#"+e),o=this.mappedWidgets[e].widget,r=this.mappedWidgets[i];if(this._sceneActionState.hierarchyElementMove=!0,"top"!==t){var s=this.mappedWidgets[t].widget;"flexbox"!==s.type&&"select"!==s.type&&"ul"!==s.type&&"ol"!==s.type||void 0!==o.geometry&&"relative"!==o.geometry.position&&(this._undoCreationStepsLength=4,this._setGeometry(n,o,e,"geometry","position","relative"),this.clearSelectedElements(),this.selectJstreeItem(e))}else"top"===i||"flexbox"!==r.widget.type&&"select"!==r.widget.type&&"ul"!==r.widget.type&&"ol"!==r.widget.type||(this._undoCreationStepsLength=4,this._setGeometry(n,o,e,"geometry","position","absolute"),this._setGeometry(n,o,e,"geometry","left","0vw"),this._setGeometry(n,o,e,"geometry","top","0vh"),$('input[data-property-key="top"]').prop("disabled",!1),$('input[data-property-key="left"]').prop("disabled",!1));this._sceneActionState.hierarchyElementMove=!1}},RuntimeEditor.prototype.createComponent=function(e,t){runtime_1.default.createComponent(e,t)},RuntimeEditor.prototype.createElementSimple=function(e){runtime_1.default.createAnElement(e,this.scenePreviewEl)},RuntimeEditor.prototype.createElement=function(e){this.Animations.createAnimationWidget(e,{initial:!0}),runtime_1.default.createAnElement(e,this.scenePreviewEl)},RuntimeEditor.prototype.getPreviewStageSize=function(){return{width:$(this.scenePreviewEl).width(),height:$(this.scenePreviewEl).height()}},RuntimeEditor.prototype.getElementSize=function(e){return{width:e.width(),height:e.height()}},RuntimeEditor.prototype.getSelectedWidgetId=function(){var e=$("#sceneTree").jstree(!0).get_selected(!0);return e.length>0&&e[0].li_attr["data-id"]},RuntimeEditor.prototype.jsTreeAddNode=function(e,t,i,n,o){var r=this,s="last",a=this.jsTreeExtraItemHtml(e,t);void 0!==n&&(s=0===n?"first":n),$("#sceneTree").jstree().create_node(i,{text:a,icon:"fa fa-circle",li_attr:{"data-id":t}},s,function(){o?r.selectJstreeItem(t):$("#sceneTree").jstree().open_node(i)},!0),$("#sceneTree").jstree().is_loaded(i)},RuntimeEditor.prototype.createModalJsEditor=function(e,t,i,n){var o,r=this,s=$('<div id="modal-edit-js-code"></div>'),a=$('<div id="error-report-div"></div>'),d=s.text(i);$("body").append(s),(o=ace.edit("modal-edit-js-code")).setTheme("ace/theme/twilight"),o.getSession().setMode("ace/mode/javascript"),o.getSession().on("changeAnnotation",function(){var e=$("#error-report-div"),t=o.getSession().getAnnotations();e.empty();for(var i in t)t.hasOwnProperty(i)&&(e.append("<div>"+t[i].text+"on line  "+t[i].row+"</div>"),r.scrollDown(e))}),vex.dialog.open({contentClassName:"modal-code",closeClassName:"modal-close",message:"Code",buttons:[$.extend({},vex.dialog.buttons.YES,{text:"Save"}),$.extend({},vex.dialog.buttons.NO,{text:"Cancel"})],afterOpen:function(e){e.find(".vex-dialog-input").append(d).append(a)},callback:function(i){if(i){var s=o.getValue();if("sceneEvents"===t)r.scene.sceneEvents[e]=s;else{var a=$("#selected-element").attr("data-element-id");r.saveProperties(a,t,e,s,n)}r.saveScene()}}})},RuntimeEditor.prototype.visibilityWidgetHandler=function(){var e=$(".visibility-widget"),t=this;e.off("click"),e.on("click",function(){var e=$(this).parents(".jstree-node").attr("data-id");t._sceneActionState.primaryAction="new action",t.setVisibility(e)})},RuntimeEditor.prototype.lockWidgetHandler=function(){var e=$(".lock-widget"),t=this;e.off("click"),e.on("click",function(){var e=$(this).parents(".jstree-node").attr("data-id");t._sceneActionState.primaryAction="new action",t.setLocking(e)})},RuntimeEditor.prototype.setVisibility=function(id){this._sceneActionState.widgetOption=!0;var $jsTreeParents=$('[data-id="'+id+'"]').parents(".jstree-node"),$jsTreeFirstParent=$jsTreeParents.first("[role=tree-item]").parents(".jstree-node").first("[role=tree-item]");if("false"!==$("#"+$jsTreeFirstParent.attr("data-id")).attr("data-visibility")){var $widgetEl=$("#"+id),$childElems=$widgetEl.find("[data-element-type=widget]"),active=!eval($widgetEl.attr("data-visibility"));this.setElementVisible(id,active),this.highlightSelectedEl($widgetEl);var loopLength=$childElems.length,elementIDs=[];elementIDs.push(id);for(var i=0;i<loopLength;i++){var currentId=$($childElems[i]).attr("id");elementIDs.push(currentId),this.setElementVisible(currentId,active)}var actionScene=this.getRedoUndoPrimaryState(),undoRedoOptions;if(!active&&"new action"===actionScene){var elementsLength=elementIDs.length;this._undoCreationStepsLength=elementsLength+1;for(var i=0;i<elementsLength;i++)this.setElementLock(elementIDs[i],!active),undoRedoOptions={fn:"setLocking","data-lock":!active},this.createUndoRedoCommand(actionScene,elementIDs[i],null,null,null,undoRedoOptions),this._sceneActionState.widgetOption=!0}undoRedoOptions={fn:"setVisibility","data-visibility":active},this.createUndoRedoCommand(actionScene,id,null,null,null,undoRedoOptions)}},RuntimeEditor.prototype.setLocking=function(id){this._sceneActionState.widgetOption=!0;var $widgetEl=$("#"+id),active=!eval($widgetEl.attr("data-lock"));this.highlightSelectedEl($widgetEl),this.setElementLock(id,active);var undoRedoOptions={fn:"setLocking","data-lock":!active},actionScene=this.getRedoUndoPrimaryState();this.createUndoRedoCommand(actionScene,id,null,null,null,undoRedoOptions)},RuntimeEditor.prototype.setElementLock=function(e,t){var i=$("#"+e);i.attr("data-lock",t),i.attr("data-element-selectable",!t);var n=$('li[data-id="'+e+'"] > a').find(".lock-widget");t?n.addClass("active"):n.removeClass("active")},RuntimeEditor.prototype.setElementVisible=function(e,t){var i=$("#"+e);i.attr("data-visibility",t),i.css({visibility:t?"visible":"hidden"});var n=$('li[data-id="'+e+'"] > a').find(".visibility-widget");t?n.removeClass("active"):n.addClass("active")},RuntimeEditor.prototype.loadScene=function(e){var t=this;this.scene=$.extend(!0,this.scene,e),this.mapLoadedScene(this.scene.widgets),this.loadHierarchy(this.scene.widgets),this.scene.setStyleProperty("backgroundColor",this.scene.getStyleProperty("backgroundColor"));var i={runtimeEditor:t,endAllCallback:function(){$("#resetZoom").click()}},n=this.scene.sceneSize.type||this.scene.sceneSize.id;this.setAspectRatio(n),runtime_1.default.create(this.scene,this.scenePreviewEl,!1,i),this.Animations.loadTimeline(this.scene.animationClasses)},RuntimeEditor.prototype.mapLoadedScene=function(e){var t=this;e.map(function(e){var i=0;if(void 0!==e.children&&e.children.length>0&&(i=e.children.length),void 0===e.id&&(e.id=main_1.default.generateRandomId(e.type),main_1.default.widgetCount++),t.mappedWidgets[e.id]={widget:e},i>0)return t.mapLoadedScene(e.children)})},RuntimeEditor.prototype.loadHierarchy=function(e){var t=this.buildJsonInitJstree(e);this._sceneJsTree(t)},RuntimeEditor.prototype.buildJsonInitJstree=function(e){function t(e){var i={},n=function_helpers_1.default.isComponent(e)?"component":e.type;i.text=o.jsTreeExtraItemHtml(n,e.id),i.icon="fa fa-circle",i.li_attr={"data-id":e.id};var r=e.children;return void 0!==r&&r.length>0&&(i.children=[],r.forEach(function(e){i.children.push(t(e))})),i}for(var i=[],n=e.length,o=this,r=0;r<n;r++)i.push(t(e[r]));return i},RuntimeEditor.prototype.jsTreeExtraItemHtml=function(e,t){return'<div class="jstree-extra-html"><span class="visibility-widget" data-id="'+t+'"></span><span class="lock-widget" data-id="'+t+'"></span><span class="jstree-id-item">'+t+'</span><span class="jstree-type-item"> ('+e+")</span></div>"},RuntimeEditor.prototype.moveWidgetScenePreview=function(e,t,i,n){t.append(e),i<n&&t.children().eq(i).before(e),i>n&&t.children().eq(i).after(e),this.elementReposition&&this.repositionElementAgainstParent(e[0])},RuntimeEditor.prototype.moveWidget=function(e,t,i,n,o){var r,s,a;"top"===i&&"top"===t?(r=this.scene.widgets[o],this.scene.widgets.splice(o,1),this.scene.widgets.splice(n,0,r)):"top"===i?(r=this.mappedWidgets[e].widget,this.mappedWidgets[t].widget.children.splice(o,1),this.scene.widgets.splice(n,0,r)):"top"===t?(r=this.scene.widgets[o],(s=this.mappedWidgets[i].widget).children.splice(n,0,r),this.scene.widgets.splice(o,1)):(r=this.mappedWidgets[e].widget,(s=this.mappedWidgets[i].widget)===(a=this.mappedWidgets[t].widget)?(a.children.splice(o,1),s.children.splice(n,0,r)):(s.children.splice(n,0,r),a.children.splice(o,1))),s&&s.transformed_position&&this.transformChildren(s)},RuntimeEditor.prototype.selectJstreeItem=function(e){if(this.currentElementsSelection[0]=e,$("#selected-element").attr("data-element-id")!==e&&void 0!==e){this.clearSelectedElements();var t=$("#sceneTree").jstree();t.deselect_all(),t.search(e),t.select_node($('li[data-id="'+e+'"]'))}this.Timeline.unselectAllKeyfames(),this.Timeline.toggleElementTimeline($("#"+e),!0)},RuntimeEditor.prototype.selectMultiJstreeItems=function(e){var t=e.filter(function(e){return null!==e}),i=t.slice(0);this.currentElementsSelection=[],this.currentElementsSelection=t,this.currentParentElementsSelection=this.findParentElementsSelection(i),this.interactElementsState="resize",0===t.length?this.clearSelectedElements():1===t.length?this.selectJstreeItem(t[0]):this.highlightSelectedEl(null,t)},RuntimeEditor.prototype.clearSelectedElements=function(){this.closeColorPickers(),this.blurOutTextInputs(),$("#edit-menu").find(".btn-dynamic").addClass("disabled");var e=$("#sceneTree").jstree();e.deselect_all(!0),e.redraw(!0),$("mask").remove(),$(".transform-origin-point").remove(),$("#selected-element").remove(),this.propertiesElBar.empty(),this.currentElementsSelection.length=0,this.currentParentElementsSelection.length=0,this.Timeline.unhighlightAllTracks(),this.Timeline.unselectAllKeyfames(),this.WidgetSelection.setSelectedState(!1),this._setRightClickHandling(!0)},RuntimeEditor.prototype._sceneJsTree=function(e){var t=this,i=main_1.default.openFiles[t.editorTabName].tab.tabWidgetState.editWidget;$("#sceneTree").jstree({core:{rules:{creatable:!0},data:e,multiple:!0,html_titles:!0,load_open:i,check_callback:function(e,i,n,o,r){if("#"!==n.id){var s=document.getElementById(n.id).innerText.split(" ")[0];if("widget"===t.mappedWidgets[s].widget.type&&!main_1.default.openFiles[t.editorTabName].tab.tabWidgetState.editWidget)return!1}}},dnd:{check_while_dragging:!0,inside_pos:"last"},plugins:["dnd","search"]}).on("ready.jstree",function(e,n){var o=$("#sceneTree").jstree(),r=o.get_node("#");t.widgetVisualSceneState(r),t.jstreeDNDHandler(),i&&o.open_all(),t.rightPanel.scrollTop(t.tab.scrollIndex.rightPanel)}).on("create_node.jstree",function(e,i){var n=$("#sceneTree").jstree().get_node("#");t.widgetVisualSceneState(n)}).on("move_node.jstree",function(e,i){var n=$(this),o="top",r="top",s=i.old_parent,a=$(t.scenePreviewEl),d=i.node.li_attr["data-id"],l=i.old_position,p=i.position,c=$("#"+d),u=i.parent,m=function_helpers_1.default.getAbsolutePosition(c[0],"scene");if("#"!==u&&(o=n.find("#"+u).attr("data-id"),a=$("[id='"+o+"']"),function_helpers_1.default.isVoidElement(a[0])))return vex.dialog.alert({closeOnOverlayClick:!0,contentClassName:"modal-about",message:"Void dom elements cannot be nested into!"}),n.jstree().move_node(i.node,s,l),void n.jstree().redraw(!0);"#"!==s&&(r=n.find("#"+s).attr("data-id")),t.selectJstreeItem(d),t.moveWidget(d,r,o,p,l),t.moveWidgetScenePreview(c,a,p,l),n.jstree().open_node(u),t.highlightSelectedEl(c),t._childElMoveCheck(d,o,r);var h=t.getRedoUndoPrimaryState(),f={currentParentJstreeId:u,oldParentJstreeId:r,position:p,oldPosition:l};"new action"===t._sceneActionState.primaryAction&&(t._undoCreationStepsLength=3,t.repositionElementAfterReorder(c[0],a[0],m)),t._sceneActionState.moveElement=!0,t.createUndoRedoCommand(h,d,null,null,null,f),n.jstree().redraw(!0)}).on("select_node.jstree",function(e,i){t.Timeline.unhighlightAllTracks(),t.Timeline.unselectAllKeyfames();var n=i.node.li_attr["data-id"];if($("#selected-element").attr("data-element-id")!==n){t.currentElementsSelection[0]=n,t.currentParentElementsSelection[0]=n;var o=$("#"+n);t.interactElementsState="resize",t.highlightSelectedEl(o),t.Timeline.toggleElementTimeline(o,!0),t._sceneClickingState.draggingCreation||t.renderProperties(t.mappedWidgets[n].widget)}}).on("hover_node.jstree",function(e,i){if(!t._dragFlag){var n=i.node.li_attr["data-id"];t.interactElementsState="resize";var o=$("#"+n);t.highlightSelectedEl(o)}t._dragFlag=!1}).on("dehover_node.jstree",function(e,i){var n=$("#sceneTree").jstree("get_selected");if(n.length>0){var o=$("#"+n[0]).attr("data-id"),r=$("#"+o);t.highlightSelectedEl(r)}else $(".element-blink").removeClass("element-blink")}).on("open_node.jstree",function(e,n){"widget"===$("#"+n.node.li_attr["data-id"]).attr("data-type")&&!i&&$("#sceneTree").jstree().close_node(n.node.id),t.widgetVisualSceneState(n.node)}).on("redraw.jstree",function(){var e=$("#sceneTree").jstree().get_node("#");t.widgetVisualSceneState(e)})},RuntimeEditor.prototype.widgetVisualSceneState=function(e){for(var t=e.children_d,i=t.length,n=0;n<i;n++){var o=$("#"+t[n]).attr("data-id"),r=$("#"+o),s=r.attr("data-lock"),a=r.attr("data-visibility");"true"===s?$("#"+t[n]+" > a .lock-widget").addClass("active"):r.attr("data-lock","false"),"false"===a?$("#"+t[n]+" > a .visibility-widget").addClass("active"):r.attr("data-visibility","true")}this.visibilityWidgetHandler(),this.lockWidgetHandler()},RuntimeEditor.prototype.onRotateElStart=function(){this.closeColorPickers(),this._undoCreationStepsLength=1,$(".rotate-corners").addClass("disable-click"),this._dragFlag=!1},RuntimeEditor.prototype.onRotateElMove=function(){var e=document.getElementById(this.getSelectedWidgetId());this._dragFlag=!0,this._isElementRotated=!0,this._sceneActionState.primaryAction="new action",this.computeSelectCorners($(e))},RuntimeEditor.prototype.onRotateElEnd=function(e,t){this._isElementRotated&&($(".rotate-corners").removeClass("disable-click"),this.saveProperties(e.id,"transform","rotateZ",t.deg+"deg"),$('input[data-property-key="rotateZ"]').val(parseInt(t.deg)),this._isElementRotated=!1)},RuntimeEditor.prototype.onDragElStart=function(){this.closeColorPickers(),this._dragFlag=!1,this._sceneActionState.primaryAction="start dragging",this.pendingTransformOriginPoint=!0,window.startMouseX=mouseCoordsX,window.startMouseY=mouseCoordsY},RuntimeEditor.prototype.onDragElMove=function(){this.prepareTransformOriginPosition(),this.hasElementBeenDragged()},RuntimeEditor.prototype.onDragElEnd=function(){if(this._dragFlag){this.setUndoRedoShift(2);for(var e=this.currentParentElementsSelection.length,t=0;t<e;t++){var i=document.getElementById(this.currentElementsSelection[t]);null!==this.currentParentElementsSelection[t]&&this.onInteractEnd(i)}}this.pendingTransformOriginPoint=!1},RuntimeEditor.prototype.onResizeElStart=function(e){this.closeColorPickers(),this._dragFlag=!1,this._undoCreationStepsLength=4},RuntimeEditor.prototype.onResizeElMove=function(e){var t=this.mappedWidgets[e.id].widget;this.sceneWrapper.panzoom("disable"),this._dragFlag=!0,this.updateTransformOriginPoint(t),this._sceneActionState.primaryAction="new action"},RuntimeEditor.prototype.onResizeElEnd=function(e,t){this.sceneWrapper.panzoom("enable"),this.onInteractEnd(e);var i,n=e.id,o=this.mappedWidgets[n].widget,r=function_helpers_1.default.getUnitStyle(o.geometry.width),s=function_helpers_1.default.getUnitStyle(o.geometry.height),a=parseFloat(e.style.width);t.shiftKey&&this.equalProportion?(i=a,this.equalProportion=!1):i=parseFloat(e.style.height);var d=units_conversion_1.default.convertPixelToUnit(n,a,r,"width"),l=units_conversion_1.default.convertPixelToUnit(n,i,s,"height");if("auto"===s&&(this._undoCreationStepsLength=this._undoCreationStepsLength-1),"auto"===r&&(this._undoCreationStepsLength=this._undoCreationStepsLength-1),"auto"!==s)if(o.geometry.height!==l){var p=parseFloat(l),c=units_conversion_1.default.convertUnitsToPixel(n,p+s,"height");this.saveProperties(n,"geometry","height",p.toFixed(this.formatTo+1)+s),this.applyProperties(n,"css property","height",c),this.setUnitNumberToolbar("height",p.toFixed(this.formatTo+1)+s)}else this.adjustUndoRedoStepsLen();if("auto"!==r)if(o.geometry.width!==d){var u=parseFloat(d),m=units_conversion_1.default.convertUnitsToPixel(n,u+r,"width");this.saveProperties(n,"geometry","width",u.toFixed(this.formatTo+1)+r),this.applyProperties(n,"css property","width",m),this.setUnitNumberToolbar("width",u.toFixed(this.formatTo+1)+r)}else this.adjustUndoRedoStepsLen();"%"===s&&(e.style.height=l),"%"===r&&(e.style.width=d);var h=$("#"+n);this.highlightSelectedEl(h)},RuntimeEditor.prototype.prepareTransformOriginPosition=function(){if(1===this.currentElementsSelection.length){var e=this.getSelectedWidgetId(),t=this.mappedWidgets[e].widget;this.updateTransformOriginPoint(t)}},RuntimeEditor.prototype.setUndoRedoShift=function(e){this._undoCreationStepsLength=this.currentParentElementsSelection.filter(function(e){return null!==e}).length*e},RuntimeEditor.prototype.repositionElementAgainstParent=function(e){var t=e.style,i=parseFloat(t.left),n=parseFloat(t.top),o=i-e.parentElement.offsetLeft,r=n-e.parentElement.offsetTop;t.left=o+"px",t.top=r+"px",this.elementReposition=!1,this.selectJstreeItem(e.id)},RuntimeEditor.prototype.repositionElementAfterReorder=function(e,t,i){var n={left:0,top:0};t&&"scene"!==t.id&&(n=function_helpers_1.default.getAbsolutePosition(t,"scene"));var o=i.left-n.left,r=i.top-n.top,s=e.style;s.left=o+"px",s.top=r+"px",this.recalculatePixelToUnits(e),this.selectJstreeItem(e.id)},RuntimeEditor.prototype.onInteractEnd=function(e){if(this.Timeline.unselectAllKeyfames(),this.pendingTransformOriginPoint=!1,"absolute"===e.style.position){var t=e.id,i=this.mappedWidgets[t].widget,n=function_helpers_1.default.getUnitStyle(i.geometry.left),o=function_helpers_1.default.getUnitStyle(i.geometry.top),r=e.offsetLeft,s=e.offsetTop,a=units_conversion_1.default.convertPixelToUnit(t,r,n,"left"),d=units_conversion_1.default.convertPixelToUnit(t,s,o,"top");if("auto"===o&&(this._undoCreationStepsLength=this._undoCreationStepsLength-1),"auto"===n&&(this._undoCreationStepsLength=this._undoCreationStepsLength-1),"auto"!==o)if(i.geometry.top!==d){var l=parseFloat(d),p=units_conversion_1.default.convertUnitsToPixel(t,l+o,"top");this.saveProperties(t,"geometry","top",l.toFixed(this.formatTo+1)+o),this.applyProperties(t,"css property","top",p),this.setUnitNumberToolbar("top",l.toFixed(this.formatTo+1)+o)}else this.adjustUndoRedoStepsLen();if("auto"!==n)if(i.geometry.left!==a){var c=parseFloat(a),u=units_conversion_1.default.convertUnitsToPixel(t,c+n,"left");this.saveProperties(t,"geometry","left",c.toFixed(this.formatTo+1)+n),this.applyProperties(t,"css property","left",u),this.setUnitNumberToolbar("left",c.toFixed(this.formatTo+1)+n)}else this.adjustUndoRedoStepsLen()}},RuntimeEditor.prototype.adjustUndoRedoStepsLen=function(){this._undoCreationStepsLength>1&&this._undoCreationStepsLength--,this._skipUndoRedoSteps>0&&this._skipUndoRedoSteps--},RuntimeEditor.prototype.closeColorPickers=function(){void 0!==$(".color-picker").data("kendoColorPicker")&&($("body").off("mouseup"),$(".color-picker").data("kendoColorPicker").close())},RuntimeEditor.prototype.interactHandler=function(e){var t=document.getElementById(e);Interact(t,this.editorTabName,this.interactElementsState,this.createElementEvent)},RuntimeEditor.prototype.hasElementBeenDragged=function(){startMouseX!==mouseCoordsX&&startMouseY!==mouseCoordsY&&(this._dragFlag=!0,this._sceneActionState.primaryAction="new action")},RuntimeEditor.prototype.displayVideos=function(e){for(var t=0;t<e.length;t++)this.displayVideo(e[t])},RuntimeEditor.prototype.displayVideo=function(e){var t=this;$(e).one("canplay",function(){this.volume=0,this.play(),$(this).one("timeupdate",function(){t.stopVideo(this)})})},RuntimeEditor.prototype.stopVideo=function(e){e.pause(),e.currentTime=0},RuntimeEditor.prototype.scenePanning=function(){var e=this;this.sceneWrapper.panzoom("option",{disablePan:!e.isInPanningMode})},RuntimeEditor.prototype.setSceneStyleProperty=function(e,t){var i={sceneProperty:{style:{backgroundColor:this.scene.style[e]}}};return this._setUndoRedoCommandsFill(i),this.scene.setStyleProperty(e,t),this.exportScene(),this},RuntimeEditor.prototype.recalculatePixelToUnits=function(e){var t=this.mappedWidgets[e.id].widget,i=e.style,n=function_helpers_1.default.getUnitStyle(t.geometry.top),o=function_helpers_1.default.getUnitStyle(t.geometry.left),r=parseFloat(i.top),s=parseFloat(i.left),a=units_conversion_1.default.convertPixelToUnit(e.id,r,n,"top"),d=units_conversion_1.default.convertPixelToUnit(e.id,s,o,"left");this._setGeometry(null,t,t.id,"geometry","top",a),this._setGeometry(null,t,t.id,"geometry","left",d)},RuntimeEditor.prototype.recalculateUnits=function(e){var t=e?e.id:"";if(t&&void 0!==this.mappedWidgets[t]){var i=this.mappedWidgets[t].widget,n={};if(void 0!==i.geometry){i.geometry.top&&(n.top=i.geometry.top),i.geometry.left&&(n.left=i.geometry.left),i.geometry.width&&(n.width=i.geometry.width),i.geometry.height&&(n.height=i.geometry.height),i.fontSize&&(n.fontSize=i.fontSize),i.styles.borderWidth&&(n.borderWidth=i.styles.borderWidth),i.styles.backgroundPositionX&&(n.backgroundPositionX=i.styles.backgroundPositionX),i.styles.backgroundPositionY&&(n.backgroundPositionY=i.styles.backgroundPositionY),i.styles.backgroundSize&&"auto"===i.styles.backgroundSize&&(n.backgroundSize=i.styles.backgroundSize);for(var o in n)if("backgroundSize"===o){if("auto"===n[o]){var r,s,a=e.style[o].split(" ");1===a.length?r=s=a[0].trim():(r=a[0].trim(),s=a[1].trim());var d,l,p=function_helpers_1.default.getUnitStyle(r),c=function_helpers_1.default.getUnitStyle(s);"%"!==p&&(d=units_conversion_1.default.convertUnitsToPixel(t,r,"backgroundSizeWidth")),"%"!==c&&(l=units_conversion_1.default.convertUnitsToPixel(t,s,"backgroundSizeHeight")),i.styles.backgroundSizeWidth=r,i.styles.backgroundSizeHeight=s,e.style[o]=d+" "+l}}else"%"!==function_helpers_1.default.getUnitStyle(n[o])&&(e.style[o]=units_conversion_1.default.convertUnitsToPixel(t,e.style[o],o))}}},RuntimeEditor.prototype.colorPickerLeftReposition=function(){setTimeout(function(){$(".k-animation-container").css("left","6px")},50)},RuntimeEditor.prototype.colorPickerRemoveLeftReposition=function(){$(".k-animation-container").css("left","auto")},RuntimeEditor.prototype.scrollDown=function(e){e.scrollTop<e.scrollHeight-e.clientHeight&&(e.scrollTop+=20)},RuntimeEditor.prototype.isColorbackground=function(e){if(void 0!==e)return e.startsWith("url")?"rgba(255,255,255,1);":e},RuntimeEditor.prototype.hideShowEventParams=function(e,t){var i=e.parents(".events-wrap"),n={blueprintFunction:i.find(".blueprint-events"),engineCall:i.find(".enginecall-events"),engineTrigger:i.find(".enginetrigger-events"),javascriptFunction:i.find(".javascript-events")};for(var o in n)n[o].hide();n[t]&&n[t].show()},RuntimeEditor}();exports.default=RuntimeEditor;