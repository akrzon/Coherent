"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var main_1=require("../scripts/main"),function_helpers_1=require("./function_helpers"),transform_1=require("./transform"),WidgetSelection;!function(e){function t(e){m=!1,(f=$(".selection-drag")).addClass("active"),s=p.offset().top,l=p.offset().left,d=e.pageX,u=e.pageY,f.css({left:e.pageX-l,top:e.pageY-s}),p.bind("mouseup",y),p.bind("mousemove",n)}function n(e){g=!0;var t=Math.abs(d-e.pageX),n=Math.abs(u-e.pageY);f.css({width:t,height:n}),e.pageX<=d&&e.pageY>=u?f.css({left:e.pageX-l}):e.pageY<=u&&e.pageX>=d?f.css({top:e.pageY-s}):e.pageY<u&&e.pageX<d&&f.css({left:e.pageX-l,top:e.pageY-s})}function o(e,t){var n=r(e[0]),o=main_1.default.selectedEditor,i=main_1.default.openFiles[o].runtimeEditor,s=new transform_1.default,l=i.mappedWidgets[t[0].id].widget,d=s.getViewportPosition(l),u=d.length?d:a(t[0]);return function_helpers_1.default.doPolygonsIntersect(u,n)}function i(e,t,n,o,i){var r=n.m11*e+-n.m12*t,a=-n.m21*e+n.m22*t;return r=o+r,a=i+a,{x:r,y:a}}function r(e){var t=parseFloat(window.getComputedStyle(e,null).getPropertyValue("width")),n=parseFloat(window.getComputedStyle(e,null).getPropertyValue("height")),o=e.offsetTop,i=e.offsetLeft,r=i+t,a=o+n;return[{x:i,y:o},{x:r,y:o},{x:r,y:a},{x:i,y:a}]}function a(e){var t=document.getElementById("scene"),n=new WebKitCSSMatrix(window.getComputedStyle(t).webkitTransform),o=parseFloat(window.getComputedStyle(e,null).getPropertyValue("width")),r=parseFloat(window.getComputedStyle(e,null).getPropertyValue("height")),a=new WebKitCSSMatrix(window.getComputedStyle(e).webkitTransform);a=a.multiply(n);var s=function_helpers_1.default.getAbsolutePosition(e,"scene-wrapper"),l=s.left,d=s.top,u=function_helpers_1.default.calcElementTransformedMatrixCoords(e,"scene-wrapper"),p=o/2,c=r/2,f=(l+=u.x+n.e)+p,m=(d+=u.y+n.f)+c,g=-c,h=-p,w=p,y=c,v={topLeft:i(h,g,a,f,m),topRight:i(w,g,a,f,m),bottomLeft:i(h,y,a,f,m),bottomRight:i(w,y,a,f,m)};return[v.topLeft,v.topRight,v.bottomRight,v.bottomLeft]}var s,l,d,u,p,c,f,m=!1,g=!1,h=function(){function e(){}return e.prototype.init=function(){p=$("#top-scene-holder"),c=$("#scene")},e.prototype.getSelectedState=function(){return m},e.prototype.setSelectedState=function(e){m=e},e.prototype.detachHandlers=function(){p[0].removeEventListener("mousedown",t,!1),p[0].removeEventListener("mousedown",w,!1)},e.prototype.attachHandlers=function(){this.detachHandlers(),p[0].addEventListener("mousedown",t,!1),p[0].addEventListener("mousedown",w,!1)},e}();e.WidgetSelection=h;var w=function(e){var t=e.target,n=t.dataset,o=main_1.default.selectedEditor,i=main_1.default.openFiles[o].runtimeEditor;n.elementSelectable&&"true"===n.elementSelectable?i.selectJstreeItem(t.id):n.parentWidgetId?i.selectJstreeItem(n.parentWidgetId):"scene"!==t.id&&"scene-wrapper"!==t.id||i.clearSelectedElements()},y=function(e){if(p.unbind("mousemove",n),p.unbind("mouseup",y),g){var t=[];$('[data-element-selectable="true"][data-element-type="widget"]').each(function(){var e=$(this);o(f,e)&&t.push(e[0].id)});var i=main_1.default.selectedEditor;main_1.default.openFiles[i].runtimeEditor.selectMultiJstreeItems(t)}f.removeClass("active"),f.width(0).height(0),g=!1}}(WidgetSelection||(WidgetSelection={})),exports.default=WidgetSelection;