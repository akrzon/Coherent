"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var timeline_1=require("./timeline"),keyframes_1=require("./keyframes"),function_helpers_1=require("../function_helpers"),exportCss_1=require("./exportCss"),importCss_1=require("./importCss"),main_1=require("../../scripts/main"),Animations=function(){function e(){}return e.prototype.init=function(e){this.runtimeEditor=e,this.runtimeEditor.Timeline=new timeline_1.default(e),this.runtimeEditor.Keyframes=new keyframes_1.default(e),this.runtimeEditor.Timeline.create(),this.runtimeEditor.Keyframes.init()},e.prototype.attachKeyframeHandlers=function(e){this.runtimeEditor.Keyframes.widgetKeyframesHandlers(e)},e.prototype.createAnimationWidget=function(e,i){var t=this,r=$('[data-timeline-info-widget-id="'+e.id+'"]').length;main_1.default.preferences.timeline.filterTimelineWidgets&&!r?e.className.split(" ").map(function(r){t.runtimeEditor.scene.animationClasses[r]&&t.runtimeEditor.Timeline.addWidget(e,i)}):r||this.runtimeEditor.Timeline.addWidget(e,i)},e.prototype.onKeyframeChange=function(e,i,t){this.runtimeEditor.Keyframes.onKeyframeChange(e,i,t)},e.prototype.addKeyframe=function(e,i,t,r,n){this.runtimeEditor.Keyframes.addKeyframe(e,i,t,r,n),this.runtimeEditor.Timeline.create(),this.runtimeEditor.exportScene()},e.prototype.loadTimeline=function(e,i){void 0===i&&(i=!0);for(var t in this.runtimeEditor.mappedWidgets){var r=this.runtimeEditor.mappedWidgets[t].widget,n=$("#"+r.id);n.length>0&&n[0].hasAttribute("data-element-selectable")&&this.createAnimationWidget(r,{initial:i})}this.loadKeyframes(e,i)},e.prototype.loadKeyframes=function(e,i,t){void 0===i&&(i=!1),void 0===t&&(t=!1);var r=this;this.runtimeEditor._sceneActionState.keyframeInitial=!0;for(var n in e){var a=e[n].keyframes;for(var s in a){var d=a[s];for(var o in d){var m=d[o];for(var u in m){var l=m[u].values[0],f=this.runtimeEditor.mappedWidgets;for(var p in f)if(f[p].widget.className){var h={className:n,widgetId:p,group:s,property:o,value:l,keyframeTime:u};$('[data-timeline-info-widget-id="'+p+'"]').length||$("#"+p).is("[data-parent-widget-id]")||this.createAnimationWidget(this.runtimeEditor.mappedWidgets[p].widget,{initial:!1}),f[p].widget.className.split(" ").filter(function(e){e!==this.className||main_1.default.copiedWidgets.widgets[this.widgetId]&&!i||(t&&r.runtimeEditor.Timeline.initAnimationClassName(this.widgetId,"",this.className,!1,!0),r.runtimeEditor.Keyframes.addKeyframe(this.widgetId,this.group,this.property,this.value,{seconds:this.keyframeTime}))}.bind(h))}}}}}if(this.runtimeEditor._sceneActionState.keyframeInitial=!1,this.runtimeEditor.Timeline.create(),this.runtimeEditor.exportScene(),main_1.default.openFiles[main_1.default.selectedEditor].tab.tabWidgetState.editWidget){var c=this.runtimeEditor.scene.widgets[0].id;function_helpers_1.default.getFromTimeline('[data-timeline-info-widget-id="'+c+'"]').hide(),function_helpers_1.default.getFromTimeline('.widget-line[data-widget-id="'+c+'"]').hide()}},e.prototype.deleteKeyframe=function(e){e?this.runtimeEditor.Timeline.deleteKeyframe(e):this.runtimeEditor.Timeline.deleteSelectedKeyframes()},e.prototype.editId=function(e,i){this.runtimeEditor.Timeline.editId(e,i),this.runtimeEditor.scene.animations[e]&&(this.runtimeEditor.scene.animations[i]=this.runtimeEditor.scene.animations[e],this.runtimeEditor.scene.animations[e].id=i,e!==i&&delete this.runtimeEditor.scene.animations[e])},e.prototype.deleteWidget=function(e){this.runtimeEditor.Timeline.deleteWidget(e)},e.prototype.exportToCss=function(e){return exportCss_1.default.exportCss(e,this.runtimeEditor.editorTabName)},e.prototype.importCSS=function(e){return importCss_1.default.importCss(e)},e}();exports.default=Animations;