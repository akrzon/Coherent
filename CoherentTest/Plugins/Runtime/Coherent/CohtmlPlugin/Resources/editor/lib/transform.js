"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var function_helpers_1=require("./function_helpers"),main_1=require("../scripts/main"),Transform=function(){function e(e){this.element=e}return e.prototype.getOriginCoords=function(e,t){return[[Number(e.left)-t.x,Number(e.top)-t.y,0,1],[Number(e.left)+Number(e.width)-t.x,Number(e.top)-t.y,0,1],[Number(e.left)+Number(e.width)-t.x,Number(e.top)+Number(e.height)-t.y,0,1],[Number(e.left)-t.x,Number(e.top)+Number(e.height)-t.y,0,1]]},e.prototype.coordsIn2D=function(e){for(var t=0;t<e.length;t++){var r=e[t][3];e[t][0]=e[t][0]/r,e[t][1]=e[t][1]/r,e[t][2]=0,e[t][3]=r/r}return e},e.prototype.getOriginInParent=function(e,t,r){var n=getComputedStyle(document.getElementById(r.id)),o=getComputedStyle(document.getElementById(r.parentElement.id)),i=n.transformOrigin.split(" "),s=o.transformOrigin.split(" ");"scene"===r.parentElement.id&&(s=["0px","0px"]);var a=/(-|[0-9\.0-9])+/g;return{x:parseFloat(e.left)+Number(i[0].match(a)[0])-Number(s[0].match(a)[0]),y:parseFloat(e.top)+Number(i[1].match(a)[0])-Number(s[1].match(a)[0])}},e.prototype.transform=function(e){var t=this.getPosition(e);e.transformed_position=t},e.prototype.getTranslationMatrix=function(e){var t=this.getElTranslation(e),r=new WebKitCSSMatrix;return r.m41=-t.x,r.m42=-t.y,r},e.prototype.getTransformedPos=function(e,t,r){for(;e.id!==t;){var n=new WebKitCSSMatrix(getComputedStyle(e).webkitTransform);n=n.inverse().multiply(this.getTranslationMatrix(e)).inverse(),r=this.coordsIn2D(this.getTrsnsformedPoints(function_helpers_1.default.parseMatrix(n,!0),r)),e=e.parentElement,this.getTransformedPos(e,t,r)}return r},e.prototype.getElTranslation=function(e){var t=main_1.default.selectedEditor,r=main_1.default.openFiles[t].runtimeEditor,n=r.mappedWidgets[e.id].widget,o=r.mappedWidgets[e.parentElement.id];o=o?o.widget:{};var i=function_helpers_1.default.getElementVertices(n),s=function_helpers_1.default.getElementVertices(o);return this.getOriginInParent(i,s,e)},e.prototype.getPosition=function(e){var t=function_helpers_1.default.getElementVertices(e),r=document.getElementById(e.id),n=function_helpers_1.default.getAbsolutePosition(r,"scene");Object.assign(t,n);var o=function_helpers_1.default.getTransformOrigin(t,e),i=this.getOriginCoords(t,o);return this.getTransformedPos(r,"scene",i)},e.prototype.getTrsnsformedPoints=function(e,t){for(var r=[],n=0;n<t.length;n++)r.push(function_helpers_1.default.multiply(e,t[n]));return r},e.prototype.getViewportPosition=function(e){var t=[];if(!e.transformed_position)return t;this.transform(e);for(var r=document.getElementById("scene"),n=$("#scene").offset(),o=$("#scene-wrapper").offset(),i=new WebKitCSSMatrix(window.getComputedStyle(r).webkitTransform),s=n.left-o.left,a=n.top-o.top,u=0;u<e.transformed_position.length;u++)t.push({x:e.transformed_position[u][0]*i.a+s,y:e.transformed_position[u][1]*i.a+a});return t},e}();exports.default=Transform;