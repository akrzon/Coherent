"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var enums_1=require("./enums"),function_helpers_1=require("./function_helpers"),main_1=require("../scripts/main"),KeyhandlersFunction;!function(e){function t(e,t){var n,a=t.currentParentElementsSelection,i=$("#sceneTree").jstree().get_selected()[0],r=$("#"+i),s=r.siblings().first().attr("data-id"),l=r.siblings().last().attr("data-id");1===a.length&&(n=e?r.next("li").attr("data-id")||s:r.prev("li").attr("data-id")||l)&&t.selectJstreeItem(n)}e.arrowKeysHandler=function(e){var t,n=main_1.default.openFiles[main_1.default.selectedEditor].runtimeEditor,a=n.currentParentElementsSelection,i=event.shiftKey?5:1;if(1===a.length){t=n.mappedWidgets[a].widget.geometry,function_helpers_1.default.getUnitStyle(t.top);var r=function_helpers_1.default.getUnitStyle(t.left);"left"!==e&&"right"!==e||"px"===r||(i*=.1),"up"!==e&&"down"!==e||"px"===r||(i*=.1)}a.length>1?(a.forEach(function(t){function_helpers_1.default.moveWidget({elementId:t,moveDirection:e,step:i,preserveUnits:!1})}),n.selectMultiJstreeItems(a)):1===n.currentElementsSelection.length&&(function_helpers_1.default.moveWidget({elementId:a[0],moveDirection:e,step:i,preserveUnits:!0}),n.computeSelectCorners($("#"+a[0])))},e.selectElement=t,e.switchElement=function(e,n){e.preventDefault(),t(!e.shiftKey,n)},e.attachKeyHandlersGlobal=function(){$("body").off("keydown"),$("body").off("keyup"),$("body").on("keydown",function(e){switch(e.which){case enums_1.default.Keys.s:if(e.ctrlKey){e.preventDefault();var t=document.activeElement;"INPUT"===t.tagName&&null!==t.getAttribute("property")&&$(document.activeElement).blur();var n=main_1.default.openFiles[main_1.default.selectedEditor],a=n.tab.filePath+n.tab.filename;main_1.default.save(a,n.file.valueOf())}}})},e.attachkeyHandlersRuntimeEditor=function(e){var t=this;this.attachKeyHandlersGlobal(),$("body").on("keydown",function(n){var a=document.activeElement.tagName;if("INPUT"!==a&&"TEXTAREA"!==a){switch(n.which){case enums_1.default.Keys.p:n.preventDefault(),e.Timeline.setPinheadPosition(0,0),e.preview("scene");break;case enums_1.default.Keys.c:n.ctrlKey&&e.copyWidgets();break;case enums_1.default.Keys.v:n.ctrlKey&&(e._sceneActionState.primaryAction="new action",e.cloneWidget())}if(a){var i=enums_1.default.newScene,r=document.getElementById(i._DOMId);if(!r)return;switch(!1===r.contains(n.target)&&(n.preventDefault(),document.activeElement.blur()),n.keyCode){case enums_1.default.Keys.left:case 16777234:t.arrowKeysHandler("left");break;case enums_1.default.Keys.up:case 16777235:t.arrowKeysHandler("up");break;case enums_1.default.Keys.right:case 16777236:t.arrowKeysHandler("right");break;case enums_1.default.Keys.down:case 16777237:t.arrowKeysHandler("down");break;case enums_1.default.Keys.tab:n.preventDefault();var s=!n.shiftKey;t.selectElement(s,e)}}}n.ctrlKey&&!1===n.shiftKey&&n.keyCode===enums_1.default.Keys.z&&(e.undoRedoScene("undo"),main_1.default.autoTriggerUndoRedo("undo")),n.ctrlKey&&n.shiftKey&&n.keyCode===enums_1.default.Keys.z&&(e.undoRedoScene("redo"),main_1.default.autoTriggerUndoRedo("redo"))}).keyup(function(t){var n=document.activeElement.tagName;if("INPUT"!==n&&"TEXTAREA"!==n)switch(t.which){case enums_1.default.Keys.delete:case 16777223:t.preventDefault(),e._sceneActionState.primaryAction="new action",e.selectedKeyframes.length>0?e.Animations.deleteKeyframe():e.removeMultipleWidgets()}}),$("#sceneTree").off("keydown"),$("#sceneTree").on("keydown",function(n){n.keyCode===enums_1.default.Keys.tab&&t.switchElement(n,e)})}}(KeyhandlersFunction||(KeyhandlersFunction={})),exports.default=KeyhandlersFunction;